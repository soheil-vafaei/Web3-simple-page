{"ast":null,"code":"import boolbase from \"boolbase\";\nimport { isTraversal } from \"../sort.js\";\n/** Used as a placeholder for :has. Will be replaced with the actual element. */\n\nexport const PLACEHOLDER_ELEMENT = {};\nexport function ensureIsTag(next, adapter) {\n  if (next === boolbase.falseFunc) return boolbase.falseFunc;\n  return elem => adapter.isTag(elem) && next(elem);\n}\nexport function getNextSiblings(elem, adapter) {\n  const siblings = adapter.getSiblings(elem);\n  if (siblings.length <= 1) return [];\n  const elemIndex = siblings.indexOf(elem);\n  if (elemIndex < 0 || elemIndex === siblings.length - 1) return [];\n  return siblings.slice(elemIndex + 1).filter(adapter.isTag);\n}\n\nfunction copyOptions(options) {\n  // Not copied: context, rootFunc\n  return {\n    xmlMode: !!options.xmlMode,\n    lowerCaseAttributeNames: !!options.lowerCaseAttributeNames,\n    lowerCaseTags: !!options.lowerCaseTags,\n    quirksMode: !!options.quirksMode,\n    cacheResults: !!options.cacheResults,\n    pseudos: options.pseudos,\n    adapter: options.adapter,\n    equals: options.equals\n  };\n}\n\nconst is = (next, token, options, context, compileToken) => {\n  const func = compileToken(token, copyOptions(options), context);\n  return func === boolbase.trueFunc ? next : func === boolbase.falseFunc ? boolbase.falseFunc : elem => func(elem) && next(elem);\n};\n/*\n * :not, :has, :is, :matches and :where have to compile selectors\n * doing this in src/pseudos.ts would lead to circular dependencies,\n * so we add them here\n */\n\n\nexport const subselects = {\n  is,\n\n  /**\n   * `:matches` and `:where` are aliases for `:is`.\n   */\n  matches: is,\n  where: is,\n\n  not(next, token, options, context, compileToken) {\n    const func = compileToken(token, copyOptions(options), context);\n    return func === boolbase.falseFunc ? next : func === boolbase.trueFunc ? boolbase.falseFunc : elem => !func(elem) && next(elem);\n  },\n\n  has(next, subselect, options, _context, compileToken) {\n    const {\n      adapter\n    } = options;\n    const opts = copyOptions(options);\n    opts.relativeSelector = true;\n    const context = subselect.some(s => s.some(isTraversal)) ? // Used as a placeholder. Will be replaced with the actual element.\n    [PLACEHOLDER_ELEMENT] : undefined;\n    const compiled = compileToken(subselect, opts, context);\n    if (compiled === boolbase.falseFunc) return boolbase.falseFunc;\n    const hasElement = ensureIsTag(compiled, adapter); // If `compiled` is `trueFunc`, we can skip this.\n\n    if (context && compiled !== boolbase.trueFunc) {\n      /*\n       * `shouldTestNextSiblings` will only be true if the query starts with\n       * a traversal (sibling or adjacent). That means we will always have a context.\n       */\n      const {\n        shouldTestNextSiblings = false\n      } = compiled;\n      return elem => {\n        if (!next(elem)) return false;\n        context[0] = elem;\n        const childs = adapter.getChildren(elem);\n        const nextElements = shouldTestNextSiblings ? [...childs, ...getNextSiblings(elem, adapter)] : childs;\n        return adapter.existsOne(hasElement, nextElements);\n      };\n    }\n\n    return elem => next(elem) && adapter.existsOne(hasElement, adapter.getChildren(elem));\n  }\n\n};","map":{"version":3,"mappings":"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","names":["boolbase","isTraversal","PLACEHOLDER_ELEMENT","ensureIsTag","next","adapter","falseFunc","elem","isTag","getNextSiblings","siblings","getSiblings","length","elemIndex","indexOf","slice","filter","copyOptions","options","xmlMode","lowerCaseAttributeNames","lowerCaseTags","quirksMode","cacheResults","pseudos","equals","is","token","context","compileToken","func","trueFunc","subselects","matches","where","not","has","subselect","_context","opts","relativeSelector","some","s","undefined","compiled","hasElement","shouldTestNextSiblings","childs","getChildren","nextElements","existsOne"],"sourceRoot":"https://raw.githubusercontent.com/fb55/css-select/0f0725a9dfeddd2fdb54eda9656cdbab5bbf6be6/src/","sources":["pseudo-selectors/subselects.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}