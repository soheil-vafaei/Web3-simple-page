{"ast":null,"code":"const debug = require(\"debug\")(\"contract:promievent\");\n\nconst DebugUtils = require(\"@truffle/debug-utils\");\n\nconst Web3PromiEvent = require(\"web3-core-promievent\");\n\nfunction PromiEvent(justPromise) {\n  let bugger = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;\n  let isDeploy = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  const {\n    resolve,\n    reject,\n    eventEmitter\n  } = new Web3PromiEvent(justPromise);\n  const originalStackTrace = new Error().stack;\n\n  function rejectHijacker(e) {\n    debug(\"hijacking!\");\n    debug(\"hash: %s\", this.txHash);\n    let getSolidityStackTrace;\n\n    if (bugger && this.txHash) {\n      debug(\"debugging time!\");\n\n      getSolidityStackTrace = async () => {\n        try {\n          await bugger.load(this.txHash);\n          await bugger.runToEnd();\n          const report = bugger.stacktrace();\n          await bugger.unload();\n          return DebugUtils.formatStacktrace(report, 4); //indent 4 to match node's stacktraces\n        } catch (_) {\n          //ignore errors\n          return undefined;\n        }\n      };\n    } else {\n      getSolidityStackTrace = async () => undefined;\n    }\n\n    getSolidityStackTrace().then(solidityStackTrace => {\n      debug(\"e.stack: %s\", e.stack);\n      debug(\"originalStackTrace: %s\", originalStackTrace);\n      debug(\"solidityStackTrace: %s\", solidityStackTrace);\n      const initialLinesRegexp = isDeploy ? /^.*\\n.*\\n.*\\n.*/ //first 4 lines (note . does not include \\n)\n      : /^.*\\n.*\\n.*/; //first 3 lines\n      //we replace not just the first line but also the next 2 as they contain\n      //useless stuff users shouldn't see; in case of deployments there's one\n      //additional to remove\n\n      try {\n        let stackTrace = originalStackTrace.replace(initialLinesRegexp, e.stack.split(\"\\n\")[0]);\n\n        if (solidityStackTrace) {\n          //let's split the solidity stack trace into first line & rest\n          let [_, solidityFirstLine, solidityRemaining] = solidityStackTrace.match(/^(.*?)\\r?\\n((.|\\r|\\n)*)$/);\n          stackTrace = stackTrace.replace(/^.*/, //note that . does not include \\n\n          solidityRemaining //note: this does not end in \\n, so no modification needed\n          );\n          e.hijackedMessage = e.message;\n          e.message = solidityFirstLine;\n        }\n\n        e.hijackedStack = e.stack;\n        e.stack = stackTrace;\n      } catch (_) {//again, ignore errors\n        //(not sure how this can happen here but I'll leave this block here)\n      }\n\n      reject(e);\n    });\n  }\n\n  this.resolve = resolve;\n  this.reject = rejectHijacker.bind(this);\n  this.eventEmitter = eventEmitter;\n\n  if (bugger) {\n    this.debug = true;\n  }\n}\n\nPromiEvent.resolve = Web3PromiEvent.resolve;\n\nPromiEvent.prototype.setTransactionHash = function (txHash) {\n  debug(\"setting!\");\n  debug(\"hash: %s\", txHash);\n  this.txHash = txHash;\n};\n\nmodule.exports = PromiEvent;","map":{"version":3,"names":["debug","require","DebugUtils","Web3PromiEvent","PromiEvent","justPromise","bugger","undefined","isDeploy","resolve","reject","eventEmitter","originalStackTrace","Error","stack","rejectHijacker","e","txHash","getSolidityStackTrace","load","runToEnd","report","stacktrace","unload","formatStacktrace","_","then","solidityStackTrace","initialLinesRegexp","stackTrace","replace","split","solidityFirstLine","solidityRemaining","match","hijackedMessage","message","hijackedStack","bind","prototype","setTransactionHash","module","exports"],"sources":["/Users/soheilvafaei/Documents/project/web/resume/ex7/node_modules/@truffle/contract/lib/promievent.js"],"sourcesContent":["const debug = require(\"debug\")(\"contract:promievent\");\nconst DebugUtils = require(\"@truffle/debug-utils\");\nconst Web3PromiEvent = require(\"web3-core-promievent\");\n\nfunction PromiEvent(justPromise, bugger = undefined, isDeploy = false) {\n  const { resolve, reject, eventEmitter } = new Web3PromiEvent(justPromise);\n\n  const originalStackTrace = new Error().stack;\n\n  function rejectHijacker(e) {\n    debug(\"hijacking!\");\n    debug(\"hash: %s\", this.txHash);\n    let getSolidityStackTrace;\n    if (bugger && this.txHash) {\n      debug(\"debugging time!\");\n      getSolidityStackTrace = async () => {\n        try {\n          await bugger.load(this.txHash);\n          await bugger.runToEnd();\n          const report = bugger.stacktrace();\n          await bugger.unload();\n          return DebugUtils.formatStacktrace(report, 4); //indent 4 to match node's stacktraces\n        } catch (_) {\n          //ignore errors\n          return undefined;\n        }\n      };\n    } else {\n      getSolidityStackTrace = async () => undefined;\n    }\n\n    getSolidityStackTrace().then((solidityStackTrace) => {\n      debug(\"e.stack: %s\", e.stack);\n      debug(\"originalStackTrace: %s\", originalStackTrace);\n      debug(\"solidityStackTrace: %s\", solidityStackTrace);\n      const initialLinesRegexp = isDeploy\n        ? /^.*\\n.*\\n.*\\n.*/ //first 4 lines (note . does not include \\n)\n        : /^.*\\n.*\\n.*/; //first 3 lines\n      //we replace not just the first line but also the next 2 as they contain\n      //useless stuff users shouldn't see; in case of deployments there's one\n      //additional to remove\n      try {\n        let stackTrace = originalStackTrace.replace(\n          initialLinesRegexp,\n          e.stack.split(\"\\n\")[0]\n        );\n        if (solidityStackTrace) {\n          //let's split the solidity stack trace into first line & rest\n          let [\n            _,\n            solidityFirstLine,\n            solidityRemaining,\n          ] = solidityStackTrace.match(/^(.*?)\\r?\\n((.|\\r|\\n)*)$/);\n\n          stackTrace = stackTrace.replace(\n            /^.*/, //note that . does not include \\n\n            solidityRemaining //note: this does not end in \\n, so no modification needed\n          );\n          e.hijackedMessage = e.message;\n          e.message = solidityFirstLine;\n        }\n\n        e.hijackedStack = e.stack;\n        e.stack = stackTrace;\n      } catch (_) {\n        //again, ignore errors\n        //(not sure how this can happen here but I'll leave this block here)\n      }\n      reject(e);\n    });\n  }\n\n  this.resolve = resolve;\n  this.reject = rejectHijacker.bind(this);\n  this.eventEmitter = eventEmitter;\n  if (bugger) {\n    this.debug = true;\n  }\n}\n\nPromiEvent.resolve = Web3PromiEvent.resolve;\n\nPromiEvent.prototype.setTransactionHash = function (txHash) {\n  debug(\"setting!\");\n  debug(\"hash: %s\", txHash);\n  this.txHash = txHash;\n};\n\nmodule.exports = PromiEvent;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}