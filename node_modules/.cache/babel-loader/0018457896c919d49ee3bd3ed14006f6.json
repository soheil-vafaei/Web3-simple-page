{"ast":null,"code":"import { Tokenizer, TokenizerMode } from '../tokenizer/index.js';\nimport { OpenElementStack } from './open-element-stack.js';\nimport { FormattingElementList, EntryType } from './formatting-element-list.js';\nimport { defaultTreeAdapter } from '../tree-adapters/default.js';\nimport * as doctype from '../common/doctype.js';\nimport * as foreignContent from '../common/foreign-content.js';\nimport { ERR } from '../common/error-codes.js';\nimport * as unicode from '../common/unicode.js';\nimport { TAG_ID as $, TAG_NAMES as TN, NS, ATTRS, SPECIAL_ELEMENTS, DOCUMENT_MODE, isNumberedHeader, getTagID } from '../common/html.js';\nimport { TokenType, getTokenAttr } from '../common/token.js'; //Misc constants\n\nconst HIDDEN_INPUT_TYPE = 'hidden'; //Adoption agency loops iteration count\n\nconst AA_OUTER_LOOP_ITER = 8;\nconst AA_INNER_LOOP_ITER = 3; //Insertion modes\n\nvar InsertionMode;\n\n(function (InsertionMode) {\n  InsertionMode[InsertionMode[\"INITIAL\"] = 0] = \"INITIAL\";\n  InsertionMode[InsertionMode[\"BEFORE_HTML\"] = 1] = \"BEFORE_HTML\";\n  InsertionMode[InsertionMode[\"BEFORE_HEAD\"] = 2] = \"BEFORE_HEAD\";\n  InsertionMode[InsertionMode[\"IN_HEAD\"] = 3] = \"IN_HEAD\";\n  InsertionMode[InsertionMode[\"IN_HEAD_NO_SCRIPT\"] = 4] = \"IN_HEAD_NO_SCRIPT\";\n  InsertionMode[InsertionMode[\"AFTER_HEAD\"] = 5] = \"AFTER_HEAD\";\n  InsertionMode[InsertionMode[\"IN_BODY\"] = 6] = \"IN_BODY\";\n  InsertionMode[InsertionMode[\"TEXT\"] = 7] = \"TEXT\";\n  InsertionMode[InsertionMode[\"IN_TABLE\"] = 8] = \"IN_TABLE\";\n  InsertionMode[InsertionMode[\"IN_TABLE_TEXT\"] = 9] = \"IN_TABLE_TEXT\";\n  InsertionMode[InsertionMode[\"IN_CAPTION\"] = 10] = \"IN_CAPTION\";\n  InsertionMode[InsertionMode[\"IN_COLUMN_GROUP\"] = 11] = \"IN_COLUMN_GROUP\";\n  InsertionMode[InsertionMode[\"IN_TABLE_BODY\"] = 12] = \"IN_TABLE_BODY\";\n  InsertionMode[InsertionMode[\"IN_ROW\"] = 13] = \"IN_ROW\";\n  InsertionMode[InsertionMode[\"IN_CELL\"] = 14] = \"IN_CELL\";\n  InsertionMode[InsertionMode[\"IN_SELECT\"] = 15] = \"IN_SELECT\";\n  InsertionMode[InsertionMode[\"IN_SELECT_IN_TABLE\"] = 16] = \"IN_SELECT_IN_TABLE\";\n  InsertionMode[InsertionMode[\"IN_TEMPLATE\"] = 17] = \"IN_TEMPLATE\";\n  InsertionMode[InsertionMode[\"AFTER_BODY\"] = 18] = \"AFTER_BODY\";\n  InsertionMode[InsertionMode[\"IN_FRAMESET\"] = 19] = \"IN_FRAMESET\";\n  InsertionMode[InsertionMode[\"AFTER_FRAMESET\"] = 20] = \"AFTER_FRAMESET\";\n  InsertionMode[InsertionMode[\"AFTER_AFTER_BODY\"] = 21] = \"AFTER_AFTER_BODY\";\n  InsertionMode[InsertionMode[\"AFTER_AFTER_FRAMESET\"] = 22] = \"AFTER_AFTER_FRAMESET\";\n})(InsertionMode || (InsertionMode = {}));\n\nconst BASE_LOC = {\n  startLine: -1,\n  startCol: -1,\n  startOffset: -1,\n  endLine: -1,\n  endCol: -1,\n  endOffset: -1\n};\nconst TABLE_STRUCTURE_TAGS = new Set([$.TABLE, $.TBODY, $.TFOOT, $.THEAD, $.TR]);\nconst defaultParserOptions = {\n  scriptingEnabled: true,\n  sourceCodeLocationInfo: false,\n  treeAdapter: defaultTreeAdapter,\n  onParseError: null\n}; //Parser\n\nexport class Parser {\n  constructor(options, document) {\n    let fragmentContext = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    let scriptHandler = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n    this.fragmentContext = fragmentContext;\n    this.scriptHandler = scriptHandler;\n    this.currentToken = null;\n    this.stopped = false;\n    this.insertionMode = InsertionMode.INITIAL;\n    this.originalInsertionMode = InsertionMode.INITIAL;\n    this.headElement = null;\n    this.formElement = null;\n    /** Indicates that the current node is not an element in the HTML namespace */\n\n    this.currentNotInHTML = false;\n    /**\n     * The template insertion mode stack is maintained from the left.\n     * Ie. the topmost element will always have index 0.\n     */\n\n    this.tmplInsertionModeStack = [];\n    this.pendingCharacterTokens = [];\n    this.hasNonWhitespacePendingCharacterToken = false;\n    this.framesetOk = true;\n    this.skipNextNewLine = false;\n    this.fosterParentingEnabled = false;\n    this.options = { ...defaultParserOptions,\n      ...options\n    };\n    this.treeAdapter = this.options.treeAdapter;\n    this.onParseError = this.options.onParseError; // Always enable location info if we report parse errors.\n\n    if (this.onParseError) {\n      this.options.sourceCodeLocationInfo = true;\n    }\n\n    this.document = document !== null && document !== void 0 ? document : this.treeAdapter.createDocument();\n    this.tokenizer = new Tokenizer(this.options, this);\n    this.activeFormattingElements = new FormattingElementList(this.treeAdapter);\n    this.fragmentContextID = fragmentContext ? getTagID(this.treeAdapter.getTagName(fragmentContext)) : $.UNKNOWN;\n\n    this._setContextModes(fragmentContext !== null && fragmentContext !== void 0 ? fragmentContext : this.document, this.fragmentContextID);\n\n    this.openElements = new OpenElementStack(this.document, this.treeAdapter, this);\n  } // API\n\n\n  static parse(html, options) {\n    const parser = new this(options);\n    parser.tokenizer.write(html, true);\n    return parser.document;\n  }\n\n  static getFragmentParser(fragmentContext, options) {\n    const opts = { ...defaultParserOptions,\n      ...options\n    }; //NOTE: use a <template> element as the fragment context if no context element was provided,\n    //so we will parse in a \"forgiving\" manner\n\n    fragmentContext !== null && fragmentContext !== void 0 ? fragmentContext : fragmentContext = opts.treeAdapter.createElement(TN.TEMPLATE, NS.HTML, []); //NOTE: create a fake element which will be used as the `document` for fragment parsing.\n    //This is important for jsdom, where a new `document` cannot be created. This led to\n    //fragment parsing messing with the main `document`.\n\n    const documentMock = opts.treeAdapter.createElement('documentmock', NS.HTML, []);\n    const parser = new this(opts, documentMock, fragmentContext);\n\n    if (parser.fragmentContextID === $.TEMPLATE) {\n      parser.tmplInsertionModeStack.unshift(InsertionMode.IN_TEMPLATE);\n    }\n\n    parser._initTokenizerForFragmentParsing();\n\n    parser._insertFakeRootElement();\n\n    parser._resetInsertionMode();\n\n    parser._findFormInFragmentContext();\n\n    return parser;\n  }\n\n  getFragment() {\n    const rootElement = this.treeAdapter.getFirstChild(this.document);\n    const fragment = this.treeAdapter.createDocumentFragment();\n\n    this._adoptNodes(rootElement, fragment);\n\n    return fragment;\n  } //Errors\n\n\n  _err(token, code, beforeToken) {\n    var _a;\n\n    if (!this.onParseError) return;\n    const loc = (_a = token.location) !== null && _a !== void 0 ? _a : BASE_LOC;\n    const err = {\n      code,\n      startLine: loc.startLine,\n      startCol: loc.startCol,\n      startOffset: loc.startOffset,\n      endLine: beforeToken ? loc.startLine : loc.endLine,\n      endCol: beforeToken ? loc.startCol : loc.endCol,\n      endOffset: beforeToken ? loc.startOffset : loc.endOffset\n    };\n    this.onParseError(err);\n  } //Stack events\n\n\n  onItemPush(node, tid, isTop) {\n    var _a, _b;\n\n    (_b = (_a = this.treeAdapter).onItemPush) === null || _b === void 0 ? void 0 : _b.call(_a, node);\n    if (isTop && this.openElements.stackTop > 0) this._setContextModes(node, tid);\n  }\n\n  onItemPop(node, isTop) {\n    var _a, _b;\n\n    if (this.options.sourceCodeLocationInfo) {\n      this._setEndLocation(node, this.currentToken);\n    }\n\n    (_b = (_a = this.treeAdapter).onItemPop) === null || _b === void 0 ? void 0 : _b.call(_a, node, this.openElements.current);\n\n    if (isTop) {\n      let current;\n      let currentTagId;\n\n      if (this.openElements.stackTop === 0 && this.fragmentContext) {\n        current = this.fragmentContext;\n        currentTagId = this.fragmentContextID;\n      } else {\n        ({\n          current,\n          currentTagId\n        } = this.openElements);\n      }\n\n      this._setContextModes(current, currentTagId);\n    }\n  }\n\n  _setContextModes(current, tid) {\n    const isHTML = current === this.document || this.treeAdapter.getNamespaceURI(current) === NS.HTML;\n    this.currentNotInHTML = !isHTML;\n    this.tokenizer.inForeignNode = !isHTML && !this._isIntegrationPoint(tid, current);\n  }\n\n  _switchToTextParsing(currentToken, nextTokenizerState) {\n    this._insertElement(currentToken, NS.HTML);\n\n    this.tokenizer.state = nextTokenizerState;\n    this.originalInsertionMode = this.insertionMode;\n    this.insertionMode = InsertionMode.TEXT;\n  }\n\n  switchToPlaintextParsing() {\n    this.insertionMode = InsertionMode.TEXT;\n    this.originalInsertionMode = InsertionMode.IN_BODY;\n    this.tokenizer.state = TokenizerMode.PLAINTEXT;\n  } //Fragment parsing\n\n\n  _getAdjustedCurrentElement() {\n    return this.openElements.stackTop === 0 && this.fragmentContext ? this.fragmentContext : this.openElements.current;\n  }\n\n  _findFormInFragmentContext() {\n    let node = this.fragmentContext;\n\n    while (node) {\n      if (this.treeAdapter.getTagName(node) === TN.FORM) {\n        this.formElement = node;\n        break;\n      }\n\n      node = this.treeAdapter.getParentNode(node);\n    }\n  }\n\n  _initTokenizerForFragmentParsing() {\n    if (!this.fragmentContext || this.treeAdapter.getNamespaceURI(this.fragmentContext) !== NS.HTML) {\n      return;\n    }\n\n    switch (this.fragmentContextID) {\n      case $.TITLE:\n      case $.TEXTAREA:\n        {\n          this.tokenizer.state = TokenizerMode.RCDATA;\n          break;\n        }\n\n      case $.STYLE:\n      case $.XMP:\n      case $.IFRAME:\n      case $.NOEMBED:\n      case $.NOFRAMES:\n      case $.NOSCRIPT:\n        {\n          this.tokenizer.state = TokenizerMode.RAWTEXT;\n          break;\n        }\n\n      case $.SCRIPT:\n        {\n          this.tokenizer.state = TokenizerMode.SCRIPT_DATA;\n          break;\n        }\n\n      case $.PLAINTEXT:\n        {\n          this.tokenizer.state = TokenizerMode.PLAINTEXT;\n          break;\n        }\n\n      default: // Do nothing\n\n    }\n  } //Tree mutation\n\n\n  _setDocumentType(token) {\n    const name = token.name || '';\n    const publicId = token.publicId || '';\n    const systemId = token.systemId || '';\n    this.treeAdapter.setDocumentType(this.document, name, publicId, systemId);\n\n    if (token.location) {\n      const documentChildren = this.treeAdapter.getChildNodes(this.document);\n      const docTypeNode = documentChildren.find(node => this.treeAdapter.isDocumentTypeNode(node));\n\n      if (docTypeNode) {\n        this.treeAdapter.setNodeSourceCodeLocation(docTypeNode, token.location);\n      }\n    }\n  }\n\n  _attachElementToTree(element, location) {\n    if (this.options.sourceCodeLocationInfo) {\n      const loc = location && { ...location,\n        startTag: location\n      };\n      this.treeAdapter.setNodeSourceCodeLocation(element, loc);\n    }\n\n    if (this._shouldFosterParentOnInsertion()) {\n      this._fosterParentElement(element);\n    } else {\n      const parent = this.openElements.currentTmplContentOrNode;\n      this.treeAdapter.appendChild(parent, element);\n    }\n  }\n\n  _appendElement(token, namespaceURI) {\n    const element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n\n    this._attachElementToTree(element, token.location);\n  }\n\n  _insertElement(token, namespaceURI) {\n    const element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n\n    this._attachElementToTree(element, token.location);\n\n    this.openElements.push(element, token.tagID);\n  }\n\n  _insertFakeElement(tagName, tagID) {\n    const element = this.treeAdapter.createElement(tagName, NS.HTML, []);\n\n    this._attachElementToTree(element, null);\n\n    this.openElements.push(element, tagID);\n  }\n\n  _insertTemplate(token) {\n    const tmpl = this.treeAdapter.createElement(token.tagName, NS.HTML, token.attrs);\n    const content = this.treeAdapter.createDocumentFragment();\n    this.treeAdapter.setTemplateContent(tmpl, content);\n\n    this._attachElementToTree(tmpl, token.location);\n\n    this.openElements.push(tmpl, token.tagID);\n    if (this.options.sourceCodeLocationInfo) this.treeAdapter.setNodeSourceCodeLocation(content, null);\n  }\n\n  _insertFakeRootElement() {\n    const element = this.treeAdapter.createElement(TN.HTML, NS.HTML, []);\n    if (this.options.sourceCodeLocationInfo) this.treeAdapter.setNodeSourceCodeLocation(element, null);\n    this.treeAdapter.appendChild(this.openElements.current, element);\n    this.openElements.push(element, $.HTML);\n  }\n\n  _appendCommentNode(token, parent) {\n    const commentNode = this.treeAdapter.createCommentNode(token.data);\n    this.treeAdapter.appendChild(parent, commentNode);\n\n    if (this.options.sourceCodeLocationInfo) {\n      this.treeAdapter.setNodeSourceCodeLocation(commentNode, token.location);\n    }\n  }\n\n  _insertCharacters(token) {\n    let parent;\n    let beforeElement;\n\n    if (this._shouldFosterParentOnInsertion()) {\n      ({\n        parent,\n        beforeElement\n      } = this._findFosterParentingLocation());\n\n      if (beforeElement) {\n        this.treeAdapter.insertTextBefore(parent, token.chars, beforeElement);\n      } else {\n        this.treeAdapter.insertText(parent, token.chars);\n      }\n    } else {\n      parent = this.openElements.currentTmplContentOrNode;\n      this.treeAdapter.insertText(parent, token.chars);\n    }\n\n    if (!token.location) return;\n    const siblings = this.treeAdapter.getChildNodes(parent);\n    const textNodeIdx = beforeElement ? siblings.lastIndexOf(beforeElement) : siblings.length;\n    const textNode = siblings[textNodeIdx - 1]; //NOTE: if we have a location assigned by another token, then just update the end position\n\n    const tnLoc = this.treeAdapter.getNodeSourceCodeLocation(textNode);\n\n    if (tnLoc) {\n      const {\n        endLine,\n        endCol,\n        endOffset\n      } = token.location;\n      this.treeAdapter.updateNodeSourceCodeLocation(textNode, {\n        endLine,\n        endCol,\n        endOffset\n      });\n    } else if (this.options.sourceCodeLocationInfo) {\n      this.treeAdapter.setNodeSourceCodeLocation(textNode, token.location);\n    }\n  }\n\n  _adoptNodes(donor, recipient) {\n    for (let child = this.treeAdapter.getFirstChild(donor); child; child = this.treeAdapter.getFirstChild(donor)) {\n      this.treeAdapter.detachNode(child);\n      this.treeAdapter.appendChild(recipient, child);\n    }\n  }\n\n  _setEndLocation(element, closingToken) {\n    if (this.treeAdapter.getNodeSourceCodeLocation(element) && closingToken.location) {\n      const ctLoc = closingToken.location;\n      const tn = this.treeAdapter.getTagName(element);\n      const endLoc = // NOTE: For cases like <p> <p> </p> - First 'p' closes without a closing\n      // tag and for cases like <td> <p> </td> - 'p' closes without a closing tag.\n      closingToken.type === TokenType.END_TAG && tn === closingToken.tagName ? {\n        endTag: { ...ctLoc\n        },\n        endLine: ctLoc.endLine,\n        endCol: ctLoc.endCol,\n        endOffset: ctLoc.endOffset\n      } : {\n        endLine: ctLoc.startLine,\n        endCol: ctLoc.startCol,\n        endOffset: ctLoc.startOffset\n      };\n      this.treeAdapter.updateNodeSourceCodeLocation(element, endLoc);\n    }\n  } //Token processing\n\n\n  shouldProcessStartTagTokenInForeignContent(token) {\n    // Check that neither current === document, or ns === NS.HTML\n    if (!this.currentNotInHTML) return false;\n    let current;\n    let currentTagId;\n\n    if (this.openElements.stackTop === 0 && this.fragmentContext) {\n      current = this.fragmentContext;\n      currentTagId = this.fragmentContextID;\n    } else {\n      ({\n        current,\n        currentTagId\n      } = this.openElements);\n    }\n\n    if (token.tagID === $.SVG && this.treeAdapter.getTagName(current) === TN.ANNOTATION_XML && this.treeAdapter.getNamespaceURI(current) === NS.MATHML) {\n      return false;\n    }\n\n    return (// Check that `current` is not an integration point for HTML or MathML elements.\n      this.tokenizer.inForeignNode || // If it _is_ an integration point, then we might have to check that it is not an HTML\n      // integration point.\n      (token.tagID === $.MGLYPH || token.tagID === $.MALIGNMARK) && !this._isIntegrationPoint(currentTagId, current, NS.HTML)\n    );\n  }\n\n  _processToken(token) {\n    switch (token.type) {\n      case TokenType.CHARACTER:\n        {\n          this.onCharacter(token);\n          break;\n        }\n\n      case TokenType.NULL_CHARACTER:\n        {\n          this.onNullCharacter(token);\n          break;\n        }\n\n      case TokenType.COMMENT:\n        {\n          this.onComment(token);\n          break;\n        }\n\n      case TokenType.DOCTYPE:\n        {\n          this.onDoctype(token);\n          break;\n        }\n\n      case TokenType.START_TAG:\n        {\n          this._processStartTag(token);\n\n          break;\n        }\n\n      case TokenType.END_TAG:\n        {\n          this.onEndTag(token);\n          break;\n        }\n\n      case TokenType.EOF:\n        {\n          this.onEof(token);\n          break;\n        }\n\n      case TokenType.WHITESPACE_CHARACTER:\n        {\n          this.onWhitespaceCharacter(token);\n          break;\n        }\n    }\n  } //Integration points\n\n\n  _isIntegrationPoint(tid, element, foreignNS) {\n    const ns = this.treeAdapter.getNamespaceURI(element);\n    const attrs = this.treeAdapter.getAttrList(element);\n    return foreignContent.isIntegrationPoint(tid, ns, attrs, foreignNS);\n  } //Active formatting elements reconstruction\n\n\n  _reconstructActiveFormattingElements() {\n    const listLength = this.activeFormattingElements.entries.length;\n\n    if (listLength) {\n      const endIndex = this.activeFormattingElements.entries.findIndex(entry => entry.type === EntryType.Marker || this.openElements.contains(entry.element));\n      const unopenIdx = endIndex < 0 ? listLength - 1 : endIndex - 1;\n\n      for (let i = unopenIdx; i >= 0; i--) {\n        const entry = this.activeFormattingElements.entries[i];\n\n        this._insertElement(entry.token, this.treeAdapter.getNamespaceURI(entry.element));\n\n        entry.element = this.openElements.current;\n      }\n    }\n  } //Close elements\n\n\n  _closeTableCell() {\n    this.openElements.generateImpliedEndTags();\n    this.openElements.popUntilTableCellPopped();\n    this.activeFormattingElements.clearToLastMarker();\n    this.insertionMode = InsertionMode.IN_ROW;\n  }\n\n  _closePElement() {\n    this.openElements.generateImpliedEndTagsWithExclusion($.P);\n    this.openElements.popUntilTagNamePopped($.P);\n  } //Insertion modes\n\n\n  _resetInsertionMode() {\n    for (let i = this.openElements.stackTop; i >= 0; i--) {\n      //Insertion mode reset map\n      switch (i === 0 && this.fragmentContext ? this.fragmentContextID : this.openElements.tagIDs[i]) {\n        case $.TR:\n          this.insertionMode = InsertionMode.IN_ROW;\n          return;\n\n        case $.TBODY:\n        case $.THEAD:\n        case $.TFOOT:\n          this.insertionMode = InsertionMode.IN_TABLE_BODY;\n          return;\n\n        case $.CAPTION:\n          this.insertionMode = InsertionMode.IN_CAPTION;\n          return;\n\n        case $.COLGROUP:\n          this.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n          return;\n\n        case $.TABLE:\n          this.insertionMode = InsertionMode.IN_TABLE;\n          return;\n\n        case $.BODY:\n          this.insertionMode = InsertionMode.IN_BODY;\n          return;\n\n        case $.FRAMESET:\n          this.insertionMode = InsertionMode.IN_FRAMESET;\n          return;\n\n        case $.SELECT:\n          this._resetInsertionModeForSelect(i);\n\n          return;\n\n        case $.TEMPLATE:\n          this.insertionMode = this.tmplInsertionModeStack[0];\n          return;\n\n        case $.HTML:\n          this.insertionMode = this.headElement ? InsertionMode.AFTER_HEAD : InsertionMode.BEFORE_HEAD;\n          return;\n\n        case $.TD:\n        case $.TH:\n          if (i > 0) {\n            this.insertionMode = InsertionMode.IN_CELL;\n            return;\n          }\n\n          break;\n\n        case $.HEAD:\n          if (i > 0) {\n            this.insertionMode = InsertionMode.IN_HEAD;\n            return;\n          }\n\n          break;\n      }\n    }\n\n    this.insertionMode = InsertionMode.IN_BODY;\n  }\n\n  _resetInsertionModeForSelect(selectIdx) {\n    if (selectIdx > 0) {\n      for (let i = selectIdx - 1; i > 0; i--) {\n        const tn = this.openElements.tagIDs[i];\n\n        if (tn === $.TEMPLATE) {\n          break;\n        } else if (tn === $.TABLE) {\n          this.insertionMode = InsertionMode.IN_SELECT_IN_TABLE;\n          return;\n        }\n      }\n    }\n\n    this.insertionMode = InsertionMode.IN_SELECT;\n  } //Foster parenting\n\n\n  _isElementCausesFosterParenting(tn) {\n    return TABLE_STRUCTURE_TAGS.has(tn);\n  }\n\n  _shouldFosterParentOnInsertion() {\n    return this.fosterParentingEnabled && this._isElementCausesFosterParenting(this.openElements.currentTagId);\n  }\n\n  _findFosterParentingLocation() {\n    for (let i = this.openElements.stackTop; i >= 0; i--) {\n      const openElement = this.openElements.items[i];\n\n      switch (this.openElements.tagIDs[i]) {\n        case $.TEMPLATE:\n          if (this.treeAdapter.getNamespaceURI(openElement) === NS.HTML) {\n            return {\n              parent: this.treeAdapter.getTemplateContent(openElement),\n              beforeElement: null\n            };\n          }\n\n          break;\n\n        case $.TABLE:\n          {\n            const parent = this.treeAdapter.getParentNode(openElement);\n\n            if (parent) {\n              return {\n                parent,\n                beforeElement: openElement\n              };\n            }\n\n            return {\n              parent: this.openElements.items[i - 1],\n              beforeElement: null\n            };\n          }\n\n        default: // Do nothing\n\n      }\n    }\n\n    return {\n      parent: this.openElements.items[0],\n      beforeElement: null\n    };\n  }\n\n  _fosterParentElement(element) {\n    const location = this._findFosterParentingLocation();\n\n    if (location.beforeElement) {\n      this.treeAdapter.insertBefore(location.parent, element, location.beforeElement);\n    } else {\n      this.treeAdapter.appendChild(location.parent, element);\n    }\n  } //Special elements\n\n\n  _isSpecialElement(element, id) {\n    const ns = this.treeAdapter.getNamespaceURI(element);\n    return SPECIAL_ELEMENTS[ns].has(id);\n  }\n\n  onCharacter(token) {\n    this.skipNextNewLine = false;\n\n    if (this.tokenizer.inForeignNode) {\n      characterInForeignContent(this, token);\n      return;\n    }\n\n    switch (this.insertionMode) {\n      case InsertionMode.INITIAL:\n        tokenInInitialMode(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HTML:\n        tokenBeforeHtml(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HEAD:\n        tokenBeforeHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD:\n        tokenInHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n        tokenInHeadNoScript(this, token);\n        break;\n\n      case InsertionMode.AFTER_HEAD:\n        tokenAfterHead(this, token);\n        break;\n\n      case InsertionMode.IN_BODY:\n      case InsertionMode.IN_CAPTION:\n      case InsertionMode.IN_CELL:\n      case InsertionMode.IN_TEMPLATE:\n        characterInBody(this, token);\n        break;\n\n      case InsertionMode.TEXT:\n      case InsertionMode.IN_SELECT:\n      case InsertionMode.IN_SELECT_IN_TABLE:\n        this._insertCharacters(token);\n\n        break;\n\n      case InsertionMode.IN_TABLE:\n      case InsertionMode.IN_TABLE_BODY:\n      case InsertionMode.IN_ROW:\n        characterInTable(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_TEXT:\n        characterInTableText(this, token);\n        break;\n\n      case InsertionMode.IN_COLUMN_GROUP:\n        tokenInColumnGroup(this, token);\n        break;\n\n      case InsertionMode.AFTER_BODY:\n        tokenAfterBody(this, token);\n        break;\n\n      case InsertionMode.AFTER_AFTER_BODY:\n        tokenAfterAfterBody(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n  onNullCharacter(token) {\n    this.skipNextNewLine = false;\n\n    if (this.tokenizer.inForeignNode) {\n      nullCharacterInForeignContent(this, token);\n      return;\n    }\n\n    switch (this.insertionMode) {\n      case InsertionMode.INITIAL:\n        tokenInInitialMode(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HTML:\n        tokenBeforeHtml(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HEAD:\n        tokenBeforeHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD:\n        tokenInHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n        tokenInHeadNoScript(this, token);\n        break;\n\n      case InsertionMode.AFTER_HEAD:\n        tokenAfterHead(this, token);\n        break;\n\n      case InsertionMode.TEXT:\n        this._insertCharacters(token);\n\n        break;\n\n      case InsertionMode.IN_TABLE:\n      case InsertionMode.IN_TABLE_BODY:\n      case InsertionMode.IN_ROW:\n        characterInTable(this, token);\n        break;\n\n      case InsertionMode.IN_COLUMN_GROUP:\n        tokenInColumnGroup(this, token);\n        break;\n\n      case InsertionMode.AFTER_BODY:\n        tokenAfterBody(this, token);\n        break;\n\n      case InsertionMode.AFTER_AFTER_BODY:\n        tokenAfterAfterBody(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n  onComment(token) {\n    this.skipNextNewLine = false;\n\n    if (this.currentNotInHTML) {\n      appendComment(this, token);\n      return;\n    }\n\n    switch (this.insertionMode) {\n      case InsertionMode.INITIAL:\n      case InsertionMode.BEFORE_HTML:\n      case InsertionMode.BEFORE_HEAD:\n      case InsertionMode.IN_HEAD:\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n      case InsertionMode.AFTER_HEAD:\n      case InsertionMode.IN_BODY:\n      case InsertionMode.IN_TABLE:\n      case InsertionMode.IN_CAPTION:\n      case InsertionMode.IN_COLUMN_GROUP:\n      case InsertionMode.IN_TABLE_BODY:\n      case InsertionMode.IN_ROW:\n      case InsertionMode.IN_CELL:\n      case InsertionMode.IN_SELECT:\n      case InsertionMode.IN_SELECT_IN_TABLE:\n      case InsertionMode.IN_TEMPLATE:\n      case InsertionMode.IN_FRAMESET:\n      case InsertionMode.AFTER_FRAMESET:\n        appendComment(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_TEXT:\n        tokenInTableText(this, token);\n        break;\n\n      case InsertionMode.AFTER_BODY:\n        appendCommentToRootHtmlElement(this, token);\n        break;\n\n      case InsertionMode.AFTER_AFTER_BODY:\n      case InsertionMode.AFTER_AFTER_FRAMESET:\n        appendCommentToDocument(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n  onDoctype(token) {\n    this.skipNextNewLine = false;\n\n    switch (this.insertionMode) {\n      case InsertionMode.INITIAL:\n        doctypeInInitialMode(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HEAD:\n      case InsertionMode.IN_HEAD:\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n      case InsertionMode.AFTER_HEAD:\n        this._err(token, ERR.misplacedDoctype);\n\n        break;\n\n      case InsertionMode.IN_TABLE_TEXT:\n        tokenInTableText(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n  onStartTag(token) {\n    this.skipNextNewLine = false;\n    this.currentToken = token;\n\n    this._processStartTag(token);\n\n    if (token.selfClosing && !token.ackSelfClosing) {\n      this._err(token, ERR.nonVoidHtmlElementStartTagWithTrailingSolidus);\n    }\n  }\n  /**\n   * Processes a given start tag.\n   *\n   * `onStartTag` checks if a self-closing tag was recognized. When a token\n   * is moved inbetween multiple insertion modes, this check for self-closing\n   * could lead to false positives. To avoid this, `_processStartTag` is used\n   * for nested calls.\n   *\n   * @param token The token to process.\n   */\n\n\n  _processStartTag(token) {\n    if (this.shouldProcessStartTagTokenInForeignContent(token)) {\n      startTagInForeignContent(this, token);\n    } else {\n      this._startTagOutsideForeignContent(token);\n    }\n  }\n\n  _startTagOutsideForeignContent(token) {\n    switch (this.insertionMode) {\n      case InsertionMode.INITIAL:\n        tokenInInitialMode(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HTML:\n        startTagBeforeHtml(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HEAD:\n        startTagBeforeHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD:\n        startTagInHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n        startTagInHeadNoScript(this, token);\n        break;\n\n      case InsertionMode.AFTER_HEAD:\n        startTagAfterHead(this, token);\n        break;\n\n      case InsertionMode.IN_BODY:\n        startTagInBody(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE:\n        startTagInTable(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_TEXT:\n        tokenInTableText(this, token);\n        break;\n\n      case InsertionMode.IN_CAPTION:\n        startTagInCaption(this, token);\n        break;\n\n      case InsertionMode.IN_COLUMN_GROUP:\n        startTagInColumnGroup(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_BODY:\n        startTagInTableBody(this, token);\n        break;\n\n      case InsertionMode.IN_ROW:\n        startTagInRow(this, token);\n        break;\n\n      case InsertionMode.IN_CELL:\n        startTagInCell(this, token);\n        break;\n\n      case InsertionMode.IN_SELECT:\n        startTagInSelect(this, token);\n        break;\n\n      case InsertionMode.IN_SELECT_IN_TABLE:\n        startTagInSelectInTable(this, token);\n        break;\n\n      case InsertionMode.IN_TEMPLATE:\n        startTagInTemplate(this, token);\n        break;\n\n      case InsertionMode.AFTER_BODY:\n        startTagAfterBody(this, token);\n        break;\n\n      case InsertionMode.IN_FRAMESET:\n        startTagInFrameset(this, token);\n        break;\n\n      case InsertionMode.AFTER_FRAMESET:\n        startTagAfterFrameset(this, token);\n        break;\n\n      case InsertionMode.AFTER_AFTER_BODY:\n        startTagAfterAfterBody(this, token);\n        break;\n\n      case InsertionMode.AFTER_AFTER_FRAMESET:\n        startTagAfterAfterFrameset(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n  onEndTag(token) {\n    this.skipNextNewLine = false;\n    this.currentToken = token;\n\n    if (this.currentNotInHTML) {\n      endTagInForeignContent(this, token);\n    } else {\n      this._endTagOutsideForeignContent(token);\n    }\n  }\n\n  _endTagOutsideForeignContent(token) {\n    switch (this.insertionMode) {\n      case InsertionMode.INITIAL:\n        tokenInInitialMode(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HTML:\n        endTagBeforeHtml(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HEAD:\n        endTagBeforeHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD:\n        endTagInHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n        endTagInHeadNoScript(this, token);\n        break;\n\n      case InsertionMode.AFTER_HEAD:\n        endTagAfterHead(this, token);\n        break;\n\n      case InsertionMode.IN_BODY:\n        endTagInBody(this, token);\n        break;\n\n      case InsertionMode.TEXT:\n        endTagInText(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE:\n        endTagInTable(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_TEXT:\n        tokenInTableText(this, token);\n        break;\n\n      case InsertionMode.IN_CAPTION:\n        endTagInCaption(this, token);\n        break;\n\n      case InsertionMode.IN_COLUMN_GROUP:\n        endTagInColumnGroup(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_BODY:\n        endTagInTableBody(this, token);\n        break;\n\n      case InsertionMode.IN_ROW:\n        endTagInRow(this, token);\n        break;\n\n      case InsertionMode.IN_CELL:\n        endTagInCell(this, token);\n        break;\n\n      case InsertionMode.IN_SELECT:\n        endTagInSelect(this, token);\n        break;\n\n      case InsertionMode.IN_SELECT_IN_TABLE:\n        endTagInSelectInTable(this, token);\n        break;\n\n      case InsertionMode.IN_TEMPLATE:\n        endTagInTemplate(this, token);\n        break;\n\n      case InsertionMode.AFTER_BODY:\n        endTagAfterBody(this, token);\n        break;\n\n      case InsertionMode.IN_FRAMESET:\n        endTagInFrameset(this, token);\n        break;\n\n      case InsertionMode.AFTER_FRAMESET:\n        endTagAfterFrameset(this, token);\n        break;\n\n      case InsertionMode.AFTER_AFTER_BODY:\n        tokenAfterAfterBody(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n  onEof(token) {\n    switch (this.insertionMode) {\n      case InsertionMode.INITIAL:\n        tokenInInitialMode(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HTML:\n        tokenBeforeHtml(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HEAD:\n        tokenBeforeHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD:\n        tokenInHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n        tokenInHeadNoScript(this, token);\n        break;\n\n      case InsertionMode.AFTER_HEAD:\n        tokenAfterHead(this, token);\n        break;\n\n      case InsertionMode.IN_BODY:\n      case InsertionMode.IN_TABLE:\n      case InsertionMode.IN_CAPTION:\n      case InsertionMode.IN_COLUMN_GROUP:\n      case InsertionMode.IN_TABLE_BODY:\n      case InsertionMode.IN_ROW:\n      case InsertionMode.IN_CELL:\n      case InsertionMode.IN_SELECT:\n      case InsertionMode.IN_SELECT_IN_TABLE:\n        eofInBody(this, token);\n        break;\n\n      case InsertionMode.TEXT:\n        eofInText(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_TEXT:\n        tokenInTableText(this, token);\n        break;\n\n      case InsertionMode.IN_TEMPLATE:\n        eofInTemplate(this, token);\n        break;\n\n      case InsertionMode.AFTER_BODY:\n      case InsertionMode.IN_FRAMESET:\n      case InsertionMode.AFTER_FRAMESET:\n      case InsertionMode.AFTER_AFTER_BODY:\n      case InsertionMode.AFTER_AFTER_FRAMESET:\n        stopParsing(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n  onWhitespaceCharacter(token) {\n    if (this.skipNextNewLine) {\n      this.skipNextNewLine = false;\n\n      if (token.chars.charCodeAt(0) === unicode.CODE_POINTS.LINE_FEED) {\n        if (token.chars.length === 1) {\n          return;\n        }\n\n        token.chars = token.chars.substr(1);\n      }\n    }\n\n    if (this.tokenizer.inForeignNode) {\n      this._insertCharacters(token);\n\n      return;\n    }\n\n    switch (this.insertionMode) {\n      case InsertionMode.IN_HEAD:\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n      case InsertionMode.AFTER_HEAD:\n      case InsertionMode.TEXT:\n      case InsertionMode.IN_COLUMN_GROUP:\n      case InsertionMode.IN_SELECT:\n      case InsertionMode.IN_SELECT_IN_TABLE:\n      case InsertionMode.IN_FRAMESET:\n      case InsertionMode.AFTER_FRAMESET:\n        this._insertCharacters(token);\n\n        break;\n\n      case InsertionMode.IN_BODY:\n      case InsertionMode.IN_CAPTION:\n      case InsertionMode.IN_CELL:\n      case InsertionMode.IN_TEMPLATE:\n      case InsertionMode.AFTER_BODY:\n      case InsertionMode.AFTER_AFTER_BODY:\n      case InsertionMode.AFTER_AFTER_FRAMESET:\n        whitespaceCharacterInBody(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE:\n      case InsertionMode.IN_TABLE_BODY:\n      case InsertionMode.IN_ROW:\n        characterInTable(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_TEXT:\n        whitespaceCharacterInTableText(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n} //Adoption agency algorithm\n//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html#adoptionAgency)\n//------------------------------------------------------------------\n//Steps 5-8 of the algorithm\n\nfunction aaObtainFormattingElementEntry(p, token) {\n  let formattingElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(token.tagName);\n\n  if (formattingElementEntry) {\n    if (!p.openElements.contains(formattingElementEntry.element)) {\n      p.activeFormattingElements.removeEntry(formattingElementEntry);\n      formattingElementEntry = null;\n    } else if (!p.openElements.hasInScope(token.tagID)) {\n      formattingElementEntry = null;\n    }\n  } else {\n    genericEndTagInBody(p, token);\n  }\n\n  return formattingElementEntry;\n} //Steps 9 and 10 of the algorithm\n\n\nfunction aaObtainFurthestBlock(p, formattingElementEntry) {\n  let furthestBlock = null;\n  let idx = p.openElements.stackTop;\n\n  for (; idx >= 0; idx--) {\n    const element = p.openElements.items[idx];\n\n    if (element === formattingElementEntry.element) {\n      break;\n    }\n\n    if (p._isSpecialElement(element, p.openElements.tagIDs[idx])) {\n      furthestBlock = element;\n    }\n  }\n\n  if (!furthestBlock) {\n    p.openElements.shortenToLength(idx < 0 ? 0 : idx);\n    p.activeFormattingElements.removeEntry(formattingElementEntry);\n  }\n\n  return furthestBlock;\n} //Step 13 of the algorithm\n\n\nfunction aaInnerLoop(p, furthestBlock, formattingElement) {\n  let lastElement = furthestBlock;\n  let nextElement = p.openElements.getCommonAncestor(furthestBlock);\n\n  for (let i = 0, element = nextElement; element !== formattingElement; i++, element = nextElement) {\n    //NOTE: store the next element for the next loop iteration (it may be deleted from the stack by step 9.5)\n    nextElement = p.openElements.getCommonAncestor(element);\n    const elementEntry = p.activeFormattingElements.getElementEntry(element);\n    const counterOverflow = elementEntry && i >= AA_INNER_LOOP_ITER;\n    const shouldRemoveFromOpenElements = !elementEntry || counterOverflow;\n\n    if (shouldRemoveFromOpenElements) {\n      if (counterOverflow) {\n        p.activeFormattingElements.removeEntry(elementEntry);\n      }\n\n      p.openElements.remove(element);\n    } else {\n      element = aaRecreateElementFromEntry(p, elementEntry);\n\n      if (lastElement === furthestBlock) {\n        p.activeFormattingElements.bookmark = elementEntry;\n      }\n\n      p.treeAdapter.detachNode(lastElement);\n      p.treeAdapter.appendChild(element, lastElement);\n      lastElement = element;\n    }\n  }\n\n  return lastElement;\n} //Step 13.7 of the algorithm\n\n\nfunction aaRecreateElementFromEntry(p, elementEntry) {\n  const ns = p.treeAdapter.getNamespaceURI(elementEntry.element);\n  const newElement = p.treeAdapter.createElement(elementEntry.token.tagName, ns, elementEntry.token.attrs);\n  p.openElements.replace(elementEntry.element, newElement);\n  elementEntry.element = newElement;\n  return newElement;\n} //Step 14 of the algorithm\n\n\nfunction aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement) {\n  const tn = p.treeAdapter.getTagName(commonAncestor);\n  const tid = getTagID(tn);\n\n  if (p._isElementCausesFosterParenting(tid)) {\n    p._fosterParentElement(lastElement);\n  } else {\n    const ns = p.treeAdapter.getNamespaceURI(commonAncestor);\n\n    if (tid === $.TEMPLATE && ns === NS.HTML) {\n      commonAncestor = p.treeAdapter.getTemplateContent(commonAncestor);\n    }\n\n    p.treeAdapter.appendChild(commonAncestor, lastElement);\n  }\n} //Steps 15-19 of the algorithm\n\n\nfunction aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry) {\n  const ns = p.treeAdapter.getNamespaceURI(formattingElementEntry.element);\n  const {\n    token\n  } = formattingElementEntry;\n  const newElement = p.treeAdapter.createElement(token.tagName, ns, token.attrs);\n\n  p._adoptNodes(furthestBlock, newElement);\n\n  p.treeAdapter.appendChild(furthestBlock, newElement);\n  p.activeFormattingElements.insertElementAfterBookmark(newElement, token);\n  p.activeFormattingElements.removeEntry(formattingElementEntry);\n  p.openElements.remove(formattingElementEntry.element);\n  p.openElements.insertAfter(furthestBlock, newElement, token.tagID);\n} //Algorithm entry point\n\n\nfunction callAdoptionAgency(p, token) {\n  for (let i = 0; i < AA_OUTER_LOOP_ITER; i++) {\n    const formattingElementEntry = aaObtainFormattingElementEntry(p, token);\n\n    if (!formattingElementEntry) {\n      break;\n    }\n\n    const furthestBlock = aaObtainFurthestBlock(p, formattingElementEntry);\n\n    if (!furthestBlock) {\n      break;\n    }\n\n    p.activeFormattingElements.bookmark = formattingElementEntry;\n    const lastElement = aaInnerLoop(p, furthestBlock, formattingElementEntry.element);\n    const commonAncestor = p.openElements.getCommonAncestor(formattingElementEntry.element);\n    p.treeAdapter.detachNode(lastElement);\n    if (commonAncestor) aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement);\n    aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry);\n  }\n} //Generic token handlers\n//------------------------------------------------------------------\n\n\nfunction appendComment(p, token) {\n  p._appendCommentNode(token, p.openElements.currentTmplContentOrNode);\n}\n\nfunction appendCommentToRootHtmlElement(p, token) {\n  p._appendCommentNode(token, p.openElements.items[0]);\n}\n\nfunction appendCommentToDocument(p, token) {\n  p._appendCommentNode(token, p.document);\n}\n\nfunction stopParsing(p, token) {\n  p.stopped = true; // NOTE: Set end locations for elements that remain on the open element stack.\n\n  if (token.location) {\n    // NOTE: If we are not in a fragment, `html` and `body` will stay on the stack.\n    // This is a problem, as we might overwrite their end position here.\n    const target = p.fragmentContext ? 0 : 2;\n\n    for (let i = p.openElements.stackTop; i >= target; i--) {\n      p._setEndLocation(p.openElements.items[i], token);\n    } // Handle `html` and `body`\n\n\n    if (!p.fragmentContext && p.openElements.stackTop >= 0) {\n      const htmlElement = p.openElements.items[0];\n      const htmlLocation = p.treeAdapter.getNodeSourceCodeLocation(htmlElement);\n\n      if (htmlLocation && !htmlLocation.endTag) {\n        p._setEndLocation(htmlElement, token);\n\n        if (p.openElements.stackTop >= 1) {\n          const bodyElement = p.openElements.items[1];\n          const bodyLocation = p.treeAdapter.getNodeSourceCodeLocation(bodyElement);\n\n          if (bodyLocation && !bodyLocation.endTag) {\n            p._setEndLocation(bodyElement, token);\n          }\n        }\n      }\n    }\n  }\n} // The \"initial\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction doctypeInInitialMode(p, token) {\n  p._setDocumentType(token);\n\n  const mode = token.forceQuirks ? DOCUMENT_MODE.QUIRKS : doctype.getDocumentMode(token);\n\n  if (!doctype.isConforming(token)) {\n    p._err(token, ERR.nonConformingDoctype);\n  }\n\n  p.treeAdapter.setDocumentMode(p.document, mode);\n  p.insertionMode = InsertionMode.BEFORE_HTML;\n}\n\nfunction tokenInInitialMode(p, token) {\n  p._err(token, ERR.missingDoctype, true);\n\n  p.treeAdapter.setDocumentMode(p.document, DOCUMENT_MODE.QUIRKS);\n  p.insertionMode = InsertionMode.BEFORE_HTML;\n\n  p._processToken(token);\n} // The \"before html\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagBeforeHtml(p, token) {\n  if (token.tagID === $.HTML) {\n    p._insertElement(token, NS.HTML);\n\n    p.insertionMode = InsertionMode.BEFORE_HEAD;\n  } else {\n    tokenBeforeHtml(p, token);\n  }\n}\n\nfunction endTagBeforeHtml(p, token) {\n  const tn = token.tagID;\n\n  if (tn === $.HTML || tn === $.HEAD || tn === $.BODY || tn === $.BR) {\n    tokenBeforeHtml(p, token);\n  }\n}\n\nfunction tokenBeforeHtml(p, token) {\n  p._insertFakeRootElement();\n\n  p.insertionMode = InsertionMode.BEFORE_HEAD;\n\n  p._processToken(token);\n} // The \"before head\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagBeforeHead(p, token) {\n  switch (token.tagID) {\n    case $.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case $.HEAD:\n      {\n        p._insertElement(token, NS.HTML);\n\n        p.headElement = p.openElements.current;\n        p.insertionMode = InsertionMode.IN_HEAD;\n        break;\n      }\n\n    default:\n      {\n        tokenBeforeHead(p, token);\n      }\n  }\n}\n\nfunction endTagBeforeHead(p, token) {\n  const tn = token.tagID;\n\n  if (tn === $.HEAD || tn === $.BODY || tn === $.HTML || tn === $.BR) {\n    tokenBeforeHead(p, token);\n  } else {\n    p._err(token, ERR.endTagWithoutMatchingOpenElement);\n  }\n}\n\nfunction tokenBeforeHead(p, token) {\n  p._insertFakeElement(TN.HEAD, $.HEAD);\n\n  p.headElement = p.openElements.current;\n  p.insertionMode = InsertionMode.IN_HEAD;\n\n  p._processToken(token);\n} // The \"in head\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInHead(p, token) {\n  switch (token.tagID) {\n    case $.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case $.BASE:\n    case $.BASEFONT:\n    case $.BGSOUND:\n    case $.LINK:\n    case $.META:\n      {\n        p._appendElement(token, NS.HTML);\n\n        token.ackSelfClosing = true;\n        break;\n      }\n\n    case $.TITLE:\n      {\n        p._switchToTextParsing(token, TokenizerMode.RCDATA);\n\n        break;\n      }\n\n    case $.NOSCRIPT:\n      {\n        if (p.options.scriptingEnabled) {\n          p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n        } else {\n          p._insertElement(token, NS.HTML);\n\n          p.insertionMode = InsertionMode.IN_HEAD_NO_SCRIPT;\n        }\n\n        break;\n      }\n\n    case $.NOFRAMES:\n    case $.STYLE:\n      {\n        p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n\n        break;\n      }\n\n    case $.SCRIPT:\n      {\n        p._switchToTextParsing(token, TokenizerMode.SCRIPT_DATA);\n\n        break;\n      }\n\n    case $.TEMPLATE:\n      {\n        p._insertTemplate(token);\n\n        p.activeFormattingElements.insertMarker();\n        p.framesetOk = false;\n        p.insertionMode = InsertionMode.IN_TEMPLATE;\n        p.tmplInsertionModeStack.unshift(InsertionMode.IN_TEMPLATE);\n        break;\n      }\n\n    case $.HEAD:\n      {\n        p._err(token, ERR.misplacedStartTagForHeadElement);\n\n        break;\n      }\n\n    default:\n      {\n        tokenInHead(p, token);\n      }\n  }\n}\n\nfunction endTagInHead(p, token) {\n  switch (token.tagID) {\n    case $.HEAD:\n      {\n        p.openElements.pop();\n        p.insertionMode = InsertionMode.AFTER_HEAD;\n        break;\n      }\n\n    case $.BODY:\n    case $.BR:\n    case $.HTML:\n      {\n        tokenInHead(p, token);\n        break;\n      }\n\n    case $.TEMPLATE:\n      {\n        templateEndTagInHead(p, token);\n        break;\n      }\n\n    default:\n      {\n        p._err(token, ERR.endTagWithoutMatchingOpenElement);\n      }\n  }\n}\n\nfunction templateEndTagInHead(p, token) {\n  if (p.openElements.tmplCount > 0) {\n    p.openElements.generateImpliedEndTagsThoroughly();\n\n    if (p.openElements.currentTagId !== $.TEMPLATE) {\n      p._err(token, ERR.closingOfElementWithOpenChildElements);\n    }\n\n    p.openElements.popUntilTagNamePopped($.TEMPLATE);\n    p.activeFormattingElements.clearToLastMarker();\n    p.tmplInsertionModeStack.shift();\n\n    p._resetInsertionMode();\n  } else {\n    p._err(token, ERR.endTagWithoutMatchingOpenElement);\n  }\n}\n\nfunction tokenInHead(p, token) {\n  p.openElements.pop();\n  p.insertionMode = InsertionMode.AFTER_HEAD;\n\n  p._processToken(token);\n} // The \"in head no script\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInHeadNoScript(p, token) {\n  switch (token.tagID) {\n    case $.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case $.BASEFONT:\n    case $.BGSOUND:\n    case $.HEAD:\n    case $.LINK:\n    case $.META:\n    case $.NOFRAMES:\n    case $.STYLE:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    case $.NOSCRIPT:\n      {\n        p._err(token, ERR.nestedNoscriptInHead);\n\n        break;\n      }\n\n    default:\n      {\n        tokenInHeadNoScript(p, token);\n      }\n  }\n}\n\nfunction endTagInHeadNoScript(p, token) {\n  switch (token.tagID) {\n    case $.NOSCRIPT:\n      {\n        p.openElements.pop();\n        p.insertionMode = InsertionMode.IN_HEAD;\n        break;\n      }\n\n    case $.BR:\n      {\n        tokenInHeadNoScript(p, token);\n        break;\n      }\n\n    default:\n      {\n        p._err(token, ERR.endTagWithoutMatchingOpenElement);\n      }\n  }\n}\n\nfunction tokenInHeadNoScript(p, token) {\n  const errCode = token.type === TokenType.EOF ? ERR.openElementsLeftAfterEof : ERR.disallowedContentInNoscriptInHead;\n\n  p._err(token, errCode);\n\n  p.openElements.pop();\n  p.insertionMode = InsertionMode.IN_HEAD;\n\n  p._processToken(token);\n} // The \"after head\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterHead(p, token) {\n  switch (token.tagID) {\n    case $.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case $.BODY:\n      {\n        p._insertElement(token, NS.HTML);\n\n        p.framesetOk = false;\n        p.insertionMode = InsertionMode.IN_BODY;\n        break;\n      }\n\n    case $.FRAMESET:\n      {\n        p._insertElement(token, NS.HTML);\n\n        p.insertionMode = InsertionMode.IN_FRAMESET;\n        break;\n      }\n\n    case $.BASE:\n    case $.BASEFONT:\n    case $.BGSOUND:\n    case $.LINK:\n    case $.META:\n    case $.NOFRAMES:\n    case $.SCRIPT:\n    case $.STYLE:\n    case $.TEMPLATE:\n    case $.TITLE:\n      {\n        p._err(token, ERR.abandonedHeadElementChild);\n\n        p.openElements.push(p.headElement, $.HEAD);\n        startTagInHead(p, token);\n        p.openElements.remove(p.headElement);\n        break;\n      }\n\n    case $.HEAD:\n      {\n        p._err(token, ERR.misplacedStartTagForHeadElement);\n\n        break;\n      }\n\n    default:\n      {\n        tokenAfterHead(p, token);\n      }\n  }\n}\n\nfunction endTagAfterHead(p, token) {\n  switch (token.tagID) {\n    case $.BODY:\n    case $.HTML:\n    case $.BR:\n      {\n        tokenAfterHead(p, token);\n        break;\n      }\n\n    case $.TEMPLATE:\n      {\n        templateEndTagInHead(p, token);\n        break;\n      }\n\n    default:\n      {\n        p._err(token, ERR.endTagWithoutMatchingOpenElement);\n      }\n  }\n}\n\nfunction tokenAfterHead(p, token) {\n  p._insertFakeElement(TN.BODY, $.BODY);\n\n  p.insertionMode = InsertionMode.IN_BODY;\n  modeInBody(p, token);\n} // The \"in body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction modeInBody(p, token) {\n  switch (token.type) {\n    case TokenType.CHARACTER:\n      {\n        characterInBody(p, token);\n        break;\n      }\n\n    case TokenType.WHITESPACE_CHARACTER:\n      {\n        whitespaceCharacterInBody(p, token);\n        break;\n      }\n\n    case TokenType.COMMENT:\n      {\n        appendComment(p, token);\n        break;\n      }\n\n    case TokenType.START_TAG:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case TokenType.END_TAG:\n      {\n        endTagInBody(p, token);\n        break;\n      }\n\n    case TokenType.EOF:\n      {\n        eofInBody(p, token);\n        break;\n      }\n\n    default: // Do nothing\n\n  }\n}\n\nfunction whitespaceCharacterInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertCharacters(token);\n}\n\nfunction characterInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertCharacters(token);\n\n  p.framesetOk = false;\n}\n\nfunction htmlStartTagInBody(p, token) {\n  if (p.openElements.tmplCount === 0) {\n    p.treeAdapter.adoptAttributes(p.openElements.items[0], token.attrs);\n  }\n}\n\nfunction bodyStartTagInBody(p, token) {\n  const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n\n  if (bodyElement && p.openElements.tmplCount === 0) {\n    p.framesetOk = false;\n    p.treeAdapter.adoptAttributes(bodyElement, token.attrs);\n  }\n}\n\nfunction framesetStartTagInBody(p, token) {\n  const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n\n  if (p.framesetOk && bodyElement) {\n    p.treeAdapter.detachNode(bodyElement);\n    p.openElements.popAllUpToHtmlElement();\n\n    p._insertElement(token, NS.HTML);\n\n    p.insertionMode = InsertionMode.IN_FRAMESET;\n  }\n}\n\nfunction addressStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction numberedHeaderStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n\n  if (isNumberedHeader(p.openElements.currentTagId)) {\n    p.openElements.pop();\n  }\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction preStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n\n  p._insertElement(token, NS.HTML); //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n  //on to the next one. (Newlines at the start of pre blocks are ignored as an authoring convenience.)\n\n\n  p.skipNextNewLine = true;\n  p.framesetOk = false;\n}\n\nfunction formStartTagInBody(p, token) {\n  const inTemplate = p.openElements.tmplCount > 0;\n\n  if (!p.formElement || inTemplate) {\n    if (p.openElements.hasInButtonScope($.P)) {\n      p._closePElement();\n    }\n\n    p._insertElement(token, NS.HTML);\n\n    if (!inTemplate) {\n      p.formElement = p.openElements.current;\n    }\n  }\n}\n\nfunction listItemStartTagInBody(p, token) {\n  p.framesetOk = false;\n  const tn = token.tagID;\n\n  for (let i = p.openElements.stackTop; i >= 0; i--) {\n    const elementId = p.openElements.tagIDs[i];\n\n    if (tn === $.LI && elementId === $.LI || (tn === $.DD || tn === $.DT) && (elementId === $.DD || elementId === $.DT)) {\n      p.openElements.generateImpliedEndTagsWithExclusion(elementId);\n      p.openElements.popUntilTagNamePopped(elementId);\n      break;\n    }\n\n    if (elementId !== $.ADDRESS && elementId !== $.DIV && elementId !== $.P && p._isSpecialElement(p.openElements.items[i], elementId)) {\n      break;\n    }\n  }\n\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction plaintextStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n\n  p._insertElement(token, NS.HTML);\n\n  p.tokenizer.state = TokenizerMode.PLAINTEXT;\n}\n\nfunction buttonStartTagInBody(p, token) {\n  if (p.openElements.hasInScope($.BUTTON)) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped($.BUTTON);\n  }\n\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n\n  p.framesetOk = false;\n}\n\nfunction aStartTagInBody(p, token) {\n  const activeElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(TN.A);\n\n  if (activeElementEntry) {\n    callAdoptionAgency(p, token);\n    p.openElements.remove(activeElementEntry.element);\n    p.activeFormattingElements.removeEntry(activeElementEntry);\n  }\n\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction bStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction nobrStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  if (p.openElements.hasInScope($.NOBR)) {\n    callAdoptionAgency(p, token);\n\n    p._reconstructActiveFormattingElements();\n  }\n\n  p._insertElement(token, NS.HTML);\n\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction appletStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n\n  p.activeFormattingElements.insertMarker();\n  p.framesetOk = false;\n}\n\nfunction tableStartTagInBody(p, token) {\n  if (p.treeAdapter.getDocumentMode(p.document) !== DOCUMENT_MODE.QUIRKS && p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n\n  p._insertElement(token, NS.HTML);\n\n  p.framesetOk = false;\n  p.insertionMode = InsertionMode.IN_TABLE;\n}\n\nfunction areaStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._appendElement(token, NS.HTML);\n\n  p.framesetOk = false;\n  token.ackSelfClosing = true;\n}\n\nfunction isHiddenInput(token) {\n  const inputType = getTokenAttr(token, ATTRS.TYPE);\n  return inputType != null && inputType.toLowerCase() === HIDDEN_INPUT_TYPE;\n}\n\nfunction inputStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._appendElement(token, NS.HTML);\n\n  if (!isHiddenInput(token)) {\n    p.framesetOk = false;\n  }\n\n  token.ackSelfClosing = true;\n}\n\nfunction paramStartTagInBody(p, token) {\n  p._appendElement(token, NS.HTML);\n\n  token.ackSelfClosing = true;\n}\n\nfunction hrStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n\n  p._appendElement(token, NS.HTML);\n\n  p.framesetOk = false;\n  token.ackSelfClosing = true;\n}\n\nfunction imageStartTagInBody(p, token) {\n  token.tagName = TN.IMG;\n  token.tagID = $.IMG;\n  areaStartTagInBody(p, token);\n}\n\nfunction textareaStartTagInBody(p, token) {\n  p._insertElement(token, NS.HTML); //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n  //on to the next one. (Newlines at the start of textarea elements are ignored as an authoring convenience.)\n\n\n  p.skipNextNewLine = true;\n  p.tokenizer.state = TokenizerMode.RCDATA;\n  p.originalInsertionMode = p.insertionMode;\n  p.framesetOk = false;\n  p.insertionMode = InsertionMode.TEXT;\n}\n\nfunction xmpStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) {\n    p._closePElement();\n  }\n\n  p._reconstructActiveFormattingElements();\n\n  p.framesetOk = false;\n\n  p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n}\n\nfunction iframeStartTagInBody(p, token) {\n  p.framesetOk = false;\n\n  p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n} //NOTE: here we assume that we always act as an user agent with enabled plugins, so we parse\n//<noembed> as rawtext.\n\n\nfunction noembedStartTagInBody(p, token) {\n  p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n}\n\nfunction selectStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n\n  p.framesetOk = false;\n  p.insertionMode = p.insertionMode === InsertionMode.IN_TABLE || p.insertionMode === InsertionMode.IN_CAPTION || p.insertionMode === InsertionMode.IN_TABLE_BODY || p.insertionMode === InsertionMode.IN_ROW || p.insertionMode === InsertionMode.IN_CELL ? InsertionMode.IN_SELECT_IN_TABLE : InsertionMode.IN_SELECT;\n}\n\nfunction optgroupStartTagInBody(p, token) {\n  if (p.openElements.currentTagId === $.OPTION) {\n    p.openElements.pop();\n  }\n\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction rbStartTagInBody(p, token) {\n  if (p.openElements.hasInScope($.RUBY)) {\n    p.openElements.generateImpliedEndTags();\n  }\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction rtStartTagInBody(p, token) {\n  if (p.openElements.hasInScope($.RUBY)) {\n    p.openElements.generateImpliedEndTagsWithExclusion($.RTC);\n  }\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction mathStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  foreignContent.adjustTokenMathMLAttrs(token);\n  foreignContent.adjustTokenXMLAttrs(token);\n\n  if (token.selfClosing) {\n    p._appendElement(token, NS.MATHML);\n  } else {\n    p._insertElement(token, NS.MATHML);\n  }\n\n  token.ackSelfClosing = true;\n}\n\nfunction svgStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  foreignContent.adjustTokenSVGAttrs(token);\n  foreignContent.adjustTokenXMLAttrs(token);\n\n  if (token.selfClosing) {\n    p._appendElement(token, NS.SVG);\n  } else {\n    p._insertElement(token, NS.SVG);\n  }\n\n  token.ackSelfClosing = true;\n}\n\nfunction genericStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction startTagInBody(p, token) {\n  switch (token.tagID) {\n    case $.I:\n    case $.S:\n    case $.B:\n    case $.U:\n    case $.EM:\n    case $.TT:\n    case $.BIG:\n    case $.CODE:\n    case $.FONT:\n    case $.SMALL:\n    case $.STRIKE:\n    case $.STRONG:\n      {\n        bStartTagInBody(p, token);\n        break;\n      }\n\n    case $.A:\n      {\n        aStartTagInBody(p, token);\n        break;\n      }\n\n    case $.H1:\n    case $.H2:\n    case $.H3:\n    case $.H4:\n    case $.H5:\n    case $.H6:\n      {\n        numberedHeaderStartTagInBody(p, token);\n        break;\n      }\n\n    case $.P:\n    case $.DL:\n    case $.OL:\n    case $.UL:\n    case $.DIV:\n    case $.DIR:\n    case $.NAV:\n    case $.MAIN:\n    case $.MENU:\n    case $.ASIDE:\n    case $.CENTER:\n    case $.FIGURE:\n    case $.FOOTER:\n    case $.HEADER:\n    case $.HGROUP:\n    case $.DIALOG:\n    case $.DETAILS:\n    case $.ADDRESS:\n    case $.ARTICLE:\n    case $.SECTION:\n    case $.SUMMARY:\n    case $.FIELDSET:\n    case $.BLOCKQUOTE:\n    case $.FIGCAPTION:\n      {\n        addressStartTagInBody(p, token);\n        break;\n      }\n\n    case $.LI:\n    case $.DD:\n    case $.DT:\n      {\n        listItemStartTagInBody(p, token);\n        break;\n      }\n\n    case $.BR:\n    case $.IMG:\n    case $.WBR:\n    case $.AREA:\n    case $.EMBED:\n    case $.KEYGEN:\n      {\n        areaStartTagInBody(p, token);\n        break;\n      }\n\n    case $.HR:\n      {\n        hrStartTagInBody(p, token);\n        break;\n      }\n\n    case $.RB:\n    case $.RTC:\n      {\n        rbStartTagInBody(p, token);\n        break;\n      }\n\n    case $.RT:\n    case $.RP:\n      {\n        rtStartTagInBody(p, token);\n        break;\n      }\n\n    case $.PRE:\n    case $.LISTING:\n      {\n        preStartTagInBody(p, token);\n        break;\n      }\n\n    case $.XMP:\n      {\n        xmpStartTagInBody(p, token);\n        break;\n      }\n\n    case $.SVG:\n      {\n        svgStartTagInBody(p, token);\n        break;\n      }\n\n    case $.HTML:\n      {\n        htmlStartTagInBody(p, token);\n        break;\n      }\n\n    case $.BASE:\n    case $.LINK:\n    case $.META:\n    case $.STYLE:\n    case $.TITLE:\n    case $.SCRIPT:\n    case $.BGSOUND:\n    case $.BASEFONT:\n    case $.TEMPLATE:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    case $.BODY:\n      {\n        bodyStartTagInBody(p, token);\n        break;\n      }\n\n    case $.FORM:\n      {\n        formStartTagInBody(p, token);\n        break;\n      }\n\n    case $.NOBR:\n      {\n        nobrStartTagInBody(p, token);\n        break;\n      }\n\n    case $.MATH:\n      {\n        mathStartTagInBody(p, token);\n        break;\n      }\n\n    case $.TABLE:\n      {\n        tableStartTagInBody(p, token);\n        break;\n      }\n\n    case $.INPUT:\n      {\n        inputStartTagInBody(p, token);\n        break;\n      }\n\n    case $.PARAM:\n    case $.TRACK:\n    case $.SOURCE:\n      {\n        paramStartTagInBody(p, token);\n        break;\n      }\n\n    case $.IMAGE:\n      {\n        imageStartTagInBody(p, token);\n        break;\n      }\n\n    case $.BUTTON:\n      {\n        buttonStartTagInBody(p, token);\n        break;\n      }\n\n    case $.APPLET:\n    case $.OBJECT:\n    case $.MARQUEE:\n      {\n        appletStartTagInBody(p, token);\n        break;\n      }\n\n    case $.IFRAME:\n      {\n        iframeStartTagInBody(p, token);\n        break;\n      }\n\n    case $.SELECT:\n      {\n        selectStartTagInBody(p, token);\n        break;\n      }\n\n    case $.OPTION:\n    case $.OPTGROUP:\n      {\n        optgroupStartTagInBody(p, token);\n        break;\n      }\n\n    case $.NOEMBED:\n      {\n        noembedStartTagInBody(p, token);\n        break;\n      }\n\n    case $.FRAMESET:\n      {\n        framesetStartTagInBody(p, token);\n        break;\n      }\n\n    case $.TEXTAREA:\n      {\n        textareaStartTagInBody(p, token);\n        break;\n      }\n\n    case $.NOSCRIPT:\n      {\n        if (p.options.scriptingEnabled) {\n          noembedStartTagInBody(p, token);\n        } else {\n          genericStartTagInBody(p, token);\n        }\n\n        break;\n      }\n\n    case $.PLAINTEXT:\n      {\n        plaintextStartTagInBody(p, token);\n        break;\n      }\n\n    case $.COL:\n    case $.TH:\n    case $.TD:\n    case $.TR:\n    case $.HEAD:\n    case $.FRAME:\n    case $.TBODY:\n    case $.TFOOT:\n    case $.THEAD:\n    case $.CAPTION:\n    case $.COLGROUP:\n      {\n        // Ignore token\n        break;\n      }\n\n    default:\n      {\n        genericStartTagInBody(p, token);\n      }\n  }\n}\n\nfunction bodyEndTagInBody(p, token) {\n  if (p.openElements.hasInScope($.BODY)) {\n    p.insertionMode = InsertionMode.AFTER_BODY; //NOTE: <body> is never popped from the stack, so we need to updated\n    //the end location explicitly.\n\n    if (p.options.sourceCodeLocationInfo) {\n      const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n\n      if (bodyElement) {\n        p._setEndLocation(bodyElement, token);\n      }\n    }\n  }\n}\n\nfunction htmlEndTagInBody(p, token) {\n  if (p.openElements.hasInScope($.BODY)) {\n    p.insertionMode = InsertionMode.AFTER_BODY;\n    endTagAfterBody(p, token);\n  }\n}\n\nfunction addressEndTagInBody(p, token) {\n  const tn = token.tagID;\n\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped(tn);\n  }\n}\n\nfunction formEndTagInBody(p) {\n  const inTemplate = p.openElements.tmplCount > 0;\n  const {\n    formElement\n  } = p;\n\n  if (!inTemplate) {\n    p.formElement = null;\n  }\n\n  if ((formElement || inTemplate) && p.openElements.hasInScope($.FORM)) {\n    p.openElements.generateImpliedEndTags();\n\n    if (inTemplate) {\n      p.openElements.popUntilTagNamePopped($.FORM);\n    } else if (formElement) {\n      p.openElements.remove(formElement);\n    }\n  }\n}\n\nfunction pEndTagInBody(p) {\n  if (!p.openElements.hasInButtonScope($.P)) {\n    p._insertFakeElement(TN.P, $.P);\n  }\n\n  p._closePElement();\n}\n\nfunction liEndTagInBody(p) {\n  if (p.openElements.hasInListItemScope($.LI)) {\n    p.openElements.generateImpliedEndTagsWithExclusion($.LI);\n    p.openElements.popUntilTagNamePopped($.LI);\n  }\n}\n\nfunction ddEndTagInBody(p, token) {\n  const tn = token.tagID;\n\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTagsWithExclusion(tn);\n    p.openElements.popUntilTagNamePopped(tn);\n  }\n}\n\nfunction numberedHeaderEndTagInBody(p) {\n  if (p.openElements.hasNumberedHeaderInScope()) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilNumberedHeaderPopped();\n  }\n}\n\nfunction appletEndTagInBody(p, token) {\n  const tn = token.tagID;\n\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped(tn);\n    p.activeFormattingElements.clearToLastMarker();\n  }\n}\n\nfunction brEndTagInBody(p) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertFakeElement(TN.BR, $.BR);\n\n  p.openElements.pop();\n  p.framesetOk = false;\n}\n\nfunction genericEndTagInBody(p, token) {\n  const tn = token.tagName;\n  const tid = token.tagID;\n\n  for (let i = p.openElements.stackTop; i > 0; i--) {\n    const element = p.openElements.items[i];\n    const elementId = p.openElements.tagIDs[i]; // Compare the tag name here, as the tag might not be a known tag with an ID.\n\n    if (tid === elementId && (tid !== $.UNKNOWN || p.treeAdapter.getTagName(element) === tn)) {\n      p.openElements.generateImpliedEndTagsWithExclusion(tid);\n      if (p.openElements.stackTop >= i) p.openElements.shortenToLength(i);\n      break;\n    }\n\n    if (p._isSpecialElement(element, elementId)) {\n      break;\n    }\n  }\n}\n\nfunction endTagInBody(p, token) {\n  switch (token.tagID) {\n    case $.A:\n    case $.B:\n    case $.I:\n    case $.S:\n    case $.U:\n    case $.EM:\n    case $.TT:\n    case $.BIG:\n    case $.CODE:\n    case $.FONT:\n    case $.NOBR:\n    case $.SMALL:\n    case $.STRIKE:\n    case $.STRONG:\n      {\n        callAdoptionAgency(p, token);\n        break;\n      }\n\n    case $.P:\n      {\n        pEndTagInBody(p);\n        break;\n      }\n\n    case $.DL:\n    case $.UL:\n    case $.OL:\n    case $.DIR:\n    case $.DIV:\n    case $.NAV:\n    case $.PRE:\n    case $.MAIN:\n    case $.MENU:\n    case $.ASIDE:\n    case $.BUTTON:\n    case $.CENTER:\n    case $.FIGURE:\n    case $.FOOTER:\n    case $.HEADER:\n    case $.HGROUP:\n    case $.DIALOG:\n    case $.ADDRESS:\n    case $.ARTICLE:\n    case $.DETAILS:\n    case $.SECTION:\n    case $.SUMMARY:\n    case $.LISTING:\n    case $.FIELDSET:\n    case $.BLOCKQUOTE:\n    case $.FIGCAPTION:\n      {\n        addressEndTagInBody(p, token);\n        break;\n      }\n\n    case $.LI:\n      {\n        liEndTagInBody(p);\n        break;\n      }\n\n    case $.DD:\n    case $.DT:\n      {\n        ddEndTagInBody(p, token);\n        break;\n      }\n\n    case $.H1:\n    case $.H2:\n    case $.H3:\n    case $.H4:\n    case $.H5:\n    case $.H6:\n      {\n        numberedHeaderEndTagInBody(p);\n        break;\n      }\n\n    case $.BR:\n      {\n        brEndTagInBody(p);\n        break;\n      }\n\n    case $.BODY:\n      {\n        bodyEndTagInBody(p, token);\n        break;\n      }\n\n    case $.HTML:\n      {\n        htmlEndTagInBody(p, token);\n        break;\n      }\n\n    case $.FORM:\n      {\n        formEndTagInBody(p);\n        break;\n      }\n\n    case $.APPLET:\n    case $.OBJECT:\n    case $.MARQUEE:\n      {\n        appletEndTagInBody(p, token);\n        break;\n      }\n\n    case $.TEMPLATE:\n      {\n        templateEndTagInHead(p, token);\n        break;\n      }\n\n    default:\n      {\n        genericEndTagInBody(p, token);\n      }\n  }\n}\n\nfunction eofInBody(p, token) {\n  if (p.tmplInsertionModeStack.length > 0) {\n    eofInTemplate(p, token);\n  } else {\n    stopParsing(p, token);\n  }\n} // The \"text\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction endTagInText(p, token) {\n  var _a;\n\n  if (token.tagID === $.SCRIPT) {\n    (_a = p.scriptHandler) === null || _a === void 0 ? void 0 : _a.call(p, p.openElements.current);\n  }\n\n  p.openElements.pop();\n  p.insertionMode = p.originalInsertionMode;\n}\n\nfunction eofInText(p, token) {\n  p._err(token, ERR.eofInElementThatCanContainOnlyText);\n\n  p.openElements.pop();\n  p.insertionMode = p.originalInsertionMode;\n  p.onEof(token);\n} // The \"in table\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction characterInTable(p, token) {\n  if (TABLE_STRUCTURE_TAGS.has(p.openElements.currentTagId)) {\n    p.pendingCharacterTokens.length = 0;\n    p.hasNonWhitespacePendingCharacterToken = false;\n    p.originalInsertionMode = p.insertionMode;\n    p.insertionMode = InsertionMode.IN_TABLE_TEXT;\n\n    switch (token.type) {\n      case TokenType.CHARACTER:\n        {\n          characterInTableText(p, token);\n          break;\n        }\n\n      case TokenType.WHITESPACE_CHARACTER:\n        {\n          whitespaceCharacterInTableText(p, token);\n          break;\n        }\n      // Ignore null\n    }\n  } else {\n    tokenInTable(p, token);\n  }\n}\n\nfunction captionStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n  p.activeFormattingElements.insertMarker();\n\n  p._insertElement(token, NS.HTML);\n\n  p.insertionMode = InsertionMode.IN_CAPTION;\n}\n\nfunction colgroupStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n\n  p._insertElement(token, NS.HTML);\n\n  p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n}\n\nfunction colStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n\n  p._insertFakeElement(TN.COLGROUP, $.COLGROUP);\n\n  p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n  startTagInColumnGroup(p, token);\n}\n\nfunction tbodyStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n\n  p._insertElement(token, NS.HTML);\n\n  p.insertionMode = InsertionMode.IN_TABLE_BODY;\n}\n\nfunction tdStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n\n  p._insertFakeElement(TN.TBODY, $.TBODY);\n\n  p.insertionMode = InsertionMode.IN_TABLE_BODY;\n  startTagInTableBody(p, token);\n}\n\nfunction tableStartTagInTable(p, token) {\n  if (p.openElements.hasInTableScope($.TABLE)) {\n    p.openElements.popUntilTagNamePopped($.TABLE);\n\n    p._resetInsertionMode();\n\n    p._processStartTag(token);\n  }\n}\n\nfunction inputStartTagInTable(p, token) {\n  if (isHiddenInput(token)) {\n    p._appendElement(token, NS.HTML);\n  } else {\n    tokenInTable(p, token);\n  }\n\n  token.ackSelfClosing = true;\n}\n\nfunction formStartTagInTable(p, token) {\n  if (!p.formElement && p.openElements.tmplCount === 0) {\n    p._insertElement(token, NS.HTML);\n\n    p.formElement = p.openElements.current;\n    p.openElements.pop();\n  }\n}\n\nfunction startTagInTable(p, token) {\n  switch (token.tagID) {\n    case $.TD:\n    case $.TH:\n    case $.TR:\n      {\n        tdStartTagInTable(p, token);\n        break;\n      }\n\n    case $.STYLE:\n    case $.SCRIPT:\n    case $.TEMPLATE:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    case $.COL:\n      {\n        colStartTagInTable(p, token);\n        break;\n      }\n\n    case $.FORM:\n      {\n        formStartTagInTable(p, token);\n        break;\n      }\n\n    case $.TABLE:\n      {\n        tableStartTagInTable(p, token);\n        break;\n      }\n\n    case $.TBODY:\n    case $.TFOOT:\n    case $.THEAD:\n      {\n        tbodyStartTagInTable(p, token);\n        break;\n      }\n\n    case $.INPUT:\n      {\n        inputStartTagInTable(p, token);\n        break;\n      }\n\n    case $.CAPTION:\n      {\n        captionStartTagInTable(p, token);\n        break;\n      }\n\n    case $.COLGROUP:\n      {\n        colgroupStartTagInTable(p, token);\n        break;\n      }\n\n    default:\n      {\n        tokenInTable(p, token);\n      }\n  }\n}\n\nfunction endTagInTable(p, token) {\n  switch (token.tagID) {\n    case $.TABLE:\n      {\n        if (p.openElements.hasInTableScope($.TABLE)) {\n          p.openElements.popUntilTagNamePopped($.TABLE);\n\n          p._resetInsertionMode();\n        }\n\n        break;\n      }\n\n    case $.TEMPLATE:\n      {\n        templateEndTagInHead(p, token);\n        break;\n      }\n\n    case $.BODY:\n    case $.CAPTION:\n    case $.COL:\n    case $.COLGROUP:\n    case $.HTML:\n    case $.TBODY:\n    case $.TD:\n    case $.TFOOT:\n    case $.TH:\n    case $.THEAD:\n    case $.TR:\n      {\n        // Ignore token\n        break;\n      }\n\n    default:\n      {\n        tokenInTable(p, token);\n      }\n  }\n}\n\nfunction tokenInTable(p, token) {\n  const savedFosterParentingState = p.fosterParentingEnabled;\n  p.fosterParentingEnabled = true; // Process token in `In Body` mode\n\n  modeInBody(p, token);\n  p.fosterParentingEnabled = savedFosterParentingState;\n} // The \"in table text\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction whitespaceCharacterInTableText(p, token) {\n  p.pendingCharacterTokens.push(token);\n}\n\nfunction characterInTableText(p, token) {\n  p.pendingCharacterTokens.push(token);\n  p.hasNonWhitespacePendingCharacterToken = true;\n}\n\nfunction tokenInTableText(p, token) {\n  let i = 0;\n\n  if (p.hasNonWhitespacePendingCharacterToken) {\n    for (; i < p.pendingCharacterTokens.length; i++) {\n      tokenInTable(p, p.pendingCharacterTokens[i]);\n    }\n  } else {\n    for (; i < p.pendingCharacterTokens.length; i++) {\n      p._insertCharacters(p.pendingCharacterTokens[i]);\n    }\n  }\n\n  p.insertionMode = p.originalInsertionMode;\n\n  p._processToken(token);\n} // The \"in caption\" insertion mode\n//------------------------------------------------------------------\n\n\nconst TABLE_VOID_ELEMENTS = new Set([$.CAPTION, $.COL, $.COLGROUP, $.TBODY, $.TD, $.TFOOT, $.TH, $.THEAD, $.TR]);\n\nfunction startTagInCaption(p, token) {\n  const tn = token.tagID;\n\n  if (TABLE_VOID_ELEMENTS.has(tn)) {\n    if (p.openElements.hasInTableScope($.CAPTION)) {\n      p.openElements.generateImpliedEndTags();\n      p.openElements.popUntilTagNamePopped($.CAPTION);\n      p.activeFormattingElements.clearToLastMarker();\n      p.insertionMode = InsertionMode.IN_TABLE;\n      startTagInTable(p, token);\n    }\n  } else {\n    startTagInBody(p, token);\n  }\n}\n\nfunction endTagInCaption(p, token) {\n  const tn = token.tagID;\n\n  switch (tn) {\n    case $.CAPTION:\n    case $.TABLE:\n      {\n        if (p.openElements.hasInTableScope($.CAPTION)) {\n          p.openElements.generateImpliedEndTags();\n          p.openElements.popUntilTagNamePopped($.CAPTION);\n          p.activeFormattingElements.clearToLastMarker();\n          p.insertionMode = InsertionMode.IN_TABLE;\n\n          if (tn === $.TABLE) {\n            endTagInTable(p, token);\n          }\n        }\n\n        break;\n      }\n\n    case $.BODY:\n    case $.COL:\n    case $.COLGROUP:\n    case $.HTML:\n    case $.TBODY:\n    case $.TD:\n    case $.TFOOT:\n    case $.TH:\n    case $.THEAD:\n    case $.TR:\n      {\n        // Ignore token\n        break;\n      }\n\n    default:\n      {\n        endTagInBody(p, token);\n      }\n  }\n} // The \"in column group\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInColumnGroup(p, token) {\n  switch (token.tagID) {\n    case $.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case $.COL:\n      {\n        p._appendElement(token, NS.HTML);\n\n        token.ackSelfClosing = true;\n        break;\n      }\n\n    case $.TEMPLATE:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    default:\n      {\n        tokenInColumnGroup(p, token);\n      }\n  }\n}\n\nfunction endTagInColumnGroup(p, token) {\n  switch (token.tagID) {\n    case $.COLGROUP:\n      {\n        if (p.openElements.currentTagId === $.COLGROUP) {\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE;\n        }\n\n        break;\n      }\n\n    case $.TEMPLATE:\n      {\n        templateEndTagInHead(p, token);\n        break;\n      }\n\n    case $.COL:\n      {\n        // Ignore token\n        break;\n      }\n\n    default:\n      {\n        tokenInColumnGroup(p, token);\n      }\n  }\n}\n\nfunction tokenInColumnGroup(p, token) {\n  if (p.openElements.currentTagId === $.COLGROUP) {\n    p.openElements.pop();\n    p.insertionMode = InsertionMode.IN_TABLE;\n\n    p._processToken(token);\n  }\n} // The \"in table body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInTableBody(p, token) {\n  switch (token.tagID) {\n    case $.TR:\n      {\n        p.openElements.clearBackToTableBodyContext();\n\n        p._insertElement(token, NS.HTML);\n\n        p.insertionMode = InsertionMode.IN_ROW;\n        break;\n      }\n\n    case $.TH:\n    case $.TD:\n      {\n        p.openElements.clearBackToTableBodyContext();\n\n        p._insertFakeElement(TN.TR, $.TR);\n\n        p.insertionMode = InsertionMode.IN_ROW;\n        startTagInRow(p, token);\n        break;\n      }\n\n    case $.CAPTION:\n    case $.COL:\n    case $.COLGROUP:\n    case $.TBODY:\n    case $.TFOOT:\n    case $.THEAD:\n      {\n        if (p.openElements.hasTableBodyContextInTableScope()) {\n          p.openElements.clearBackToTableBodyContext();\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE;\n          startTagInTable(p, token);\n        }\n\n        break;\n      }\n\n    default:\n      {\n        startTagInTable(p, token);\n      }\n  }\n}\n\nfunction endTagInTableBody(p, token) {\n  const tn = token.tagID;\n\n  switch (token.tagID) {\n    case $.TBODY:\n    case $.TFOOT:\n    case $.THEAD:\n      {\n        if (p.openElements.hasInTableScope(tn)) {\n          p.openElements.clearBackToTableBodyContext();\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE;\n        }\n\n        break;\n      }\n\n    case $.TABLE:\n      {\n        if (p.openElements.hasTableBodyContextInTableScope()) {\n          p.openElements.clearBackToTableBodyContext();\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE;\n          endTagInTable(p, token);\n        }\n\n        break;\n      }\n\n    case $.BODY:\n    case $.CAPTION:\n    case $.COL:\n    case $.COLGROUP:\n    case $.HTML:\n    case $.TD:\n    case $.TH:\n    case $.TR:\n      {\n        // Ignore token\n        break;\n      }\n\n    default:\n      {\n        endTagInTable(p, token);\n      }\n  }\n} // The \"in row\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInRow(p, token) {\n  switch (token.tagID) {\n    case $.TH:\n    case $.TD:\n      {\n        p.openElements.clearBackToTableRowContext();\n\n        p._insertElement(token, NS.HTML);\n\n        p.insertionMode = InsertionMode.IN_CELL;\n        p.activeFormattingElements.insertMarker();\n        break;\n      }\n\n    case $.CAPTION:\n    case $.COL:\n    case $.COLGROUP:\n    case $.TBODY:\n    case $.TFOOT:\n    case $.THEAD:\n    case $.TR:\n      {\n        if (p.openElements.hasInTableScope($.TR)) {\n          p.openElements.clearBackToTableRowContext();\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE_BODY;\n          startTagInTableBody(p, token);\n        }\n\n        break;\n      }\n\n    default:\n      {\n        startTagInTable(p, token);\n      }\n  }\n}\n\nfunction endTagInRow(p, token) {\n  switch (token.tagID) {\n    case $.TR:\n      {\n        if (p.openElements.hasInTableScope($.TR)) {\n          p.openElements.clearBackToTableRowContext();\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE_BODY;\n        }\n\n        break;\n      }\n\n    case $.TABLE:\n      {\n        if (p.openElements.hasInTableScope($.TR)) {\n          p.openElements.clearBackToTableRowContext();\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE_BODY;\n          endTagInTableBody(p, token);\n        }\n\n        break;\n      }\n\n    case $.TBODY:\n    case $.TFOOT:\n    case $.THEAD:\n      {\n        if (p.openElements.hasInTableScope(token.tagID) || p.openElements.hasInTableScope($.TR)) {\n          p.openElements.clearBackToTableRowContext();\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE_BODY;\n          endTagInTableBody(p, token);\n        }\n\n        break;\n      }\n\n    case $.BODY:\n    case $.CAPTION:\n    case $.COL:\n    case $.COLGROUP:\n    case $.HTML:\n    case $.TD:\n    case $.TH:\n      {\n        // Ignore end tag\n        break;\n      }\n\n    default:\n      endTagInTable(p, token);\n  }\n} // The \"in cell\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInCell(p, token) {\n  const tn = token.tagID;\n\n  if (TABLE_VOID_ELEMENTS.has(tn)) {\n    if (p.openElements.hasInTableScope($.TD) || p.openElements.hasInTableScope($.TH)) {\n      p._closeTableCell();\n\n      startTagInRow(p, token);\n    }\n  } else {\n    startTagInBody(p, token);\n  }\n}\n\nfunction endTagInCell(p, token) {\n  const tn = token.tagID;\n\n  switch (tn) {\n    case $.TD:\n    case $.TH:\n      {\n        if (p.openElements.hasInTableScope(tn)) {\n          p.openElements.generateImpliedEndTags();\n          p.openElements.popUntilTagNamePopped(tn);\n          p.activeFormattingElements.clearToLastMarker();\n          p.insertionMode = InsertionMode.IN_ROW;\n        }\n\n        break;\n      }\n\n    case $.TABLE:\n    case $.TBODY:\n    case $.TFOOT:\n    case $.THEAD:\n    case $.TR:\n      {\n        if (p.openElements.hasInTableScope(tn)) {\n          p._closeTableCell();\n\n          endTagInRow(p, token);\n        }\n\n        break;\n      }\n\n    case $.BODY:\n    case $.CAPTION:\n    case $.COL:\n    case $.COLGROUP:\n    case $.HTML:\n      {\n        // Ignore token\n        break;\n      }\n\n    default:\n      {\n        endTagInBody(p, token);\n      }\n  }\n} // The \"in select\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInSelect(p, token) {\n  switch (token.tagID) {\n    case $.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case $.OPTION:\n      {\n        if (p.openElements.currentTagId === $.OPTION) {\n          p.openElements.pop();\n        }\n\n        p._insertElement(token, NS.HTML);\n\n        break;\n      }\n\n    case $.OPTGROUP:\n      {\n        if (p.openElements.currentTagId === $.OPTION) {\n          p.openElements.pop();\n        }\n\n        if (p.openElements.currentTagId === $.OPTGROUP) {\n          p.openElements.pop();\n        }\n\n        p._insertElement(token, NS.HTML);\n\n        break;\n      }\n\n    case $.INPUT:\n    case $.KEYGEN:\n    case $.TEXTAREA:\n    case $.SELECT:\n      {\n        if (p.openElements.hasInSelectScope($.SELECT)) {\n          p.openElements.popUntilTagNamePopped($.SELECT);\n\n          p._resetInsertionMode();\n\n          if (token.tagID !== $.SELECT) {\n            p._processStartTag(token);\n          }\n        }\n\n        break;\n      }\n\n    case $.SCRIPT:\n    case $.TEMPLATE:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    default: // Do nothing\n\n  }\n}\n\nfunction endTagInSelect(p, token) {\n  switch (token.tagID) {\n    case $.OPTGROUP:\n      {\n        if (p.openElements.stackTop > 0 && p.openElements.currentTagId === $.OPTION && p.openElements.tagIDs[p.openElements.stackTop - 1] === $.OPTGROUP) {\n          p.openElements.pop();\n        }\n\n        if (p.openElements.currentTagId === $.OPTGROUP) {\n          p.openElements.pop();\n        }\n\n        break;\n      }\n\n    case $.OPTION:\n      {\n        if (p.openElements.currentTagId === $.OPTION) {\n          p.openElements.pop();\n        }\n\n        break;\n      }\n\n    case $.SELECT:\n      {\n        if (p.openElements.hasInSelectScope($.SELECT)) {\n          p.openElements.popUntilTagNamePopped($.SELECT);\n\n          p._resetInsertionMode();\n        }\n\n        break;\n      }\n\n    case $.TEMPLATE:\n      {\n        templateEndTagInHead(p, token);\n        break;\n      }\n\n    default: // Do nothing\n\n  }\n} // The \"in select in table\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInSelectInTable(p, token) {\n  const tn = token.tagID;\n\n  if (tn === $.CAPTION || tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR || tn === $.TD || tn === $.TH) {\n    p.openElements.popUntilTagNamePopped($.SELECT);\n\n    p._resetInsertionMode();\n\n    p._processStartTag(token);\n  } else {\n    startTagInSelect(p, token);\n  }\n}\n\nfunction endTagInSelectInTable(p, token) {\n  const tn = token.tagID;\n\n  if (tn === $.CAPTION || tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR || tn === $.TD || tn === $.TH) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p.openElements.popUntilTagNamePopped($.SELECT);\n\n      p._resetInsertionMode();\n\n      p.onEndTag(token);\n    }\n  } else {\n    endTagInSelect(p, token);\n  }\n} // The \"in template\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInTemplate(p, token) {\n  switch (token.tagID) {\n    // First, handle tags that can start without a mode change\n    case $.BASE:\n    case $.BASEFONT:\n    case $.BGSOUND:\n    case $.LINK:\n    case $.META:\n    case $.NOFRAMES:\n    case $.SCRIPT:\n    case $.STYLE:\n    case $.TEMPLATE:\n    case $.TITLE:\n      startTagInHead(p, token);\n      break;\n    // Re-process the token in the appropriate mode\n\n    case $.CAPTION:\n    case $.COLGROUP:\n    case $.TBODY:\n    case $.TFOOT:\n    case $.THEAD:\n      p.tmplInsertionModeStack[0] = InsertionMode.IN_TABLE;\n      p.insertionMode = InsertionMode.IN_TABLE;\n      startTagInTable(p, token);\n      break;\n\n    case $.COL:\n      p.tmplInsertionModeStack[0] = InsertionMode.IN_COLUMN_GROUP;\n      p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n      startTagInColumnGroup(p, token);\n      break;\n\n    case $.TR:\n      p.tmplInsertionModeStack[0] = InsertionMode.IN_TABLE_BODY;\n      p.insertionMode = InsertionMode.IN_TABLE_BODY;\n      startTagInTableBody(p, token);\n      break;\n\n    case $.TD:\n    case $.TH:\n      p.tmplInsertionModeStack[0] = InsertionMode.IN_ROW;\n      p.insertionMode = InsertionMode.IN_ROW;\n      startTagInRow(p, token);\n      break;\n\n    default:\n      p.tmplInsertionModeStack[0] = InsertionMode.IN_BODY;\n      p.insertionMode = InsertionMode.IN_BODY;\n      startTagInBody(p, token);\n  }\n}\n\nfunction endTagInTemplate(p, token) {\n  if (token.tagID === $.TEMPLATE) {\n    templateEndTagInHead(p, token);\n  }\n}\n\nfunction eofInTemplate(p, token) {\n  if (p.openElements.tmplCount > 0) {\n    p.openElements.popUntilTagNamePopped($.TEMPLATE);\n    p.activeFormattingElements.clearToLastMarker();\n    p.tmplInsertionModeStack.shift();\n\n    p._resetInsertionMode();\n\n    p.onEof(token);\n  } else {\n    stopParsing(p, token);\n  }\n} // The \"after body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterBody(p, token) {\n  if (token.tagID === $.HTML) {\n    startTagInBody(p, token);\n  } else {\n    tokenAfterBody(p, token);\n  }\n}\n\nfunction endTagAfterBody(p, token) {\n  var _a;\n\n  if (token.tagID === $.HTML) {\n    if (!p.fragmentContext) {\n      p.insertionMode = InsertionMode.AFTER_AFTER_BODY;\n    } //NOTE: <html> is never popped from the stack, so we need to updated\n    //the end location explicitly.\n\n\n    if (p.options.sourceCodeLocationInfo && p.openElements.tagIDs[0] === $.HTML) {\n      p._setEndLocation(p.openElements.items[0], token); // Update the body element, if it doesn't have an end tag\n\n\n      const bodyElement = p.openElements.items[1];\n\n      if (bodyElement && !((_a = p.treeAdapter.getNodeSourceCodeLocation(bodyElement)) === null || _a === void 0 ? void 0 : _a.endTag)) {\n        p._setEndLocation(bodyElement, token);\n      }\n    }\n  } else {\n    tokenAfterBody(p, token);\n  }\n}\n\nfunction tokenAfterBody(p, token) {\n  p.insertionMode = InsertionMode.IN_BODY;\n  modeInBody(p, token);\n} // The \"in frameset\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInFrameset(p, token) {\n  switch (token.tagID) {\n    case $.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case $.FRAMESET:\n      {\n        p._insertElement(token, NS.HTML);\n\n        break;\n      }\n\n    case $.FRAME:\n      {\n        p._appendElement(token, NS.HTML);\n\n        token.ackSelfClosing = true;\n        break;\n      }\n\n    case $.NOFRAMES:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    default: // Do nothing\n\n  }\n}\n\nfunction endTagInFrameset(p, token) {\n  if (token.tagID === $.FRAMESET && !p.openElements.isRootHtmlElementCurrent()) {\n    p.openElements.pop();\n\n    if (!p.fragmentContext && p.openElements.currentTagId !== $.FRAMESET) {\n      p.insertionMode = InsertionMode.AFTER_FRAMESET;\n    }\n  }\n} // The \"after frameset\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterFrameset(p, token) {\n  switch (token.tagID) {\n    case $.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case $.NOFRAMES:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    default: // Do nothing\n\n  }\n}\n\nfunction endTagAfterFrameset(p, token) {\n  if (token.tagID === $.HTML) {\n    p.insertionMode = InsertionMode.AFTER_AFTER_FRAMESET;\n  }\n} // The \"after after body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterAfterBody(p, token) {\n  if (token.tagID === $.HTML) {\n    startTagInBody(p, token);\n  } else {\n    tokenAfterAfterBody(p, token);\n  }\n}\n\nfunction tokenAfterAfterBody(p, token) {\n  p.insertionMode = InsertionMode.IN_BODY;\n  modeInBody(p, token);\n} // The \"after after frameset\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterAfterFrameset(p, token) {\n  switch (token.tagID) {\n    case $.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case $.NOFRAMES:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    default: // Do nothing\n\n  }\n} // The rules for parsing tokens in foreign content\n//------------------------------------------------------------------\n\n\nfunction nullCharacterInForeignContent(p, token) {\n  token.chars = unicode.REPLACEMENT_CHARACTER;\n\n  p._insertCharacters(token);\n}\n\nfunction characterInForeignContent(p, token) {\n  p._insertCharacters(token);\n\n  p.framesetOk = false;\n}\n\nfunction popUntilHtmlOrIntegrationPoint(p) {\n  while (p.treeAdapter.getNamespaceURI(p.openElements.current) !== NS.HTML && !p._isIntegrationPoint(p.openElements.currentTagId, p.openElements.current)) {\n    p.openElements.pop();\n  }\n}\n\nfunction startTagInForeignContent(p, token) {\n  if (foreignContent.causesExit(token)) {\n    popUntilHtmlOrIntegrationPoint(p);\n\n    p._startTagOutsideForeignContent(token);\n  } else {\n    const current = p._getAdjustedCurrentElement();\n\n    const currentNs = p.treeAdapter.getNamespaceURI(current);\n\n    if (currentNs === NS.MATHML) {\n      foreignContent.adjustTokenMathMLAttrs(token);\n    } else if (currentNs === NS.SVG) {\n      foreignContent.adjustTokenSVGTagName(token);\n      foreignContent.adjustTokenSVGAttrs(token);\n    }\n\n    foreignContent.adjustTokenXMLAttrs(token);\n\n    if (token.selfClosing) {\n      p._appendElement(token, currentNs);\n    } else {\n      p._insertElement(token, currentNs);\n    }\n\n    token.ackSelfClosing = true;\n  }\n}\n\nfunction endTagInForeignContent(p, token) {\n  if (token.tagID === $.P || token.tagID === $.BR) {\n    popUntilHtmlOrIntegrationPoint(p);\n\n    p._endTagOutsideForeignContent(token);\n\n    return;\n  }\n\n  for (let i = p.openElements.stackTop; i > 0; i--) {\n    const element = p.openElements.items[i];\n\n    if (p.treeAdapter.getNamespaceURI(element) === NS.HTML) {\n      p._endTagOutsideForeignContent(token);\n\n      break;\n    }\n\n    const tagName = p.treeAdapter.getTagName(element);\n\n    if (tagName.toLowerCase() === token.tagName) {\n      //NOTE: update the token tag name for `_setEndLocation`.\n      token.tagName = tagName;\n      p.openElements.shortenToLength(i);\n      break;\n    }\n  }\n}","map":{"version":3,"names":["Tokenizer","TokenizerMode","OpenElementStack","FormattingElementList","EntryType","defaultTreeAdapter","doctype","foreignContent","ERR","unicode","TAG_ID","$","TAG_NAMES","TN","NS","ATTRS","SPECIAL_ELEMENTS","DOCUMENT_MODE","isNumberedHeader","getTagID","TokenType","getTokenAttr","HIDDEN_INPUT_TYPE","AA_OUTER_LOOP_ITER","AA_INNER_LOOP_ITER","InsertionMode","BASE_LOC","startLine","startCol","startOffset","endLine","endCol","endOffset","TABLE_STRUCTURE_TAGS","Set","TABLE","TBODY","TFOOT","THEAD","TR","defaultParserOptions","scriptingEnabled","sourceCodeLocationInfo","treeAdapter","onParseError","Parser","constructor","options","document","fragmentContext","scriptHandler","currentToken","stopped","insertionMode","INITIAL","originalInsertionMode","headElement","formElement","currentNotInHTML","tmplInsertionModeStack","pendingCharacterTokens","hasNonWhitespacePendingCharacterToken","framesetOk","skipNextNewLine","fosterParentingEnabled","createDocument","tokenizer","activeFormattingElements","fragmentContextID","getTagName","UNKNOWN","_setContextModes","openElements","parse","html","parser","write","getFragmentParser","opts","createElement","TEMPLATE","HTML","documentMock","unshift","IN_TEMPLATE","_initTokenizerForFragmentParsing","_insertFakeRootElement","_resetInsertionMode","_findFormInFragmentContext","getFragment","rootElement","getFirstChild","fragment","createDocumentFragment","_adoptNodes","_err","token","code","beforeToken","_a","loc","location","err","onItemPush","node","tid","isTop","_b","call","stackTop","onItemPop","_setEndLocation","current","currentTagId","isHTML","getNamespaceURI","inForeignNode","_isIntegrationPoint","_switchToTextParsing","nextTokenizerState","_insertElement","state","TEXT","switchToPlaintextParsing","IN_BODY","PLAINTEXT","_getAdjustedCurrentElement","FORM","getParentNode","TITLE","TEXTAREA","RCDATA","STYLE","XMP","IFRAME","NOEMBED","NOFRAMES","NOSCRIPT","RAWTEXT","SCRIPT","SCRIPT_DATA","_setDocumentType","name","publicId","systemId","setDocumentType","documentChildren","getChildNodes","docTypeNode","find","isDocumentTypeNode","setNodeSourceCodeLocation","_attachElementToTree","element","startTag","_shouldFosterParentOnInsertion","_fosterParentElement","parent","currentTmplContentOrNode","appendChild","_appendElement","namespaceURI","tagName","attrs","push","tagID","_insertFakeElement","_insertTemplate","tmpl","content","setTemplateContent","_appendCommentNode","commentNode","createCommentNode","data","_insertCharacters","beforeElement","_findFosterParentingLocation","insertTextBefore","chars","insertText","siblings","textNodeIdx","lastIndexOf","length","textNode","tnLoc","getNodeSourceCodeLocation","updateNodeSourceCodeLocation","donor","recipient","child","detachNode","closingToken","ctLoc","tn","endLoc","type","END_TAG","endTag","shouldProcessStartTagTokenInForeignContent","SVG","ANNOTATION_XML","MATHML","MGLYPH","MALIGNMARK","_processToken","CHARACTER","onCharacter","NULL_CHARACTER","onNullCharacter","COMMENT","onComment","DOCTYPE","onDoctype","START_TAG","_processStartTag","onEndTag","EOF","onEof","WHITESPACE_CHARACTER","onWhitespaceCharacter","foreignNS","ns","getAttrList","isIntegrationPoint","_reconstructActiveFormattingElements","listLength","entries","endIndex","findIndex","entry","Marker","contains","unopenIdx","i","_closeTableCell","generateImpliedEndTags","popUntilTableCellPopped","clearToLastMarker","IN_ROW","_closePElement","generateImpliedEndTagsWithExclusion","P","popUntilTagNamePopped","tagIDs","IN_TABLE_BODY","CAPTION","IN_CAPTION","COLGROUP","IN_COLUMN_GROUP","IN_TABLE","BODY","FRAMESET","IN_FRAMESET","SELECT","_resetInsertionModeForSelect","AFTER_HEAD","BEFORE_HEAD","TD","TH","IN_CELL","HEAD","IN_HEAD","selectIdx","IN_SELECT_IN_TABLE","IN_SELECT","_isElementCausesFosterParenting","has","openElement","items","getTemplateContent","insertBefore","_isSpecialElement","id","characterInForeignContent","tokenInInitialMode","BEFORE_HTML","tokenBeforeHtml","tokenBeforeHead","tokenInHead","IN_HEAD_NO_SCRIPT","tokenInHeadNoScript","tokenAfterHead","characterInBody","characterInTable","IN_TABLE_TEXT","characterInTableText","tokenInColumnGroup","AFTER_BODY","tokenAfterBody","AFTER_AFTER_BODY","tokenAfterAfterBody","nullCharacterInForeignContent","appendComment","AFTER_FRAMESET","tokenInTableText","appendCommentToRootHtmlElement","AFTER_AFTER_FRAMESET","appendCommentToDocument","doctypeInInitialMode","misplacedDoctype","onStartTag","selfClosing","ackSelfClosing","nonVoidHtmlElementStartTagWithTrailingSolidus","startTagInForeignContent","_startTagOutsideForeignContent","startTagBeforeHtml","startTagBeforeHead","startTagInHead","startTagInHeadNoScript","startTagAfterHead","startTagInBody","startTagInTable","startTagInCaption","startTagInColumnGroup","startTagInTableBody","startTagInRow","startTagInCell","startTagInSelect","startTagInSelectInTable","startTagInTemplate","startTagAfterBody","startTagInFrameset","startTagAfterFrameset","startTagAfterAfterBody","startTagAfterAfterFrameset","endTagInForeignContent","_endTagOutsideForeignContent","endTagBeforeHtml","endTagBeforeHead","endTagInHead","endTagInHeadNoScript","endTagAfterHead","endTagInBody","endTagInText","endTagInTable","endTagInCaption","endTagInColumnGroup","endTagInTableBody","endTagInRow","endTagInCell","endTagInSelect","endTagInSelectInTable","endTagInTemplate","endTagAfterBody","endTagInFrameset","endTagAfterFrameset","eofInBody","eofInText","eofInTemplate","stopParsing","charCodeAt","CODE_POINTS","LINE_FEED","substr","whitespaceCharacterInBody","whitespaceCharacterInTableText","aaObtainFormattingElementEntry","p","formattingElementEntry","getElementEntryInScopeWithTagName","removeEntry","hasInScope","genericEndTagInBody","aaObtainFurthestBlock","furthestBlock","idx","shortenToLength","aaInnerLoop","formattingElement","lastElement","nextElement","getCommonAncestor","elementEntry","getElementEntry","counterOverflow","shouldRemoveFromOpenElements","remove","aaRecreateElementFromEntry","bookmark","newElement","replace","aaInsertLastNodeInCommonAncestor","commonAncestor","aaReplaceFormattingElement","insertElementAfterBookmark","insertAfter","callAdoptionAgency","target","htmlElement","htmlLocation","bodyElement","bodyLocation","mode","forceQuirks","QUIRKS","getDocumentMode","isConforming","nonConformingDoctype","setDocumentMode","missingDoctype","BR","endTagWithoutMatchingOpenElement","BASE","BASEFONT","BGSOUND","LINK","META","insertMarker","misplacedStartTagForHeadElement","pop","templateEndTagInHead","tmplCount","generateImpliedEndTagsThoroughly","closingOfElementWithOpenChildElements","shift","nestedNoscriptInHead","errCode","openElementsLeftAfterEof","disallowedContentInNoscriptInHead","abandonedHeadElementChild","modeInBody","htmlStartTagInBody","adoptAttributes","bodyStartTagInBody","tryPeekProperlyNestedBodyElement","framesetStartTagInBody","popAllUpToHtmlElement","addressStartTagInBody","hasInButtonScope","numberedHeaderStartTagInBody","preStartTagInBody","formStartTagInBody","inTemplate","listItemStartTagInBody","elementId","LI","DD","DT","ADDRESS","DIV","plaintextStartTagInBody","buttonStartTagInBody","BUTTON","aStartTagInBody","activeElementEntry","A","pushElement","bStartTagInBody","nobrStartTagInBody","NOBR","appletStartTagInBody","tableStartTagInBody","areaStartTagInBody","isHiddenInput","inputType","TYPE","toLowerCase","inputStartTagInBody","paramStartTagInBody","hrStartTagInBody","imageStartTagInBody","IMG","textareaStartTagInBody","xmpStartTagInBody","iframeStartTagInBody","noembedStartTagInBody","selectStartTagInBody","optgroupStartTagInBody","OPTION","rbStartTagInBody","RUBY","rtStartTagInBody","RTC","mathStartTagInBody","adjustTokenMathMLAttrs","adjustTokenXMLAttrs","svgStartTagInBody","adjustTokenSVGAttrs","genericStartTagInBody","I","S","B","U","EM","TT","BIG","CODE","FONT","SMALL","STRIKE","STRONG","H1","H2","H3","H4","H5","H6","DL","OL","UL","DIR","NAV","MAIN","MENU","ASIDE","CENTER","FIGURE","FOOTER","HEADER","HGROUP","DIALOG","DETAILS","ARTICLE","SECTION","SUMMARY","FIELDSET","BLOCKQUOTE","FIGCAPTION","WBR","AREA","EMBED","KEYGEN","HR","RB","RT","RP","PRE","LISTING","MATH","INPUT","PARAM","TRACK","SOURCE","IMAGE","APPLET","OBJECT","MARQUEE","OPTGROUP","COL","FRAME","bodyEndTagInBody","htmlEndTagInBody","addressEndTagInBody","formEndTagInBody","pEndTagInBody","liEndTagInBody","hasInListItemScope","ddEndTagInBody","numberedHeaderEndTagInBody","hasNumberedHeaderInScope","popUntilNumberedHeaderPopped","appletEndTagInBody","brEndTagInBody","eofInElementThatCanContainOnlyText","tokenInTable","captionStartTagInTable","clearBackToTableContext","colgroupStartTagInTable","colStartTagInTable","tbodyStartTagInTable","tdStartTagInTable","tableStartTagInTable","hasInTableScope","inputStartTagInTable","formStartTagInTable","savedFosterParentingState","TABLE_VOID_ELEMENTS","clearBackToTableBodyContext","hasTableBodyContextInTableScope","clearBackToTableRowContext","hasInSelectScope","isRootHtmlElementCurrent","REPLACEMENT_CHARACTER","popUntilHtmlOrIntegrationPoint","causesExit","currentNs","adjustTokenSVGTagName"],"sources":["/Users/soheilvafaei/Documents/project/web/web3/ex7/node_modules/parse5-htmlparser2-tree-adapter/node_modules/parse5/dist/parser/index.js"],"sourcesContent":["import { Tokenizer, TokenizerMode } from '../tokenizer/index.js';\nimport { OpenElementStack } from './open-element-stack.js';\nimport { FormattingElementList, EntryType } from './formatting-element-list.js';\nimport { defaultTreeAdapter } from '../tree-adapters/default.js';\nimport * as doctype from '../common/doctype.js';\nimport * as foreignContent from '../common/foreign-content.js';\nimport { ERR } from '../common/error-codes.js';\nimport * as unicode from '../common/unicode.js';\nimport { TAG_ID as $, TAG_NAMES as TN, NS, ATTRS, SPECIAL_ELEMENTS, DOCUMENT_MODE, isNumberedHeader, getTagID, } from '../common/html.js';\nimport { TokenType, getTokenAttr, } from '../common/token.js';\n//Misc constants\nconst HIDDEN_INPUT_TYPE = 'hidden';\n//Adoption agency loops iteration count\nconst AA_OUTER_LOOP_ITER = 8;\nconst AA_INNER_LOOP_ITER = 3;\n//Insertion modes\nvar InsertionMode;\n(function (InsertionMode) {\n    InsertionMode[InsertionMode[\"INITIAL\"] = 0] = \"INITIAL\";\n    InsertionMode[InsertionMode[\"BEFORE_HTML\"] = 1] = \"BEFORE_HTML\";\n    InsertionMode[InsertionMode[\"BEFORE_HEAD\"] = 2] = \"BEFORE_HEAD\";\n    InsertionMode[InsertionMode[\"IN_HEAD\"] = 3] = \"IN_HEAD\";\n    InsertionMode[InsertionMode[\"IN_HEAD_NO_SCRIPT\"] = 4] = \"IN_HEAD_NO_SCRIPT\";\n    InsertionMode[InsertionMode[\"AFTER_HEAD\"] = 5] = \"AFTER_HEAD\";\n    InsertionMode[InsertionMode[\"IN_BODY\"] = 6] = \"IN_BODY\";\n    InsertionMode[InsertionMode[\"TEXT\"] = 7] = \"TEXT\";\n    InsertionMode[InsertionMode[\"IN_TABLE\"] = 8] = \"IN_TABLE\";\n    InsertionMode[InsertionMode[\"IN_TABLE_TEXT\"] = 9] = \"IN_TABLE_TEXT\";\n    InsertionMode[InsertionMode[\"IN_CAPTION\"] = 10] = \"IN_CAPTION\";\n    InsertionMode[InsertionMode[\"IN_COLUMN_GROUP\"] = 11] = \"IN_COLUMN_GROUP\";\n    InsertionMode[InsertionMode[\"IN_TABLE_BODY\"] = 12] = \"IN_TABLE_BODY\";\n    InsertionMode[InsertionMode[\"IN_ROW\"] = 13] = \"IN_ROW\";\n    InsertionMode[InsertionMode[\"IN_CELL\"] = 14] = \"IN_CELL\";\n    InsertionMode[InsertionMode[\"IN_SELECT\"] = 15] = \"IN_SELECT\";\n    InsertionMode[InsertionMode[\"IN_SELECT_IN_TABLE\"] = 16] = \"IN_SELECT_IN_TABLE\";\n    InsertionMode[InsertionMode[\"IN_TEMPLATE\"] = 17] = \"IN_TEMPLATE\";\n    InsertionMode[InsertionMode[\"AFTER_BODY\"] = 18] = \"AFTER_BODY\";\n    InsertionMode[InsertionMode[\"IN_FRAMESET\"] = 19] = \"IN_FRAMESET\";\n    InsertionMode[InsertionMode[\"AFTER_FRAMESET\"] = 20] = \"AFTER_FRAMESET\";\n    InsertionMode[InsertionMode[\"AFTER_AFTER_BODY\"] = 21] = \"AFTER_AFTER_BODY\";\n    InsertionMode[InsertionMode[\"AFTER_AFTER_FRAMESET\"] = 22] = \"AFTER_AFTER_FRAMESET\";\n})(InsertionMode || (InsertionMode = {}));\nconst BASE_LOC = {\n    startLine: -1,\n    startCol: -1,\n    startOffset: -1,\n    endLine: -1,\n    endCol: -1,\n    endOffset: -1,\n};\nconst TABLE_STRUCTURE_TAGS = new Set([$.TABLE, $.TBODY, $.TFOOT, $.THEAD, $.TR]);\nconst defaultParserOptions = {\n    scriptingEnabled: true,\n    sourceCodeLocationInfo: false,\n    treeAdapter: defaultTreeAdapter,\n    onParseError: null,\n};\n//Parser\nexport class Parser {\n    constructor(options, document, fragmentContext = null, scriptHandler = null) {\n        this.fragmentContext = fragmentContext;\n        this.scriptHandler = scriptHandler;\n        this.currentToken = null;\n        this.stopped = false;\n        this.insertionMode = InsertionMode.INITIAL;\n        this.originalInsertionMode = InsertionMode.INITIAL;\n        this.headElement = null;\n        this.formElement = null;\n        /** Indicates that the current node is not an element in the HTML namespace */\n        this.currentNotInHTML = false;\n        /**\n         * The template insertion mode stack is maintained from the left.\n         * Ie. the topmost element will always have index 0.\n         */\n        this.tmplInsertionModeStack = [];\n        this.pendingCharacterTokens = [];\n        this.hasNonWhitespacePendingCharacterToken = false;\n        this.framesetOk = true;\n        this.skipNextNewLine = false;\n        this.fosterParentingEnabled = false;\n        this.options = {\n            ...defaultParserOptions,\n            ...options,\n        };\n        this.treeAdapter = this.options.treeAdapter;\n        this.onParseError = this.options.onParseError;\n        // Always enable location info if we report parse errors.\n        if (this.onParseError) {\n            this.options.sourceCodeLocationInfo = true;\n        }\n        this.document = document !== null && document !== void 0 ? document : this.treeAdapter.createDocument();\n        this.tokenizer = new Tokenizer(this.options, this);\n        this.activeFormattingElements = new FormattingElementList(this.treeAdapter);\n        this.fragmentContextID = fragmentContext ? getTagID(this.treeAdapter.getTagName(fragmentContext)) : $.UNKNOWN;\n        this._setContextModes(fragmentContext !== null && fragmentContext !== void 0 ? fragmentContext : this.document, this.fragmentContextID);\n        this.openElements = new OpenElementStack(this.document, this.treeAdapter, this);\n    }\n    // API\n    static parse(html, options) {\n        const parser = new this(options);\n        parser.tokenizer.write(html, true);\n        return parser.document;\n    }\n    static getFragmentParser(fragmentContext, options) {\n        const opts = {\n            ...defaultParserOptions,\n            ...options,\n        };\n        //NOTE: use a <template> element as the fragment context if no context element was provided,\n        //so we will parse in a \"forgiving\" manner\n        fragmentContext !== null && fragmentContext !== void 0 ? fragmentContext : (fragmentContext = opts.treeAdapter.createElement(TN.TEMPLATE, NS.HTML, []));\n        //NOTE: create a fake element which will be used as the `document` for fragment parsing.\n        //This is important for jsdom, where a new `document` cannot be created. This led to\n        //fragment parsing messing with the main `document`.\n        const documentMock = opts.treeAdapter.createElement('documentmock', NS.HTML, []);\n        const parser = new this(opts, documentMock, fragmentContext);\n        if (parser.fragmentContextID === $.TEMPLATE) {\n            parser.tmplInsertionModeStack.unshift(InsertionMode.IN_TEMPLATE);\n        }\n        parser._initTokenizerForFragmentParsing();\n        parser._insertFakeRootElement();\n        parser._resetInsertionMode();\n        parser._findFormInFragmentContext();\n        return parser;\n    }\n    getFragment() {\n        const rootElement = this.treeAdapter.getFirstChild(this.document);\n        const fragment = this.treeAdapter.createDocumentFragment();\n        this._adoptNodes(rootElement, fragment);\n        return fragment;\n    }\n    //Errors\n    _err(token, code, beforeToken) {\n        var _a;\n        if (!this.onParseError)\n            return;\n        const loc = (_a = token.location) !== null && _a !== void 0 ? _a : BASE_LOC;\n        const err = {\n            code,\n            startLine: loc.startLine,\n            startCol: loc.startCol,\n            startOffset: loc.startOffset,\n            endLine: beforeToken ? loc.startLine : loc.endLine,\n            endCol: beforeToken ? loc.startCol : loc.endCol,\n            endOffset: beforeToken ? loc.startOffset : loc.endOffset,\n        };\n        this.onParseError(err);\n    }\n    //Stack events\n    onItemPush(node, tid, isTop) {\n        var _a, _b;\n        (_b = (_a = this.treeAdapter).onItemPush) === null || _b === void 0 ? void 0 : _b.call(_a, node);\n        if (isTop && this.openElements.stackTop > 0)\n            this._setContextModes(node, tid);\n    }\n    onItemPop(node, isTop) {\n        var _a, _b;\n        if (this.options.sourceCodeLocationInfo) {\n            this._setEndLocation(node, this.currentToken);\n        }\n        (_b = (_a = this.treeAdapter).onItemPop) === null || _b === void 0 ? void 0 : _b.call(_a, node, this.openElements.current);\n        if (isTop) {\n            let current;\n            let currentTagId;\n            if (this.openElements.stackTop === 0 && this.fragmentContext) {\n                current = this.fragmentContext;\n                currentTagId = this.fragmentContextID;\n            }\n            else {\n                ({ current, currentTagId } = this.openElements);\n            }\n            this._setContextModes(current, currentTagId);\n        }\n    }\n    _setContextModes(current, tid) {\n        const isHTML = current === this.document || this.treeAdapter.getNamespaceURI(current) === NS.HTML;\n        this.currentNotInHTML = !isHTML;\n        this.tokenizer.inForeignNode = !isHTML && !this._isIntegrationPoint(tid, current);\n    }\n    _switchToTextParsing(currentToken, nextTokenizerState) {\n        this._insertElement(currentToken, NS.HTML);\n        this.tokenizer.state = nextTokenizerState;\n        this.originalInsertionMode = this.insertionMode;\n        this.insertionMode = InsertionMode.TEXT;\n    }\n    switchToPlaintextParsing() {\n        this.insertionMode = InsertionMode.TEXT;\n        this.originalInsertionMode = InsertionMode.IN_BODY;\n        this.tokenizer.state = TokenizerMode.PLAINTEXT;\n    }\n    //Fragment parsing\n    _getAdjustedCurrentElement() {\n        return this.openElements.stackTop === 0 && this.fragmentContext\n            ? this.fragmentContext\n            : this.openElements.current;\n    }\n    _findFormInFragmentContext() {\n        let node = this.fragmentContext;\n        while (node) {\n            if (this.treeAdapter.getTagName(node) === TN.FORM) {\n                this.formElement = node;\n                break;\n            }\n            node = this.treeAdapter.getParentNode(node);\n        }\n    }\n    _initTokenizerForFragmentParsing() {\n        if (!this.fragmentContext || this.treeAdapter.getNamespaceURI(this.fragmentContext) !== NS.HTML) {\n            return;\n        }\n        switch (this.fragmentContextID) {\n            case $.TITLE:\n            case $.TEXTAREA: {\n                this.tokenizer.state = TokenizerMode.RCDATA;\n                break;\n            }\n            case $.STYLE:\n            case $.XMP:\n            case $.IFRAME:\n            case $.NOEMBED:\n            case $.NOFRAMES:\n            case $.NOSCRIPT: {\n                this.tokenizer.state = TokenizerMode.RAWTEXT;\n                break;\n            }\n            case $.SCRIPT: {\n                this.tokenizer.state = TokenizerMode.SCRIPT_DATA;\n                break;\n            }\n            case $.PLAINTEXT: {\n                this.tokenizer.state = TokenizerMode.PLAINTEXT;\n                break;\n            }\n            default:\n            // Do nothing\n        }\n    }\n    //Tree mutation\n    _setDocumentType(token) {\n        const name = token.name || '';\n        const publicId = token.publicId || '';\n        const systemId = token.systemId || '';\n        this.treeAdapter.setDocumentType(this.document, name, publicId, systemId);\n        if (token.location) {\n            const documentChildren = this.treeAdapter.getChildNodes(this.document);\n            const docTypeNode = documentChildren.find((node) => this.treeAdapter.isDocumentTypeNode(node));\n            if (docTypeNode) {\n                this.treeAdapter.setNodeSourceCodeLocation(docTypeNode, token.location);\n            }\n        }\n    }\n    _attachElementToTree(element, location) {\n        if (this.options.sourceCodeLocationInfo) {\n            const loc = location && {\n                ...location,\n                startTag: location,\n            };\n            this.treeAdapter.setNodeSourceCodeLocation(element, loc);\n        }\n        if (this._shouldFosterParentOnInsertion()) {\n            this._fosterParentElement(element);\n        }\n        else {\n            const parent = this.openElements.currentTmplContentOrNode;\n            this.treeAdapter.appendChild(parent, element);\n        }\n    }\n    _appendElement(token, namespaceURI) {\n        const element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n        this._attachElementToTree(element, token.location);\n    }\n    _insertElement(token, namespaceURI) {\n        const element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n        this._attachElementToTree(element, token.location);\n        this.openElements.push(element, token.tagID);\n    }\n    _insertFakeElement(tagName, tagID) {\n        const element = this.treeAdapter.createElement(tagName, NS.HTML, []);\n        this._attachElementToTree(element, null);\n        this.openElements.push(element, tagID);\n    }\n    _insertTemplate(token) {\n        const tmpl = this.treeAdapter.createElement(token.tagName, NS.HTML, token.attrs);\n        const content = this.treeAdapter.createDocumentFragment();\n        this.treeAdapter.setTemplateContent(tmpl, content);\n        this._attachElementToTree(tmpl, token.location);\n        this.openElements.push(tmpl, token.tagID);\n        if (this.options.sourceCodeLocationInfo)\n            this.treeAdapter.setNodeSourceCodeLocation(content, null);\n    }\n    _insertFakeRootElement() {\n        const element = this.treeAdapter.createElement(TN.HTML, NS.HTML, []);\n        if (this.options.sourceCodeLocationInfo)\n            this.treeAdapter.setNodeSourceCodeLocation(element, null);\n        this.treeAdapter.appendChild(this.openElements.current, element);\n        this.openElements.push(element, $.HTML);\n    }\n    _appendCommentNode(token, parent) {\n        const commentNode = this.treeAdapter.createCommentNode(token.data);\n        this.treeAdapter.appendChild(parent, commentNode);\n        if (this.options.sourceCodeLocationInfo) {\n            this.treeAdapter.setNodeSourceCodeLocation(commentNode, token.location);\n        }\n    }\n    _insertCharacters(token) {\n        let parent;\n        let beforeElement;\n        if (this._shouldFosterParentOnInsertion()) {\n            ({ parent, beforeElement } = this._findFosterParentingLocation());\n            if (beforeElement) {\n                this.treeAdapter.insertTextBefore(parent, token.chars, beforeElement);\n            }\n            else {\n                this.treeAdapter.insertText(parent, token.chars);\n            }\n        }\n        else {\n            parent = this.openElements.currentTmplContentOrNode;\n            this.treeAdapter.insertText(parent, token.chars);\n        }\n        if (!token.location)\n            return;\n        const siblings = this.treeAdapter.getChildNodes(parent);\n        const textNodeIdx = beforeElement ? siblings.lastIndexOf(beforeElement) : siblings.length;\n        const textNode = siblings[textNodeIdx - 1];\n        //NOTE: if we have a location assigned by another token, then just update the end position\n        const tnLoc = this.treeAdapter.getNodeSourceCodeLocation(textNode);\n        if (tnLoc) {\n            const { endLine, endCol, endOffset } = token.location;\n            this.treeAdapter.updateNodeSourceCodeLocation(textNode, { endLine, endCol, endOffset });\n        }\n        else if (this.options.sourceCodeLocationInfo) {\n            this.treeAdapter.setNodeSourceCodeLocation(textNode, token.location);\n        }\n    }\n    _adoptNodes(donor, recipient) {\n        for (let child = this.treeAdapter.getFirstChild(donor); child; child = this.treeAdapter.getFirstChild(donor)) {\n            this.treeAdapter.detachNode(child);\n            this.treeAdapter.appendChild(recipient, child);\n        }\n    }\n    _setEndLocation(element, closingToken) {\n        if (this.treeAdapter.getNodeSourceCodeLocation(element) && closingToken.location) {\n            const ctLoc = closingToken.location;\n            const tn = this.treeAdapter.getTagName(element);\n            const endLoc = \n            // NOTE: For cases like <p> <p> </p> - First 'p' closes without a closing\n            // tag and for cases like <td> <p> </td> - 'p' closes without a closing tag.\n            closingToken.type === TokenType.END_TAG && tn === closingToken.tagName\n                ? {\n                    endTag: { ...ctLoc },\n                    endLine: ctLoc.endLine,\n                    endCol: ctLoc.endCol,\n                    endOffset: ctLoc.endOffset,\n                }\n                : {\n                    endLine: ctLoc.startLine,\n                    endCol: ctLoc.startCol,\n                    endOffset: ctLoc.startOffset,\n                };\n            this.treeAdapter.updateNodeSourceCodeLocation(element, endLoc);\n        }\n    }\n    //Token processing\n    shouldProcessStartTagTokenInForeignContent(token) {\n        // Check that neither current === document, or ns === NS.HTML\n        if (!this.currentNotInHTML)\n            return false;\n        let current;\n        let currentTagId;\n        if (this.openElements.stackTop === 0 && this.fragmentContext) {\n            current = this.fragmentContext;\n            currentTagId = this.fragmentContextID;\n        }\n        else {\n            ({ current, currentTagId } = this.openElements);\n        }\n        if (token.tagID === $.SVG &&\n            this.treeAdapter.getTagName(current) === TN.ANNOTATION_XML &&\n            this.treeAdapter.getNamespaceURI(current) === NS.MATHML) {\n            return false;\n        }\n        return (\n        // Check that `current` is not an integration point for HTML or MathML elements.\n        this.tokenizer.inForeignNode ||\n            // If it _is_ an integration point, then we might have to check that it is not an HTML\n            // integration point.\n            ((token.tagID === $.MGLYPH || token.tagID === $.MALIGNMARK) &&\n                !this._isIntegrationPoint(currentTagId, current, NS.HTML)));\n    }\n    _processToken(token) {\n        switch (token.type) {\n            case TokenType.CHARACTER: {\n                this.onCharacter(token);\n                break;\n            }\n            case TokenType.NULL_CHARACTER: {\n                this.onNullCharacter(token);\n                break;\n            }\n            case TokenType.COMMENT: {\n                this.onComment(token);\n                break;\n            }\n            case TokenType.DOCTYPE: {\n                this.onDoctype(token);\n                break;\n            }\n            case TokenType.START_TAG: {\n                this._processStartTag(token);\n                break;\n            }\n            case TokenType.END_TAG: {\n                this.onEndTag(token);\n                break;\n            }\n            case TokenType.EOF: {\n                this.onEof(token);\n                break;\n            }\n            case TokenType.WHITESPACE_CHARACTER: {\n                this.onWhitespaceCharacter(token);\n                break;\n            }\n        }\n    }\n    //Integration points\n    _isIntegrationPoint(tid, element, foreignNS) {\n        const ns = this.treeAdapter.getNamespaceURI(element);\n        const attrs = this.treeAdapter.getAttrList(element);\n        return foreignContent.isIntegrationPoint(tid, ns, attrs, foreignNS);\n    }\n    //Active formatting elements reconstruction\n    _reconstructActiveFormattingElements() {\n        const listLength = this.activeFormattingElements.entries.length;\n        if (listLength) {\n            const endIndex = this.activeFormattingElements.entries.findIndex((entry) => entry.type === EntryType.Marker || this.openElements.contains(entry.element));\n            const unopenIdx = endIndex < 0 ? listLength - 1 : endIndex - 1;\n            for (let i = unopenIdx; i >= 0; i--) {\n                const entry = this.activeFormattingElements.entries[i];\n                this._insertElement(entry.token, this.treeAdapter.getNamespaceURI(entry.element));\n                entry.element = this.openElements.current;\n            }\n        }\n    }\n    //Close elements\n    _closeTableCell() {\n        this.openElements.generateImpliedEndTags();\n        this.openElements.popUntilTableCellPopped();\n        this.activeFormattingElements.clearToLastMarker();\n        this.insertionMode = InsertionMode.IN_ROW;\n    }\n    _closePElement() {\n        this.openElements.generateImpliedEndTagsWithExclusion($.P);\n        this.openElements.popUntilTagNamePopped($.P);\n    }\n    //Insertion modes\n    _resetInsertionMode() {\n        for (let i = this.openElements.stackTop; i >= 0; i--) {\n            //Insertion mode reset map\n            switch (i === 0 && this.fragmentContext ? this.fragmentContextID : this.openElements.tagIDs[i]) {\n                case $.TR:\n                    this.insertionMode = InsertionMode.IN_ROW;\n                    return;\n                case $.TBODY:\n                case $.THEAD:\n                case $.TFOOT:\n                    this.insertionMode = InsertionMode.IN_TABLE_BODY;\n                    return;\n                case $.CAPTION:\n                    this.insertionMode = InsertionMode.IN_CAPTION;\n                    return;\n                case $.COLGROUP:\n                    this.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n                    return;\n                case $.TABLE:\n                    this.insertionMode = InsertionMode.IN_TABLE;\n                    return;\n                case $.BODY:\n                    this.insertionMode = InsertionMode.IN_BODY;\n                    return;\n                case $.FRAMESET:\n                    this.insertionMode = InsertionMode.IN_FRAMESET;\n                    return;\n                case $.SELECT:\n                    this._resetInsertionModeForSelect(i);\n                    return;\n                case $.TEMPLATE:\n                    this.insertionMode = this.tmplInsertionModeStack[0];\n                    return;\n                case $.HTML:\n                    this.insertionMode = this.headElement ? InsertionMode.AFTER_HEAD : InsertionMode.BEFORE_HEAD;\n                    return;\n                case $.TD:\n                case $.TH:\n                    if (i > 0) {\n                        this.insertionMode = InsertionMode.IN_CELL;\n                        return;\n                    }\n                    break;\n                case $.HEAD:\n                    if (i > 0) {\n                        this.insertionMode = InsertionMode.IN_HEAD;\n                        return;\n                    }\n                    break;\n            }\n        }\n        this.insertionMode = InsertionMode.IN_BODY;\n    }\n    _resetInsertionModeForSelect(selectIdx) {\n        if (selectIdx > 0) {\n            for (let i = selectIdx - 1; i > 0; i--) {\n                const tn = this.openElements.tagIDs[i];\n                if (tn === $.TEMPLATE) {\n                    break;\n                }\n                else if (tn === $.TABLE) {\n                    this.insertionMode = InsertionMode.IN_SELECT_IN_TABLE;\n                    return;\n                }\n            }\n        }\n        this.insertionMode = InsertionMode.IN_SELECT;\n    }\n    //Foster parenting\n    _isElementCausesFosterParenting(tn) {\n        return TABLE_STRUCTURE_TAGS.has(tn);\n    }\n    _shouldFosterParentOnInsertion() {\n        return this.fosterParentingEnabled && this._isElementCausesFosterParenting(this.openElements.currentTagId);\n    }\n    _findFosterParentingLocation() {\n        for (let i = this.openElements.stackTop; i >= 0; i--) {\n            const openElement = this.openElements.items[i];\n            switch (this.openElements.tagIDs[i]) {\n                case $.TEMPLATE:\n                    if (this.treeAdapter.getNamespaceURI(openElement) === NS.HTML) {\n                        return { parent: this.treeAdapter.getTemplateContent(openElement), beforeElement: null };\n                    }\n                    break;\n                case $.TABLE: {\n                    const parent = this.treeAdapter.getParentNode(openElement);\n                    if (parent) {\n                        return { parent, beforeElement: openElement };\n                    }\n                    return { parent: this.openElements.items[i - 1], beforeElement: null };\n                }\n                default:\n                // Do nothing\n            }\n        }\n        return { parent: this.openElements.items[0], beforeElement: null };\n    }\n    _fosterParentElement(element) {\n        const location = this._findFosterParentingLocation();\n        if (location.beforeElement) {\n            this.treeAdapter.insertBefore(location.parent, element, location.beforeElement);\n        }\n        else {\n            this.treeAdapter.appendChild(location.parent, element);\n        }\n    }\n    //Special elements\n    _isSpecialElement(element, id) {\n        const ns = this.treeAdapter.getNamespaceURI(element);\n        return SPECIAL_ELEMENTS[ns].has(id);\n    }\n    onCharacter(token) {\n        this.skipNextNewLine = false;\n        if (this.tokenizer.inForeignNode) {\n            characterInForeignContent(this, token);\n            return;\n        }\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n                tokenInInitialMode(this, token);\n                break;\n            case InsertionMode.BEFORE_HTML:\n                tokenBeforeHtml(this, token);\n                break;\n            case InsertionMode.BEFORE_HEAD:\n                tokenBeforeHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD:\n                tokenInHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n                tokenInHeadNoScript(this, token);\n                break;\n            case InsertionMode.AFTER_HEAD:\n                tokenAfterHead(this, token);\n                break;\n            case InsertionMode.IN_BODY:\n            case InsertionMode.IN_CAPTION:\n            case InsertionMode.IN_CELL:\n            case InsertionMode.IN_TEMPLATE:\n                characterInBody(this, token);\n                break;\n            case InsertionMode.TEXT:\n            case InsertionMode.IN_SELECT:\n            case InsertionMode.IN_SELECT_IN_TABLE:\n                this._insertCharacters(token);\n                break;\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW:\n                characterInTable(this, token);\n                break;\n            case InsertionMode.IN_TABLE_TEXT:\n                characterInTableText(this, token);\n                break;\n            case InsertionMode.IN_COLUMN_GROUP:\n                tokenInColumnGroup(this, token);\n                break;\n            case InsertionMode.AFTER_BODY:\n                tokenAfterBody(this, token);\n                break;\n            case InsertionMode.AFTER_AFTER_BODY:\n                tokenAfterAfterBody(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n    onNullCharacter(token) {\n        this.skipNextNewLine = false;\n        if (this.tokenizer.inForeignNode) {\n            nullCharacterInForeignContent(this, token);\n            return;\n        }\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n                tokenInInitialMode(this, token);\n                break;\n            case InsertionMode.BEFORE_HTML:\n                tokenBeforeHtml(this, token);\n                break;\n            case InsertionMode.BEFORE_HEAD:\n                tokenBeforeHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD:\n                tokenInHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n                tokenInHeadNoScript(this, token);\n                break;\n            case InsertionMode.AFTER_HEAD:\n                tokenAfterHead(this, token);\n                break;\n            case InsertionMode.TEXT:\n                this._insertCharacters(token);\n                break;\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW:\n                characterInTable(this, token);\n                break;\n            case InsertionMode.IN_COLUMN_GROUP:\n                tokenInColumnGroup(this, token);\n                break;\n            case InsertionMode.AFTER_BODY:\n                tokenAfterBody(this, token);\n                break;\n            case InsertionMode.AFTER_AFTER_BODY:\n                tokenAfterAfterBody(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n    onComment(token) {\n        this.skipNextNewLine = false;\n        if (this.currentNotInHTML) {\n            appendComment(this, token);\n            return;\n        }\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n            case InsertionMode.BEFORE_HTML:\n            case InsertionMode.BEFORE_HEAD:\n            case InsertionMode.IN_HEAD:\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n            case InsertionMode.AFTER_HEAD:\n            case InsertionMode.IN_BODY:\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_CAPTION:\n            case InsertionMode.IN_COLUMN_GROUP:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW:\n            case InsertionMode.IN_CELL:\n            case InsertionMode.IN_SELECT:\n            case InsertionMode.IN_SELECT_IN_TABLE:\n            case InsertionMode.IN_TEMPLATE:\n            case InsertionMode.IN_FRAMESET:\n            case InsertionMode.AFTER_FRAMESET:\n                appendComment(this, token);\n                break;\n            case InsertionMode.IN_TABLE_TEXT:\n                tokenInTableText(this, token);\n                break;\n            case InsertionMode.AFTER_BODY:\n                appendCommentToRootHtmlElement(this, token);\n                break;\n            case InsertionMode.AFTER_AFTER_BODY:\n            case InsertionMode.AFTER_AFTER_FRAMESET:\n                appendCommentToDocument(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n    onDoctype(token) {\n        this.skipNextNewLine = false;\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n                doctypeInInitialMode(this, token);\n                break;\n            case InsertionMode.BEFORE_HEAD:\n            case InsertionMode.IN_HEAD:\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n            case InsertionMode.AFTER_HEAD:\n                this._err(token, ERR.misplacedDoctype);\n                break;\n            case InsertionMode.IN_TABLE_TEXT:\n                tokenInTableText(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n    onStartTag(token) {\n        this.skipNextNewLine = false;\n        this.currentToken = token;\n        this._processStartTag(token);\n        if (token.selfClosing && !token.ackSelfClosing) {\n            this._err(token, ERR.nonVoidHtmlElementStartTagWithTrailingSolidus);\n        }\n    }\n    /**\n     * Processes a given start tag.\n     *\n     * `onStartTag` checks if a self-closing tag was recognized. When a token\n     * is moved inbetween multiple insertion modes, this check for self-closing\n     * could lead to false positives. To avoid this, `_processStartTag` is used\n     * for nested calls.\n     *\n     * @param token The token to process.\n     */\n    _processStartTag(token) {\n        if (this.shouldProcessStartTagTokenInForeignContent(token)) {\n            startTagInForeignContent(this, token);\n        }\n        else {\n            this._startTagOutsideForeignContent(token);\n        }\n    }\n    _startTagOutsideForeignContent(token) {\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n                tokenInInitialMode(this, token);\n                break;\n            case InsertionMode.BEFORE_HTML:\n                startTagBeforeHtml(this, token);\n                break;\n            case InsertionMode.BEFORE_HEAD:\n                startTagBeforeHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD:\n                startTagInHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n                startTagInHeadNoScript(this, token);\n                break;\n            case InsertionMode.AFTER_HEAD:\n                startTagAfterHead(this, token);\n                break;\n            case InsertionMode.IN_BODY:\n                startTagInBody(this, token);\n                break;\n            case InsertionMode.IN_TABLE:\n                startTagInTable(this, token);\n                break;\n            case InsertionMode.IN_TABLE_TEXT:\n                tokenInTableText(this, token);\n                break;\n            case InsertionMode.IN_CAPTION:\n                startTagInCaption(this, token);\n                break;\n            case InsertionMode.IN_COLUMN_GROUP:\n                startTagInColumnGroup(this, token);\n                break;\n            case InsertionMode.IN_TABLE_BODY:\n                startTagInTableBody(this, token);\n                break;\n            case InsertionMode.IN_ROW:\n                startTagInRow(this, token);\n                break;\n            case InsertionMode.IN_CELL:\n                startTagInCell(this, token);\n                break;\n            case InsertionMode.IN_SELECT:\n                startTagInSelect(this, token);\n                break;\n            case InsertionMode.IN_SELECT_IN_TABLE:\n                startTagInSelectInTable(this, token);\n                break;\n            case InsertionMode.IN_TEMPLATE:\n                startTagInTemplate(this, token);\n                break;\n            case InsertionMode.AFTER_BODY:\n                startTagAfterBody(this, token);\n                break;\n            case InsertionMode.IN_FRAMESET:\n                startTagInFrameset(this, token);\n                break;\n            case InsertionMode.AFTER_FRAMESET:\n                startTagAfterFrameset(this, token);\n                break;\n            case InsertionMode.AFTER_AFTER_BODY:\n                startTagAfterAfterBody(this, token);\n                break;\n            case InsertionMode.AFTER_AFTER_FRAMESET:\n                startTagAfterAfterFrameset(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n    onEndTag(token) {\n        this.skipNextNewLine = false;\n        this.currentToken = token;\n        if (this.currentNotInHTML) {\n            endTagInForeignContent(this, token);\n        }\n        else {\n            this._endTagOutsideForeignContent(token);\n        }\n    }\n    _endTagOutsideForeignContent(token) {\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n                tokenInInitialMode(this, token);\n                break;\n            case InsertionMode.BEFORE_HTML:\n                endTagBeforeHtml(this, token);\n                break;\n            case InsertionMode.BEFORE_HEAD:\n                endTagBeforeHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD:\n                endTagInHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n                endTagInHeadNoScript(this, token);\n                break;\n            case InsertionMode.AFTER_HEAD:\n                endTagAfterHead(this, token);\n                break;\n            case InsertionMode.IN_BODY:\n                endTagInBody(this, token);\n                break;\n            case InsertionMode.TEXT:\n                endTagInText(this, token);\n                break;\n            case InsertionMode.IN_TABLE:\n                endTagInTable(this, token);\n                break;\n            case InsertionMode.IN_TABLE_TEXT:\n                tokenInTableText(this, token);\n                break;\n            case InsertionMode.IN_CAPTION:\n                endTagInCaption(this, token);\n                break;\n            case InsertionMode.IN_COLUMN_GROUP:\n                endTagInColumnGroup(this, token);\n                break;\n            case InsertionMode.IN_TABLE_BODY:\n                endTagInTableBody(this, token);\n                break;\n            case InsertionMode.IN_ROW:\n                endTagInRow(this, token);\n                break;\n            case InsertionMode.IN_CELL:\n                endTagInCell(this, token);\n                break;\n            case InsertionMode.IN_SELECT:\n                endTagInSelect(this, token);\n                break;\n            case InsertionMode.IN_SELECT_IN_TABLE:\n                endTagInSelectInTable(this, token);\n                break;\n            case InsertionMode.IN_TEMPLATE:\n                endTagInTemplate(this, token);\n                break;\n            case InsertionMode.AFTER_BODY:\n                endTagAfterBody(this, token);\n                break;\n            case InsertionMode.IN_FRAMESET:\n                endTagInFrameset(this, token);\n                break;\n            case InsertionMode.AFTER_FRAMESET:\n                endTagAfterFrameset(this, token);\n                break;\n            case InsertionMode.AFTER_AFTER_BODY:\n                tokenAfterAfterBody(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n    onEof(token) {\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n                tokenInInitialMode(this, token);\n                break;\n            case InsertionMode.BEFORE_HTML:\n                tokenBeforeHtml(this, token);\n                break;\n            case InsertionMode.BEFORE_HEAD:\n                tokenBeforeHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD:\n                tokenInHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n                tokenInHeadNoScript(this, token);\n                break;\n            case InsertionMode.AFTER_HEAD:\n                tokenAfterHead(this, token);\n                break;\n            case InsertionMode.IN_BODY:\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_CAPTION:\n            case InsertionMode.IN_COLUMN_GROUP:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW:\n            case InsertionMode.IN_CELL:\n            case InsertionMode.IN_SELECT:\n            case InsertionMode.IN_SELECT_IN_TABLE:\n                eofInBody(this, token);\n                break;\n            case InsertionMode.TEXT:\n                eofInText(this, token);\n                break;\n            case InsertionMode.IN_TABLE_TEXT:\n                tokenInTableText(this, token);\n                break;\n            case InsertionMode.IN_TEMPLATE:\n                eofInTemplate(this, token);\n                break;\n            case InsertionMode.AFTER_BODY:\n            case InsertionMode.IN_FRAMESET:\n            case InsertionMode.AFTER_FRAMESET:\n            case InsertionMode.AFTER_AFTER_BODY:\n            case InsertionMode.AFTER_AFTER_FRAMESET:\n                stopParsing(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n    onWhitespaceCharacter(token) {\n        if (this.skipNextNewLine) {\n            this.skipNextNewLine = false;\n            if (token.chars.charCodeAt(0) === unicode.CODE_POINTS.LINE_FEED) {\n                if (token.chars.length === 1) {\n                    return;\n                }\n                token.chars = token.chars.substr(1);\n            }\n        }\n        if (this.tokenizer.inForeignNode) {\n            this._insertCharacters(token);\n            return;\n        }\n        switch (this.insertionMode) {\n            case InsertionMode.IN_HEAD:\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n            case InsertionMode.AFTER_HEAD:\n            case InsertionMode.TEXT:\n            case InsertionMode.IN_COLUMN_GROUP:\n            case InsertionMode.IN_SELECT:\n            case InsertionMode.IN_SELECT_IN_TABLE:\n            case InsertionMode.IN_FRAMESET:\n            case InsertionMode.AFTER_FRAMESET:\n                this._insertCharacters(token);\n                break;\n            case InsertionMode.IN_BODY:\n            case InsertionMode.IN_CAPTION:\n            case InsertionMode.IN_CELL:\n            case InsertionMode.IN_TEMPLATE:\n            case InsertionMode.AFTER_BODY:\n            case InsertionMode.AFTER_AFTER_BODY:\n            case InsertionMode.AFTER_AFTER_FRAMESET:\n                whitespaceCharacterInBody(this, token);\n                break;\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW:\n                characterInTable(this, token);\n                break;\n            case InsertionMode.IN_TABLE_TEXT:\n                whitespaceCharacterInTableText(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n}\n//Adoption agency algorithm\n//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html#adoptionAgency)\n//------------------------------------------------------------------\n//Steps 5-8 of the algorithm\nfunction aaObtainFormattingElementEntry(p, token) {\n    let formattingElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(token.tagName);\n    if (formattingElementEntry) {\n        if (!p.openElements.contains(formattingElementEntry.element)) {\n            p.activeFormattingElements.removeEntry(formattingElementEntry);\n            formattingElementEntry = null;\n        }\n        else if (!p.openElements.hasInScope(token.tagID)) {\n            formattingElementEntry = null;\n        }\n    }\n    else {\n        genericEndTagInBody(p, token);\n    }\n    return formattingElementEntry;\n}\n//Steps 9 and 10 of the algorithm\nfunction aaObtainFurthestBlock(p, formattingElementEntry) {\n    let furthestBlock = null;\n    let idx = p.openElements.stackTop;\n    for (; idx >= 0; idx--) {\n        const element = p.openElements.items[idx];\n        if (element === formattingElementEntry.element) {\n            break;\n        }\n        if (p._isSpecialElement(element, p.openElements.tagIDs[idx])) {\n            furthestBlock = element;\n        }\n    }\n    if (!furthestBlock) {\n        p.openElements.shortenToLength(idx < 0 ? 0 : idx);\n        p.activeFormattingElements.removeEntry(formattingElementEntry);\n    }\n    return furthestBlock;\n}\n//Step 13 of the algorithm\nfunction aaInnerLoop(p, furthestBlock, formattingElement) {\n    let lastElement = furthestBlock;\n    let nextElement = p.openElements.getCommonAncestor(furthestBlock);\n    for (let i = 0, element = nextElement; element !== formattingElement; i++, element = nextElement) {\n        //NOTE: store the next element for the next loop iteration (it may be deleted from the stack by step 9.5)\n        nextElement = p.openElements.getCommonAncestor(element);\n        const elementEntry = p.activeFormattingElements.getElementEntry(element);\n        const counterOverflow = elementEntry && i >= AA_INNER_LOOP_ITER;\n        const shouldRemoveFromOpenElements = !elementEntry || counterOverflow;\n        if (shouldRemoveFromOpenElements) {\n            if (counterOverflow) {\n                p.activeFormattingElements.removeEntry(elementEntry);\n            }\n            p.openElements.remove(element);\n        }\n        else {\n            element = aaRecreateElementFromEntry(p, elementEntry);\n            if (lastElement === furthestBlock) {\n                p.activeFormattingElements.bookmark = elementEntry;\n            }\n            p.treeAdapter.detachNode(lastElement);\n            p.treeAdapter.appendChild(element, lastElement);\n            lastElement = element;\n        }\n    }\n    return lastElement;\n}\n//Step 13.7 of the algorithm\nfunction aaRecreateElementFromEntry(p, elementEntry) {\n    const ns = p.treeAdapter.getNamespaceURI(elementEntry.element);\n    const newElement = p.treeAdapter.createElement(elementEntry.token.tagName, ns, elementEntry.token.attrs);\n    p.openElements.replace(elementEntry.element, newElement);\n    elementEntry.element = newElement;\n    return newElement;\n}\n//Step 14 of the algorithm\nfunction aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement) {\n    const tn = p.treeAdapter.getTagName(commonAncestor);\n    const tid = getTagID(tn);\n    if (p._isElementCausesFosterParenting(tid)) {\n        p._fosterParentElement(lastElement);\n    }\n    else {\n        const ns = p.treeAdapter.getNamespaceURI(commonAncestor);\n        if (tid === $.TEMPLATE && ns === NS.HTML) {\n            commonAncestor = p.treeAdapter.getTemplateContent(commonAncestor);\n        }\n        p.treeAdapter.appendChild(commonAncestor, lastElement);\n    }\n}\n//Steps 15-19 of the algorithm\nfunction aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry) {\n    const ns = p.treeAdapter.getNamespaceURI(formattingElementEntry.element);\n    const { token } = formattingElementEntry;\n    const newElement = p.treeAdapter.createElement(token.tagName, ns, token.attrs);\n    p._adoptNodes(furthestBlock, newElement);\n    p.treeAdapter.appendChild(furthestBlock, newElement);\n    p.activeFormattingElements.insertElementAfterBookmark(newElement, token);\n    p.activeFormattingElements.removeEntry(formattingElementEntry);\n    p.openElements.remove(formattingElementEntry.element);\n    p.openElements.insertAfter(furthestBlock, newElement, token.tagID);\n}\n//Algorithm entry point\nfunction callAdoptionAgency(p, token) {\n    for (let i = 0; i < AA_OUTER_LOOP_ITER; i++) {\n        const formattingElementEntry = aaObtainFormattingElementEntry(p, token);\n        if (!formattingElementEntry) {\n            break;\n        }\n        const furthestBlock = aaObtainFurthestBlock(p, formattingElementEntry);\n        if (!furthestBlock) {\n            break;\n        }\n        p.activeFormattingElements.bookmark = formattingElementEntry;\n        const lastElement = aaInnerLoop(p, furthestBlock, formattingElementEntry.element);\n        const commonAncestor = p.openElements.getCommonAncestor(formattingElementEntry.element);\n        p.treeAdapter.detachNode(lastElement);\n        if (commonAncestor)\n            aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement);\n        aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry);\n    }\n}\n//Generic token handlers\n//------------------------------------------------------------------\nfunction appendComment(p, token) {\n    p._appendCommentNode(token, p.openElements.currentTmplContentOrNode);\n}\nfunction appendCommentToRootHtmlElement(p, token) {\n    p._appendCommentNode(token, p.openElements.items[0]);\n}\nfunction appendCommentToDocument(p, token) {\n    p._appendCommentNode(token, p.document);\n}\nfunction stopParsing(p, token) {\n    p.stopped = true;\n    // NOTE: Set end locations for elements that remain on the open element stack.\n    if (token.location) {\n        // NOTE: If we are not in a fragment, `html` and `body` will stay on the stack.\n        // This is a problem, as we might overwrite their end position here.\n        const target = p.fragmentContext ? 0 : 2;\n        for (let i = p.openElements.stackTop; i >= target; i--) {\n            p._setEndLocation(p.openElements.items[i], token);\n        }\n        // Handle `html` and `body`\n        if (!p.fragmentContext && p.openElements.stackTop >= 0) {\n            const htmlElement = p.openElements.items[0];\n            const htmlLocation = p.treeAdapter.getNodeSourceCodeLocation(htmlElement);\n            if (htmlLocation && !htmlLocation.endTag) {\n                p._setEndLocation(htmlElement, token);\n                if (p.openElements.stackTop >= 1) {\n                    const bodyElement = p.openElements.items[1];\n                    const bodyLocation = p.treeAdapter.getNodeSourceCodeLocation(bodyElement);\n                    if (bodyLocation && !bodyLocation.endTag) {\n                        p._setEndLocation(bodyElement, token);\n                    }\n                }\n            }\n        }\n    }\n}\n// The \"initial\" insertion mode\n//------------------------------------------------------------------\nfunction doctypeInInitialMode(p, token) {\n    p._setDocumentType(token);\n    const mode = token.forceQuirks ? DOCUMENT_MODE.QUIRKS : doctype.getDocumentMode(token);\n    if (!doctype.isConforming(token)) {\n        p._err(token, ERR.nonConformingDoctype);\n    }\n    p.treeAdapter.setDocumentMode(p.document, mode);\n    p.insertionMode = InsertionMode.BEFORE_HTML;\n}\nfunction tokenInInitialMode(p, token) {\n    p._err(token, ERR.missingDoctype, true);\n    p.treeAdapter.setDocumentMode(p.document, DOCUMENT_MODE.QUIRKS);\n    p.insertionMode = InsertionMode.BEFORE_HTML;\n    p._processToken(token);\n}\n// The \"before html\" insertion mode\n//------------------------------------------------------------------\nfunction startTagBeforeHtml(p, token) {\n    if (token.tagID === $.HTML) {\n        p._insertElement(token, NS.HTML);\n        p.insertionMode = InsertionMode.BEFORE_HEAD;\n    }\n    else {\n        tokenBeforeHtml(p, token);\n    }\n}\nfunction endTagBeforeHtml(p, token) {\n    const tn = token.tagID;\n    if (tn === $.HTML || tn === $.HEAD || tn === $.BODY || tn === $.BR) {\n        tokenBeforeHtml(p, token);\n    }\n}\nfunction tokenBeforeHtml(p, token) {\n    p._insertFakeRootElement();\n    p.insertionMode = InsertionMode.BEFORE_HEAD;\n    p._processToken(token);\n}\n// The \"before head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagBeforeHead(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.HEAD: {\n            p._insertElement(token, NS.HTML);\n            p.headElement = p.openElements.current;\n            p.insertionMode = InsertionMode.IN_HEAD;\n            break;\n        }\n        default: {\n            tokenBeforeHead(p, token);\n        }\n    }\n}\nfunction endTagBeforeHead(p, token) {\n    const tn = token.tagID;\n    if (tn === $.HEAD || tn === $.BODY || tn === $.HTML || tn === $.BR) {\n        tokenBeforeHead(p, token);\n    }\n    else {\n        p._err(token, ERR.endTagWithoutMatchingOpenElement);\n    }\n}\nfunction tokenBeforeHead(p, token) {\n    p._insertFakeElement(TN.HEAD, $.HEAD);\n    p.headElement = p.openElements.current;\n    p.insertionMode = InsertionMode.IN_HEAD;\n    p._processToken(token);\n}\n// The \"in head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInHead(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.BASE:\n        case $.BASEFONT:\n        case $.BGSOUND:\n        case $.LINK:\n        case $.META: {\n            p._appendElement(token, NS.HTML);\n            token.ackSelfClosing = true;\n            break;\n        }\n        case $.TITLE: {\n            p._switchToTextParsing(token, TokenizerMode.RCDATA);\n            break;\n        }\n        case $.NOSCRIPT: {\n            if (p.options.scriptingEnabled) {\n                p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n            }\n            else {\n                p._insertElement(token, NS.HTML);\n                p.insertionMode = InsertionMode.IN_HEAD_NO_SCRIPT;\n            }\n            break;\n        }\n        case $.NOFRAMES:\n        case $.STYLE: {\n            p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n            break;\n        }\n        case $.SCRIPT: {\n            p._switchToTextParsing(token, TokenizerMode.SCRIPT_DATA);\n            break;\n        }\n        case $.TEMPLATE: {\n            p._insertTemplate(token);\n            p.activeFormattingElements.insertMarker();\n            p.framesetOk = false;\n            p.insertionMode = InsertionMode.IN_TEMPLATE;\n            p.tmplInsertionModeStack.unshift(InsertionMode.IN_TEMPLATE);\n            break;\n        }\n        case $.HEAD: {\n            p._err(token, ERR.misplacedStartTagForHeadElement);\n            break;\n        }\n        default: {\n            tokenInHead(p, token);\n        }\n    }\n}\nfunction endTagInHead(p, token) {\n    switch (token.tagID) {\n        case $.HEAD: {\n            p.openElements.pop();\n            p.insertionMode = InsertionMode.AFTER_HEAD;\n            break;\n        }\n        case $.BODY:\n        case $.BR:\n        case $.HTML: {\n            tokenInHead(p, token);\n            break;\n        }\n        case $.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        default: {\n            p._err(token, ERR.endTagWithoutMatchingOpenElement);\n        }\n    }\n}\nfunction templateEndTagInHead(p, token) {\n    if (p.openElements.tmplCount > 0) {\n        p.openElements.generateImpliedEndTagsThoroughly();\n        if (p.openElements.currentTagId !== $.TEMPLATE) {\n            p._err(token, ERR.closingOfElementWithOpenChildElements);\n        }\n        p.openElements.popUntilTagNamePopped($.TEMPLATE);\n        p.activeFormattingElements.clearToLastMarker();\n        p.tmplInsertionModeStack.shift();\n        p._resetInsertionMode();\n    }\n    else {\n        p._err(token, ERR.endTagWithoutMatchingOpenElement);\n    }\n}\nfunction tokenInHead(p, token) {\n    p.openElements.pop();\n    p.insertionMode = InsertionMode.AFTER_HEAD;\n    p._processToken(token);\n}\n// The \"in head no script\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInHeadNoScript(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.BASEFONT:\n        case $.BGSOUND:\n        case $.HEAD:\n        case $.LINK:\n        case $.META:\n        case $.NOFRAMES:\n        case $.STYLE: {\n            startTagInHead(p, token);\n            break;\n        }\n        case $.NOSCRIPT: {\n            p._err(token, ERR.nestedNoscriptInHead);\n            break;\n        }\n        default: {\n            tokenInHeadNoScript(p, token);\n        }\n    }\n}\nfunction endTagInHeadNoScript(p, token) {\n    switch (token.tagID) {\n        case $.NOSCRIPT: {\n            p.openElements.pop();\n            p.insertionMode = InsertionMode.IN_HEAD;\n            break;\n        }\n        case $.BR: {\n            tokenInHeadNoScript(p, token);\n            break;\n        }\n        default: {\n            p._err(token, ERR.endTagWithoutMatchingOpenElement);\n        }\n    }\n}\nfunction tokenInHeadNoScript(p, token) {\n    const errCode = token.type === TokenType.EOF ? ERR.openElementsLeftAfterEof : ERR.disallowedContentInNoscriptInHead;\n    p._err(token, errCode);\n    p.openElements.pop();\n    p.insertionMode = InsertionMode.IN_HEAD;\n    p._processToken(token);\n}\n// The \"after head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterHead(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.BODY: {\n            p._insertElement(token, NS.HTML);\n            p.framesetOk = false;\n            p.insertionMode = InsertionMode.IN_BODY;\n            break;\n        }\n        case $.FRAMESET: {\n            p._insertElement(token, NS.HTML);\n            p.insertionMode = InsertionMode.IN_FRAMESET;\n            break;\n        }\n        case $.BASE:\n        case $.BASEFONT:\n        case $.BGSOUND:\n        case $.LINK:\n        case $.META:\n        case $.NOFRAMES:\n        case $.SCRIPT:\n        case $.STYLE:\n        case $.TEMPLATE:\n        case $.TITLE: {\n            p._err(token, ERR.abandonedHeadElementChild);\n            p.openElements.push(p.headElement, $.HEAD);\n            startTagInHead(p, token);\n            p.openElements.remove(p.headElement);\n            break;\n        }\n        case $.HEAD: {\n            p._err(token, ERR.misplacedStartTagForHeadElement);\n            break;\n        }\n        default: {\n            tokenAfterHead(p, token);\n        }\n    }\n}\nfunction endTagAfterHead(p, token) {\n    switch (token.tagID) {\n        case $.BODY:\n        case $.HTML:\n        case $.BR: {\n            tokenAfterHead(p, token);\n            break;\n        }\n        case $.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        default: {\n            p._err(token, ERR.endTagWithoutMatchingOpenElement);\n        }\n    }\n}\nfunction tokenAfterHead(p, token) {\n    p._insertFakeElement(TN.BODY, $.BODY);\n    p.insertionMode = InsertionMode.IN_BODY;\n    modeInBody(p, token);\n}\n// The \"in body\" insertion mode\n//------------------------------------------------------------------\nfunction modeInBody(p, token) {\n    switch (token.type) {\n        case TokenType.CHARACTER: {\n            characterInBody(p, token);\n            break;\n        }\n        case TokenType.WHITESPACE_CHARACTER: {\n            whitespaceCharacterInBody(p, token);\n            break;\n        }\n        case TokenType.COMMENT: {\n            appendComment(p, token);\n            break;\n        }\n        case TokenType.START_TAG: {\n            startTagInBody(p, token);\n            break;\n        }\n        case TokenType.END_TAG: {\n            endTagInBody(p, token);\n            break;\n        }\n        case TokenType.EOF: {\n            eofInBody(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\nfunction whitespaceCharacterInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertCharacters(token);\n}\nfunction characterInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertCharacters(token);\n    p.framesetOk = false;\n}\nfunction htmlStartTagInBody(p, token) {\n    if (p.openElements.tmplCount === 0) {\n        p.treeAdapter.adoptAttributes(p.openElements.items[0], token.attrs);\n    }\n}\nfunction bodyStartTagInBody(p, token) {\n    const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n    if (bodyElement && p.openElements.tmplCount === 0) {\n        p.framesetOk = false;\n        p.treeAdapter.adoptAttributes(bodyElement, token.attrs);\n    }\n}\nfunction framesetStartTagInBody(p, token) {\n    const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n    if (p.framesetOk && bodyElement) {\n        p.treeAdapter.detachNode(bodyElement);\n        p.openElements.popAllUpToHtmlElement();\n        p._insertElement(token, NS.HTML);\n        p.insertionMode = InsertionMode.IN_FRAMESET;\n    }\n}\nfunction addressStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, NS.HTML);\n}\nfunction numberedHeaderStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    if (isNumberedHeader(p.openElements.currentTagId)) {\n        p.openElements.pop();\n    }\n    p._insertElement(token, NS.HTML);\n}\nfunction preStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, NS.HTML);\n    //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n    //on to the next one. (Newlines at the start of pre blocks are ignored as an authoring convenience.)\n    p.skipNextNewLine = true;\n    p.framesetOk = false;\n}\nfunction formStartTagInBody(p, token) {\n    const inTemplate = p.openElements.tmplCount > 0;\n    if (!p.formElement || inTemplate) {\n        if (p.openElements.hasInButtonScope($.P)) {\n            p._closePElement();\n        }\n        p._insertElement(token, NS.HTML);\n        if (!inTemplate) {\n            p.formElement = p.openElements.current;\n        }\n    }\n}\nfunction listItemStartTagInBody(p, token) {\n    p.framesetOk = false;\n    const tn = token.tagID;\n    for (let i = p.openElements.stackTop; i >= 0; i--) {\n        const elementId = p.openElements.tagIDs[i];\n        if ((tn === $.LI && elementId === $.LI) ||\n            ((tn === $.DD || tn === $.DT) && (elementId === $.DD || elementId === $.DT))) {\n            p.openElements.generateImpliedEndTagsWithExclusion(elementId);\n            p.openElements.popUntilTagNamePopped(elementId);\n            break;\n        }\n        if (elementId !== $.ADDRESS &&\n            elementId !== $.DIV &&\n            elementId !== $.P &&\n            p._isSpecialElement(p.openElements.items[i], elementId)) {\n            break;\n        }\n    }\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, NS.HTML);\n}\nfunction plaintextStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, NS.HTML);\n    p.tokenizer.state = TokenizerMode.PLAINTEXT;\n}\nfunction buttonStartTagInBody(p, token) {\n    if (p.openElements.hasInScope($.BUTTON)) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilTagNamePopped($.BUTTON);\n    }\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.framesetOk = false;\n}\nfunction aStartTagInBody(p, token) {\n    const activeElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(TN.A);\n    if (activeElementEntry) {\n        callAdoptionAgency(p, token);\n        p.openElements.remove(activeElementEntry.element);\n        p.activeFormattingElements.removeEntry(activeElementEntry);\n    }\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\nfunction bStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\nfunction nobrStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    if (p.openElements.hasInScope($.NOBR)) {\n        callAdoptionAgency(p, token);\n        p._reconstructActiveFormattingElements();\n    }\n    p._insertElement(token, NS.HTML);\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\nfunction appletStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.activeFormattingElements.insertMarker();\n    p.framesetOk = false;\n}\nfunction tableStartTagInBody(p, token) {\n    if (p.treeAdapter.getDocumentMode(p.document) !== DOCUMENT_MODE.QUIRKS && p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, NS.HTML);\n    p.framesetOk = false;\n    p.insertionMode = InsertionMode.IN_TABLE;\n}\nfunction areaStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._appendElement(token, NS.HTML);\n    p.framesetOk = false;\n    token.ackSelfClosing = true;\n}\nfunction isHiddenInput(token) {\n    const inputType = getTokenAttr(token, ATTRS.TYPE);\n    return inputType != null && inputType.toLowerCase() === HIDDEN_INPUT_TYPE;\n}\nfunction inputStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._appendElement(token, NS.HTML);\n    if (!isHiddenInput(token)) {\n        p.framesetOk = false;\n    }\n    token.ackSelfClosing = true;\n}\nfunction paramStartTagInBody(p, token) {\n    p._appendElement(token, NS.HTML);\n    token.ackSelfClosing = true;\n}\nfunction hrStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    p._appendElement(token, NS.HTML);\n    p.framesetOk = false;\n    token.ackSelfClosing = true;\n}\nfunction imageStartTagInBody(p, token) {\n    token.tagName = TN.IMG;\n    token.tagID = $.IMG;\n    areaStartTagInBody(p, token);\n}\nfunction textareaStartTagInBody(p, token) {\n    p._insertElement(token, NS.HTML);\n    //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n    //on to the next one. (Newlines at the start of textarea elements are ignored as an authoring convenience.)\n    p.skipNextNewLine = true;\n    p.tokenizer.state = TokenizerMode.RCDATA;\n    p.originalInsertionMode = p.insertionMode;\n    p.framesetOk = false;\n    p.insertionMode = InsertionMode.TEXT;\n}\nfunction xmpStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    p._reconstructActiveFormattingElements();\n    p.framesetOk = false;\n    p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n}\nfunction iframeStartTagInBody(p, token) {\n    p.framesetOk = false;\n    p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n}\n//NOTE: here we assume that we always act as an user agent with enabled plugins, so we parse\n//<noembed> as rawtext.\nfunction noembedStartTagInBody(p, token) {\n    p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n}\nfunction selectStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.framesetOk = false;\n    p.insertionMode =\n        p.insertionMode === InsertionMode.IN_TABLE ||\n            p.insertionMode === InsertionMode.IN_CAPTION ||\n            p.insertionMode === InsertionMode.IN_TABLE_BODY ||\n            p.insertionMode === InsertionMode.IN_ROW ||\n            p.insertionMode === InsertionMode.IN_CELL\n            ? InsertionMode.IN_SELECT_IN_TABLE\n            : InsertionMode.IN_SELECT;\n}\nfunction optgroupStartTagInBody(p, token) {\n    if (p.openElements.currentTagId === $.OPTION) {\n        p.openElements.pop();\n    }\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n}\nfunction rbStartTagInBody(p, token) {\n    if (p.openElements.hasInScope($.RUBY)) {\n        p.openElements.generateImpliedEndTags();\n    }\n    p._insertElement(token, NS.HTML);\n}\nfunction rtStartTagInBody(p, token) {\n    if (p.openElements.hasInScope($.RUBY)) {\n        p.openElements.generateImpliedEndTagsWithExclusion($.RTC);\n    }\n    p._insertElement(token, NS.HTML);\n}\nfunction mathStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    foreignContent.adjustTokenMathMLAttrs(token);\n    foreignContent.adjustTokenXMLAttrs(token);\n    if (token.selfClosing) {\n        p._appendElement(token, NS.MATHML);\n    }\n    else {\n        p._insertElement(token, NS.MATHML);\n    }\n    token.ackSelfClosing = true;\n}\nfunction svgStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    foreignContent.adjustTokenSVGAttrs(token);\n    foreignContent.adjustTokenXMLAttrs(token);\n    if (token.selfClosing) {\n        p._appendElement(token, NS.SVG);\n    }\n    else {\n        p._insertElement(token, NS.SVG);\n    }\n    token.ackSelfClosing = true;\n}\nfunction genericStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n}\nfunction startTagInBody(p, token) {\n    switch (token.tagID) {\n        case $.I:\n        case $.S:\n        case $.B:\n        case $.U:\n        case $.EM:\n        case $.TT:\n        case $.BIG:\n        case $.CODE:\n        case $.FONT:\n        case $.SMALL:\n        case $.STRIKE:\n        case $.STRONG: {\n            bStartTagInBody(p, token);\n            break;\n        }\n        case $.A: {\n            aStartTagInBody(p, token);\n            break;\n        }\n        case $.H1:\n        case $.H2:\n        case $.H3:\n        case $.H4:\n        case $.H5:\n        case $.H6: {\n            numberedHeaderStartTagInBody(p, token);\n            break;\n        }\n        case $.P:\n        case $.DL:\n        case $.OL:\n        case $.UL:\n        case $.DIV:\n        case $.DIR:\n        case $.NAV:\n        case $.MAIN:\n        case $.MENU:\n        case $.ASIDE:\n        case $.CENTER:\n        case $.FIGURE:\n        case $.FOOTER:\n        case $.HEADER:\n        case $.HGROUP:\n        case $.DIALOG:\n        case $.DETAILS:\n        case $.ADDRESS:\n        case $.ARTICLE:\n        case $.SECTION:\n        case $.SUMMARY:\n        case $.FIELDSET:\n        case $.BLOCKQUOTE:\n        case $.FIGCAPTION: {\n            addressStartTagInBody(p, token);\n            break;\n        }\n        case $.LI:\n        case $.DD:\n        case $.DT: {\n            listItemStartTagInBody(p, token);\n            break;\n        }\n        case $.BR:\n        case $.IMG:\n        case $.WBR:\n        case $.AREA:\n        case $.EMBED:\n        case $.KEYGEN: {\n            areaStartTagInBody(p, token);\n            break;\n        }\n        case $.HR: {\n            hrStartTagInBody(p, token);\n            break;\n        }\n        case $.RB:\n        case $.RTC: {\n            rbStartTagInBody(p, token);\n            break;\n        }\n        case $.RT:\n        case $.RP: {\n            rtStartTagInBody(p, token);\n            break;\n        }\n        case $.PRE:\n        case $.LISTING: {\n            preStartTagInBody(p, token);\n            break;\n        }\n        case $.XMP: {\n            xmpStartTagInBody(p, token);\n            break;\n        }\n        case $.SVG: {\n            svgStartTagInBody(p, token);\n            break;\n        }\n        case $.HTML: {\n            htmlStartTagInBody(p, token);\n            break;\n        }\n        case $.BASE:\n        case $.LINK:\n        case $.META:\n        case $.STYLE:\n        case $.TITLE:\n        case $.SCRIPT:\n        case $.BGSOUND:\n        case $.BASEFONT:\n        case $.TEMPLATE: {\n            startTagInHead(p, token);\n            break;\n        }\n        case $.BODY: {\n            bodyStartTagInBody(p, token);\n            break;\n        }\n        case $.FORM: {\n            formStartTagInBody(p, token);\n            break;\n        }\n        case $.NOBR: {\n            nobrStartTagInBody(p, token);\n            break;\n        }\n        case $.MATH: {\n            mathStartTagInBody(p, token);\n            break;\n        }\n        case $.TABLE: {\n            tableStartTagInBody(p, token);\n            break;\n        }\n        case $.INPUT: {\n            inputStartTagInBody(p, token);\n            break;\n        }\n        case $.PARAM:\n        case $.TRACK:\n        case $.SOURCE: {\n            paramStartTagInBody(p, token);\n            break;\n        }\n        case $.IMAGE: {\n            imageStartTagInBody(p, token);\n            break;\n        }\n        case $.BUTTON: {\n            buttonStartTagInBody(p, token);\n            break;\n        }\n        case $.APPLET:\n        case $.OBJECT:\n        case $.MARQUEE: {\n            appletStartTagInBody(p, token);\n            break;\n        }\n        case $.IFRAME: {\n            iframeStartTagInBody(p, token);\n            break;\n        }\n        case $.SELECT: {\n            selectStartTagInBody(p, token);\n            break;\n        }\n        case $.OPTION:\n        case $.OPTGROUP: {\n            optgroupStartTagInBody(p, token);\n            break;\n        }\n        case $.NOEMBED: {\n            noembedStartTagInBody(p, token);\n            break;\n        }\n        case $.FRAMESET: {\n            framesetStartTagInBody(p, token);\n            break;\n        }\n        case $.TEXTAREA: {\n            textareaStartTagInBody(p, token);\n            break;\n        }\n        case $.NOSCRIPT: {\n            if (p.options.scriptingEnabled) {\n                noembedStartTagInBody(p, token);\n            }\n            else {\n                genericStartTagInBody(p, token);\n            }\n            break;\n        }\n        case $.PLAINTEXT: {\n            plaintextStartTagInBody(p, token);\n            break;\n        }\n        case $.COL:\n        case $.TH:\n        case $.TD:\n        case $.TR:\n        case $.HEAD:\n        case $.FRAME:\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD:\n        case $.CAPTION:\n        case $.COLGROUP: {\n            // Ignore token\n            break;\n        }\n        default: {\n            genericStartTagInBody(p, token);\n        }\n    }\n}\nfunction bodyEndTagInBody(p, token) {\n    if (p.openElements.hasInScope($.BODY)) {\n        p.insertionMode = InsertionMode.AFTER_BODY;\n        //NOTE: <body> is never popped from the stack, so we need to updated\n        //the end location explicitly.\n        if (p.options.sourceCodeLocationInfo) {\n            const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n            if (bodyElement) {\n                p._setEndLocation(bodyElement, token);\n            }\n        }\n    }\n}\nfunction htmlEndTagInBody(p, token) {\n    if (p.openElements.hasInScope($.BODY)) {\n        p.insertionMode = InsertionMode.AFTER_BODY;\n        endTagAfterBody(p, token);\n    }\n}\nfunction addressEndTagInBody(p, token) {\n    const tn = token.tagID;\n    if (p.openElements.hasInScope(tn)) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilTagNamePopped(tn);\n    }\n}\nfunction formEndTagInBody(p) {\n    const inTemplate = p.openElements.tmplCount > 0;\n    const { formElement } = p;\n    if (!inTemplate) {\n        p.formElement = null;\n    }\n    if ((formElement || inTemplate) && p.openElements.hasInScope($.FORM)) {\n        p.openElements.generateImpliedEndTags();\n        if (inTemplate) {\n            p.openElements.popUntilTagNamePopped($.FORM);\n        }\n        else if (formElement) {\n            p.openElements.remove(formElement);\n        }\n    }\n}\nfunction pEndTagInBody(p) {\n    if (!p.openElements.hasInButtonScope($.P)) {\n        p._insertFakeElement(TN.P, $.P);\n    }\n    p._closePElement();\n}\nfunction liEndTagInBody(p) {\n    if (p.openElements.hasInListItemScope($.LI)) {\n        p.openElements.generateImpliedEndTagsWithExclusion($.LI);\n        p.openElements.popUntilTagNamePopped($.LI);\n    }\n}\nfunction ddEndTagInBody(p, token) {\n    const tn = token.tagID;\n    if (p.openElements.hasInScope(tn)) {\n        p.openElements.generateImpliedEndTagsWithExclusion(tn);\n        p.openElements.popUntilTagNamePopped(tn);\n    }\n}\nfunction numberedHeaderEndTagInBody(p) {\n    if (p.openElements.hasNumberedHeaderInScope()) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilNumberedHeaderPopped();\n    }\n}\nfunction appletEndTagInBody(p, token) {\n    const tn = token.tagID;\n    if (p.openElements.hasInScope(tn)) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilTagNamePopped(tn);\n        p.activeFormattingElements.clearToLastMarker();\n    }\n}\nfunction brEndTagInBody(p) {\n    p._reconstructActiveFormattingElements();\n    p._insertFakeElement(TN.BR, $.BR);\n    p.openElements.pop();\n    p.framesetOk = false;\n}\nfunction genericEndTagInBody(p, token) {\n    const tn = token.tagName;\n    const tid = token.tagID;\n    for (let i = p.openElements.stackTop; i > 0; i--) {\n        const element = p.openElements.items[i];\n        const elementId = p.openElements.tagIDs[i];\n        // Compare the tag name here, as the tag might not be a known tag with an ID.\n        if (tid === elementId && (tid !== $.UNKNOWN || p.treeAdapter.getTagName(element) === tn)) {\n            p.openElements.generateImpliedEndTagsWithExclusion(tid);\n            if (p.openElements.stackTop >= i)\n                p.openElements.shortenToLength(i);\n            break;\n        }\n        if (p._isSpecialElement(element, elementId)) {\n            break;\n        }\n    }\n}\nfunction endTagInBody(p, token) {\n    switch (token.tagID) {\n        case $.A:\n        case $.B:\n        case $.I:\n        case $.S:\n        case $.U:\n        case $.EM:\n        case $.TT:\n        case $.BIG:\n        case $.CODE:\n        case $.FONT:\n        case $.NOBR:\n        case $.SMALL:\n        case $.STRIKE:\n        case $.STRONG: {\n            callAdoptionAgency(p, token);\n            break;\n        }\n        case $.P: {\n            pEndTagInBody(p);\n            break;\n        }\n        case $.DL:\n        case $.UL:\n        case $.OL:\n        case $.DIR:\n        case $.DIV:\n        case $.NAV:\n        case $.PRE:\n        case $.MAIN:\n        case $.MENU:\n        case $.ASIDE:\n        case $.BUTTON:\n        case $.CENTER:\n        case $.FIGURE:\n        case $.FOOTER:\n        case $.HEADER:\n        case $.HGROUP:\n        case $.DIALOG:\n        case $.ADDRESS:\n        case $.ARTICLE:\n        case $.DETAILS:\n        case $.SECTION:\n        case $.SUMMARY:\n        case $.LISTING:\n        case $.FIELDSET:\n        case $.BLOCKQUOTE:\n        case $.FIGCAPTION: {\n            addressEndTagInBody(p, token);\n            break;\n        }\n        case $.LI: {\n            liEndTagInBody(p);\n            break;\n        }\n        case $.DD:\n        case $.DT: {\n            ddEndTagInBody(p, token);\n            break;\n        }\n        case $.H1:\n        case $.H2:\n        case $.H3:\n        case $.H4:\n        case $.H5:\n        case $.H6: {\n            numberedHeaderEndTagInBody(p);\n            break;\n        }\n        case $.BR: {\n            brEndTagInBody(p);\n            break;\n        }\n        case $.BODY: {\n            bodyEndTagInBody(p, token);\n            break;\n        }\n        case $.HTML: {\n            htmlEndTagInBody(p, token);\n            break;\n        }\n        case $.FORM: {\n            formEndTagInBody(p);\n            break;\n        }\n        case $.APPLET:\n        case $.OBJECT:\n        case $.MARQUEE: {\n            appletEndTagInBody(p, token);\n            break;\n        }\n        case $.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        default: {\n            genericEndTagInBody(p, token);\n        }\n    }\n}\nfunction eofInBody(p, token) {\n    if (p.tmplInsertionModeStack.length > 0) {\n        eofInTemplate(p, token);\n    }\n    else {\n        stopParsing(p, token);\n    }\n}\n// The \"text\" insertion mode\n//------------------------------------------------------------------\nfunction endTagInText(p, token) {\n    var _a;\n    if (token.tagID === $.SCRIPT) {\n        (_a = p.scriptHandler) === null || _a === void 0 ? void 0 : _a.call(p, p.openElements.current);\n    }\n    p.openElements.pop();\n    p.insertionMode = p.originalInsertionMode;\n}\nfunction eofInText(p, token) {\n    p._err(token, ERR.eofInElementThatCanContainOnlyText);\n    p.openElements.pop();\n    p.insertionMode = p.originalInsertionMode;\n    p.onEof(token);\n}\n// The \"in table\" insertion mode\n//------------------------------------------------------------------\nfunction characterInTable(p, token) {\n    if (TABLE_STRUCTURE_TAGS.has(p.openElements.currentTagId)) {\n        p.pendingCharacterTokens.length = 0;\n        p.hasNonWhitespacePendingCharacterToken = false;\n        p.originalInsertionMode = p.insertionMode;\n        p.insertionMode = InsertionMode.IN_TABLE_TEXT;\n        switch (token.type) {\n            case TokenType.CHARACTER: {\n                characterInTableText(p, token);\n                break;\n            }\n            case TokenType.WHITESPACE_CHARACTER: {\n                whitespaceCharacterInTableText(p, token);\n                break;\n            }\n            // Ignore null\n        }\n    }\n    else {\n        tokenInTable(p, token);\n    }\n}\nfunction captionStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p.activeFormattingElements.insertMarker();\n    p._insertElement(token, NS.HTML);\n    p.insertionMode = InsertionMode.IN_CAPTION;\n}\nfunction colgroupStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertElement(token, NS.HTML);\n    p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n}\nfunction colStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertFakeElement(TN.COLGROUP, $.COLGROUP);\n    p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n    startTagInColumnGroup(p, token);\n}\nfunction tbodyStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertElement(token, NS.HTML);\n    p.insertionMode = InsertionMode.IN_TABLE_BODY;\n}\nfunction tdStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertFakeElement(TN.TBODY, $.TBODY);\n    p.insertionMode = InsertionMode.IN_TABLE_BODY;\n    startTagInTableBody(p, token);\n}\nfunction tableStartTagInTable(p, token) {\n    if (p.openElements.hasInTableScope($.TABLE)) {\n        p.openElements.popUntilTagNamePopped($.TABLE);\n        p._resetInsertionMode();\n        p._processStartTag(token);\n    }\n}\nfunction inputStartTagInTable(p, token) {\n    if (isHiddenInput(token)) {\n        p._appendElement(token, NS.HTML);\n    }\n    else {\n        tokenInTable(p, token);\n    }\n    token.ackSelfClosing = true;\n}\nfunction formStartTagInTable(p, token) {\n    if (!p.formElement && p.openElements.tmplCount === 0) {\n        p._insertElement(token, NS.HTML);\n        p.formElement = p.openElements.current;\n        p.openElements.pop();\n    }\n}\nfunction startTagInTable(p, token) {\n    switch (token.tagID) {\n        case $.TD:\n        case $.TH:\n        case $.TR: {\n            tdStartTagInTable(p, token);\n            break;\n        }\n        case $.STYLE:\n        case $.SCRIPT:\n        case $.TEMPLATE: {\n            startTagInHead(p, token);\n            break;\n        }\n        case $.COL: {\n            colStartTagInTable(p, token);\n            break;\n        }\n        case $.FORM: {\n            formStartTagInTable(p, token);\n            break;\n        }\n        case $.TABLE: {\n            tableStartTagInTable(p, token);\n            break;\n        }\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD: {\n            tbodyStartTagInTable(p, token);\n            break;\n        }\n        case $.INPUT: {\n            inputStartTagInTable(p, token);\n            break;\n        }\n        case $.CAPTION: {\n            captionStartTagInTable(p, token);\n            break;\n        }\n        case $.COLGROUP: {\n            colgroupStartTagInTable(p, token);\n            break;\n        }\n        default: {\n            tokenInTable(p, token);\n        }\n    }\n}\nfunction endTagInTable(p, token) {\n    switch (token.tagID) {\n        case $.TABLE: {\n            if (p.openElements.hasInTableScope($.TABLE)) {\n                p.openElements.popUntilTagNamePopped($.TABLE);\n                p._resetInsertionMode();\n            }\n            break;\n        }\n        case $.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        case $.BODY:\n        case $.CAPTION:\n        case $.COL:\n        case $.COLGROUP:\n        case $.HTML:\n        case $.TBODY:\n        case $.TD:\n        case $.TFOOT:\n        case $.TH:\n        case $.THEAD:\n        case $.TR: {\n            // Ignore token\n            break;\n        }\n        default: {\n            tokenInTable(p, token);\n        }\n    }\n}\nfunction tokenInTable(p, token) {\n    const savedFosterParentingState = p.fosterParentingEnabled;\n    p.fosterParentingEnabled = true;\n    // Process token in `In Body` mode\n    modeInBody(p, token);\n    p.fosterParentingEnabled = savedFosterParentingState;\n}\n// The \"in table text\" insertion mode\n//------------------------------------------------------------------\nfunction whitespaceCharacterInTableText(p, token) {\n    p.pendingCharacterTokens.push(token);\n}\nfunction characterInTableText(p, token) {\n    p.pendingCharacterTokens.push(token);\n    p.hasNonWhitespacePendingCharacterToken = true;\n}\nfunction tokenInTableText(p, token) {\n    let i = 0;\n    if (p.hasNonWhitespacePendingCharacterToken) {\n        for (; i < p.pendingCharacterTokens.length; i++) {\n            tokenInTable(p, p.pendingCharacterTokens[i]);\n        }\n    }\n    else {\n        for (; i < p.pendingCharacterTokens.length; i++) {\n            p._insertCharacters(p.pendingCharacterTokens[i]);\n        }\n    }\n    p.insertionMode = p.originalInsertionMode;\n    p._processToken(token);\n}\n// The \"in caption\" insertion mode\n//------------------------------------------------------------------\nconst TABLE_VOID_ELEMENTS = new Set([$.CAPTION, $.COL, $.COLGROUP, $.TBODY, $.TD, $.TFOOT, $.TH, $.THEAD, $.TR]);\nfunction startTagInCaption(p, token) {\n    const tn = token.tagID;\n    if (TABLE_VOID_ELEMENTS.has(tn)) {\n        if (p.openElements.hasInTableScope($.CAPTION)) {\n            p.openElements.generateImpliedEndTags();\n            p.openElements.popUntilTagNamePopped($.CAPTION);\n            p.activeFormattingElements.clearToLastMarker();\n            p.insertionMode = InsertionMode.IN_TABLE;\n            startTagInTable(p, token);\n        }\n    }\n    else {\n        startTagInBody(p, token);\n    }\n}\nfunction endTagInCaption(p, token) {\n    const tn = token.tagID;\n    switch (tn) {\n        case $.CAPTION:\n        case $.TABLE: {\n            if (p.openElements.hasInTableScope($.CAPTION)) {\n                p.openElements.generateImpliedEndTags();\n                p.openElements.popUntilTagNamePopped($.CAPTION);\n                p.activeFormattingElements.clearToLastMarker();\n                p.insertionMode = InsertionMode.IN_TABLE;\n                if (tn === $.TABLE) {\n                    endTagInTable(p, token);\n                }\n            }\n            break;\n        }\n        case $.BODY:\n        case $.COL:\n        case $.COLGROUP:\n        case $.HTML:\n        case $.TBODY:\n        case $.TD:\n        case $.TFOOT:\n        case $.TH:\n        case $.THEAD:\n        case $.TR: {\n            // Ignore token\n            break;\n        }\n        default: {\n            endTagInBody(p, token);\n        }\n    }\n}\n// The \"in column group\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInColumnGroup(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.COL: {\n            p._appendElement(token, NS.HTML);\n            token.ackSelfClosing = true;\n            break;\n        }\n        case $.TEMPLATE: {\n            startTagInHead(p, token);\n            break;\n        }\n        default: {\n            tokenInColumnGroup(p, token);\n        }\n    }\n}\nfunction endTagInColumnGroup(p, token) {\n    switch (token.tagID) {\n        case $.COLGROUP: {\n            if (p.openElements.currentTagId === $.COLGROUP) {\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE;\n            }\n            break;\n        }\n        case $.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        case $.COL: {\n            // Ignore token\n            break;\n        }\n        default: {\n            tokenInColumnGroup(p, token);\n        }\n    }\n}\nfunction tokenInColumnGroup(p, token) {\n    if (p.openElements.currentTagId === $.COLGROUP) {\n        p.openElements.pop();\n        p.insertionMode = InsertionMode.IN_TABLE;\n        p._processToken(token);\n    }\n}\n// The \"in table body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInTableBody(p, token) {\n    switch (token.tagID) {\n        case $.TR: {\n            p.openElements.clearBackToTableBodyContext();\n            p._insertElement(token, NS.HTML);\n            p.insertionMode = InsertionMode.IN_ROW;\n            break;\n        }\n        case $.TH:\n        case $.TD: {\n            p.openElements.clearBackToTableBodyContext();\n            p._insertFakeElement(TN.TR, $.TR);\n            p.insertionMode = InsertionMode.IN_ROW;\n            startTagInRow(p, token);\n            break;\n        }\n        case $.CAPTION:\n        case $.COL:\n        case $.COLGROUP:\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD: {\n            if (p.openElements.hasTableBodyContextInTableScope()) {\n                p.openElements.clearBackToTableBodyContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE;\n                startTagInTable(p, token);\n            }\n            break;\n        }\n        default: {\n            startTagInTable(p, token);\n        }\n    }\n}\nfunction endTagInTableBody(p, token) {\n    const tn = token.tagID;\n    switch (token.tagID) {\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD: {\n            if (p.openElements.hasInTableScope(tn)) {\n                p.openElements.clearBackToTableBodyContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE;\n            }\n            break;\n        }\n        case $.TABLE: {\n            if (p.openElements.hasTableBodyContextInTableScope()) {\n                p.openElements.clearBackToTableBodyContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE;\n                endTagInTable(p, token);\n            }\n            break;\n        }\n        case $.BODY:\n        case $.CAPTION:\n        case $.COL:\n        case $.COLGROUP:\n        case $.HTML:\n        case $.TD:\n        case $.TH:\n        case $.TR: {\n            // Ignore token\n            break;\n        }\n        default: {\n            endTagInTable(p, token);\n        }\n    }\n}\n// The \"in row\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInRow(p, token) {\n    switch (token.tagID) {\n        case $.TH:\n        case $.TD: {\n            p.openElements.clearBackToTableRowContext();\n            p._insertElement(token, NS.HTML);\n            p.insertionMode = InsertionMode.IN_CELL;\n            p.activeFormattingElements.insertMarker();\n            break;\n        }\n        case $.CAPTION:\n        case $.COL:\n        case $.COLGROUP:\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD:\n        case $.TR: {\n            if (p.openElements.hasInTableScope($.TR)) {\n                p.openElements.clearBackToTableRowContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE_BODY;\n                startTagInTableBody(p, token);\n            }\n            break;\n        }\n        default: {\n            startTagInTable(p, token);\n        }\n    }\n}\nfunction endTagInRow(p, token) {\n    switch (token.tagID) {\n        case $.TR: {\n            if (p.openElements.hasInTableScope($.TR)) {\n                p.openElements.clearBackToTableRowContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE_BODY;\n            }\n            break;\n        }\n        case $.TABLE: {\n            if (p.openElements.hasInTableScope($.TR)) {\n                p.openElements.clearBackToTableRowContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE_BODY;\n                endTagInTableBody(p, token);\n            }\n            break;\n        }\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD: {\n            if (p.openElements.hasInTableScope(token.tagID) || p.openElements.hasInTableScope($.TR)) {\n                p.openElements.clearBackToTableRowContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE_BODY;\n                endTagInTableBody(p, token);\n            }\n            break;\n        }\n        case $.BODY:\n        case $.CAPTION:\n        case $.COL:\n        case $.COLGROUP:\n        case $.HTML:\n        case $.TD:\n        case $.TH: {\n            // Ignore end tag\n            break;\n        }\n        default:\n            endTagInTable(p, token);\n    }\n}\n// The \"in cell\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInCell(p, token) {\n    const tn = token.tagID;\n    if (TABLE_VOID_ELEMENTS.has(tn)) {\n        if (p.openElements.hasInTableScope($.TD) || p.openElements.hasInTableScope($.TH)) {\n            p._closeTableCell();\n            startTagInRow(p, token);\n        }\n    }\n    else {\n        startTagInBody(p, token);\n    }\n}\nfunction endTagInCell(p, token) {\n    const tn = token.tagID;\n    switch (tn) {\n        case $.TD:\n        case $.TH: {\n            if (p.openElements.hasInTableScope(tn)) {\n                p.openElements.generateImpliedEndTags();\n                p.openElements.popUntilTagNamePopped(tn);\n                p.activeFormattingElements.clearToLastMarker();\n                p.insertionMode = InsertionMode.IN_ROW;\n            }\n            break;\n        }\n        case $.TABLE:\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD:\n        case $.TR: {\n            if (p.openElements.hasInTableScope(tn)) {\n                p._closeTableCell();\n                endTagInRow(p, token);\n            }\n            break;\n        }\n        case $.BODY:\n        case $.CAPTION:\n        case $.COL:\n        case $.COLGROUP:\n        case $.HTML: {\n            // Ignore token\n            break;\n        }\n        default: {\n            endTagInBody(p, token);\n        }\n    }\n}\n// The \"in select\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInSelect(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.OPTION: {\n            if (p.openElements.currentTagId === $.OPTION) {\n                p.openElements.pop();\n            }\n            p._insertElement(token, NS.HTML);\n            break;\n        }\n        case $.OPTGROUP: {\n            if (p.openElements.currentTagId === $.OPTION) {\n                p.openElements.pop();\n            }\n            if (p.openElements.currentTagId === $.OPTGROUP) {\n                p.openElements.pop();\n            }\n            p._insertElement(token, NS.HTML);\n            break;\n        }\n        case $.INPUT:\n        case $.KEYGEN:\n        case $.TEXTAREA:\n        case $.SELECT: {\n            if (p.openElements.hasInSelectScope($.SELECT)) {\n                p.openElements.popUntilTagNamePopped($.SELECT);\n                p._resetInsertionMode();\n                if (token.tagID !== $.SELECT) {\n                    p._processStartTag(token);\n                }\n            }\n            break;\n        }\n        case $.SCRIPT:\n        case $.TEMPLATE: {\n            startTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\nfunction endTagInSelect(p, token) {\n    switch (token.tagID) {\n        case $.OPTGROUP: {\n            if (p.openElements.stackTop > 0 &&\n                p.openElements.currentTagId === $.OPTION &&\n                p.openElements.tagIDs[p.openElements.stackTop - 1] === $.OPTGROUP) {\n                p.openElements.pop();\n            }\n            if (p.openElements.currentTagId === $.OPTGROUP) {\n                p.openElements.pop();\n            }\n            break;\n        }\n        case $.OPTION: {\n            if (p.openElements.currentTagId === $.OPTION) {\n                p.openElements.pop();\n            }\n            break;\n        }\n        case $.SELECT: {\n            if (p.openElements.hasInSelectScope($.SELECT)) {\n                p.openElements.popUntilTagNamePopped($.SELECT);\n                p._resetInsertionMode();\n            }\n            break;\n        }\n        case $.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\n// The \"in select in table\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInSelectInTable(p, token) {\n    const tn = token.tagID;\n    if (tn === $.CAPTION ||\n        tn === $.TABLE ||\n        tn === $.TBODY ||\n        tn === $.TFOOT ||\n        tn === $.THEAD ||\n        tn === $.TR ||\n        tn === $.TD ||\n        tn === $.TH) {\n        p.openElements.popUntilTagNamePopped($.SELECT);\n        p._resetInsertionMode();\n        p._processStartTag(token);\n    }\n    else {\n        startTagInSelect(p, token);\n    }\n}\nfunction endTagInSelectInTable(p, token) {\n    const tn = token.tagID;\n    if (tn === $.CAPTION ||\n        tn === $.TABLE ||\n        tn === $.TBODY ||\n        tn === $.TFOOT ||\n        tn === $.THEAD ||\n        tn === $.TR ||\n        tn === $.TD ||\n        tn === $.TH) {\n        if (p.openElements.hasInTableScope(tn)) {\n            p.openElements.popUntilTagNamePopped($.SELECT);\n            p._resetInsertionMode();\n            p.onEndTag(token);\n        }\n    }\n    else {\n        endTagInSelect(p, token);\n    }\n}\n// The \"in template\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInTemplate(p, token) {\n    switch (token.tagID) {\n        // First, handle tags that can start without a mode change\n        case $.BASE:\n        case $.BASEFONT:\n        case $.BGSOUND:\n        case $.LINK:\n        case $.META:\n        case $.NOFRAMES:\n        case $.SCRIPT:\n        case $.STYLE:\n        case $.TEMPLATE:\n        case $.TITLE:\n            startTagInHead(p, token);\n            break;\n        // Re-process the token in the appropriate mode\n        case $.CAPTION:\n        case $.COLGROUP:\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD:\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_TABLE;\n            p.insertionMode = InsertionMode.IN_TABLE;\n            startTagInTable(p, token);\n            break;\n        case $.COL:\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_COLUMN_GROUP;\n            p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n            startTagInColumnGroup(p, token);\n            break;\n        case $.TR:\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_TABLE_BODY;\n            p.insertionMode = InsertionMode.IN_TABLE_BODY;\n            startTagInTableBody(p, token);\n            break;\n        case $.TD:\n        case $.TH:\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_ROW;\n            p.insertionMode = InsertionMode.IN_ROW;\n            startTagInRow(p, token);\n            break;\n        default:\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_BODY;\n            p.insertionMode = InsertionMode.IN_BODY;\n            startTagInBody(p, token);\n    }\n}\nfunction endTagInTemplate(p, token) {\n    if (token.tagID === $.TEMPLATE) {\n        templateEndTagInHead(p, token);\n    }\n}\nfunction eofInTemplate(p, token) {\n    if (p.openElements.tmplCount > 0) {\n        p.openElements.popUntilTagNamePopped($.TEMPLATE);\n        p.activeFormattingElements.clearToLastMarker();\n        p.tmplInsertionModeStack.shift();\n        p._resetInsertionMode();\n        p.onEof(token);\n    }\n    else {\n        stopParsing(p, token);\n    }\n}\n// The \"after body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterBody(p, token) {\n    if (token.tagID === $.HTML) {\n        startTagInBody(p, token);\n    }\n    else {\n        tokenAfterBody(p, token);\n    }\n}\nfunction endTagAfterBody(p, token) {\n    var _a;\n    if (token.tagID === $.HTML) {\n        if (!p.fragmentContext) {\n            p.insertionMode = InsertionMode.AFTER_AFTER_BODY;\n        }\n        //NOTE: <html> is never popped from the stack, so we need to updated\n        //the end location explicitly.\n        if (p.options.sourceCodeLocationInfo && p.openElements.tagIDs[0] === $.HTML) {\n            p._setEndLocation(p.openElements.items[0], token);\n            // Update the body element, if it doesn't have an end tag\n            const bodyElement = p.openElements.items[1];\n            if (bodyElement && !((_a = p.treeAdapter.getNodeSourceCodeLocation(bodyElement)) === null || _a === void 0 ? void 0 : _a.endTag)) {\n                p._setEndLocation(bodyElement, token);\n            }\n        }\n    }\n    else {\n        tokenAfterBody(p, token);\n    }\n}\nfunction tokenAfterBody(p, token) {\n    p.insertionMode = InsertionMode.IN_BODY;\n    modeInBody(p, token);\n}\n// The \"in frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInFrameset(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.FRAMESET: {\n            p._insertElement(token, NS.HTML);\n            break;\n        }\n        case $.FRAME: {\n            p._appendElement(token, NS.HTML);\n            token.ackSelfClosing = true;\n            break;\n        }\n        case $.NOFRAMES: {\n            startTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\nfunction endTagInFrameset(p, token) {\n    if (token.tagID === $.FRAMESET && !p.openElements.isRootHtmlElementCurrent()) {\n        p.openElements.pop();\n        if (!p.fragmentContext && p.openElements.currentTagId !== $.FRAMESET) {\n            p.insertionMode = InsertionMode.AFTER_FRAMESET;\n        }\n    }\n}\n// The \"after frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterFrameset(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.NOFRAMES: {\n            startTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\nfunction endTagAfterFrameset(p, token) {\n    if (token.tagID === $.HTML) {\n        p.insertionMode = InsertionMode.AFTER_AFTER_FRAMESET;\n    }\n}\n// The \"after after body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterAfterBody(p, token) {\n    if (token.tagID === $.HTML) {\n        startTagInBody(p, token);\n    }\n    else {\n        tokenAfterAfterBody(p, token);\n    }\n}\nfunction tokenAfterAfterBody(p, token) {\n    p.insertionMode = InsertionMode.IN_BODY;\n    modeInBody(p, token);\n}\n// The \"after after frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterAfterFrameset(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.NOFRAMES: {\n            startTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\n// The rules for parsing tokens in foreign content\n//------------------------------------------------------------------\nfunction nullCharacterInForeignContent(p, token) {\n    token.chars = unicode.REPLACEMENT_CHARACTER;\n    p._insertCharacters(token);\n}\nfunction characterInForeignContent(p, token) {\n    p._insertCharacters(token);\n    p.framesetOk = false;\n}\nfunction popUntilHtmlOrIntegrationPoint(p) {\n    while (p.treeAdapter.getNamespaceURI(p.openElements.current) !== NS.HTML &&\n        !p._isIntegrationPoint(p.openElements.currentTagId, p.openElements.current)) {\n        p.openElements.pop();\n    }\n}\nfunction startTagInForeignContent(p, token) {\n    if (foreignContent.causesExit(token)) {\n        popUntilHtmlOrIntegrationPoint(p);\n        p._startTagOutsideForeignContent(token);\n    }\n    else {\n        const current = p._getAdjustedCurrentElement();\n        const currentNs = p.treeAdapter.getNamespaceURI(current);\n        if (currentNs === NS.MATHML) {\n            foreignContent.adjustTokenMathMLAttrs(token);\n        }\n        else if (currentNs === NS.SVG) {\n            foreignContent.adjustTokenSVGTagName(token);\n            foreignContent.adjustTokenSVGAttrs(token);\n        }\n        foreignContent.adjustTokenXMLAttrs(token);\n        if (token.selfClosing) {\n            p._appendElement(token, currentNs);\n        }\n        else {\n            p._insertElement(token, currentNs);\n        }\n        token.ackSelfClosing = true;\n    }\n}\nfunction endTagInForeignContent(p, token) {\n    if (token.tagID === $.P || token.tagID === $.BR) {\n        popUntilHtmlOrIntegrationPoint(p);\n        p._endTagOutsideForeignContent(token);\n        return;\n    }\n    for (let i = p.openElements.stackTop; i > 0; i--) {\n        const element = p.openElements.items[i];\n        if (p.treeAdapter.getNamespaceURI(element) === NS.HTML) {\n            p._endTagOutsideForeignContent(token);\n            break;\n        }\n        const tagName = p.treeAdapter.getTagName(element);\n        if (tagName.toLowerCase() === token.tagName) {\n            //NOTE: update the token tag name for `_setEndLocation`.\n            token.tagName = tagName;\n            p.openElements.shortenToLength(i);\n            break;\n        }\n    }\n}\n//# sourceMappingURL=index.js.map"],"mappings":"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"},"metadata":{},"sourceType":"module"}