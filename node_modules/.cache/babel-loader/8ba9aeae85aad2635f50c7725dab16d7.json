{"ast":null,"code":"import { attributeRules } from \"./attributes.js\";\nimport { compilePseudoSelector } from \"./pseudo-selectors/index.js\";\nimport { SelectorType } from \"css-what\";\n\nfunction getElementParent(node, adapter) {\n  const parent = adapter.getParent(node);\n\n  if (parent && adapter.isTag(parent)) {\n    return parent;\n  }\n\n  return null;\n}\n/*\n * All available rules\n */\n\n\nexport function compileGeneralSelector(next, selector, options, context, compileToken) {\n  const {\n    adapter,\n    equals\n  } = options;\n\n  switch (selector.type) {\n    case SelectorType.PseudoElement:\n      {\n        throw new Error(\"Pseudo-elements are not supported by css-select\");\n      }\n\n    case SelectorType.ColumnCombinator:\n      {\n        throw new Error(\"Column combinators are not yet supported by css-select\");\n      }\n\n    case SelectorType.Attribute:\n      {\n        if (selector.namespace != null) {\n          throw new Error(\"Namespaced attributes are not yet supported by css-select\");\n        }\n\n        if (!options.xmlMode || options.lowerCaseAttributeNames) {\n          selector.name = selector.name.toLowerCase();\n        }\n\n        return attributeRules[selector.action](next, selector, options);\n      }\n\n    case SelectorType.Pseudo:\n      {\n        return compilePseudoSelector(next, selector, options, context, compileToken);\n      }\n    // Tags\n\n    case SelectorType.Tag:\n      {\n        if (selector.namespace != null) {\n          throw new Error(\"Namespaced tag names are not yet supported by css-select\");\n        }\n\n        let {\n          name\n        } = selector;\n\n        if (!options.xmlMode || options.lowerCaseTags) {\n          name = name.toLowerCase();\n        }\n\n        return function tag(elem) {\n          return adapter.getName(elem) === name && next(elem);\n        };\n      }\n    // Traversal\n\n    case SelectorType.Descendant:\n      {\n        if (options.cacheResults === false || typeof WeakSet === \"undefined\") {\n          return function descendant(elem) {\n            let current = elem;\n\n            while (current = getElementParent(current, adapter)) {\n              if (next(current)) {\n                return true;\n              }\n            }\n\n            return false;\n          };\n        } // @ts-expect-error `ElementNode` is not extending object\n\n\n        const isFalseCache = new WeakSet();\n        return function cachedDescendant(elem) {\n          let current = elem;\n\n          while (current = getElementParent(current, adapter)) {\n            if (!isFalseCache.has(current)) {\n              if (adapter.isTag(current) && next(current)) {\n                return true;\n              }\n\n              isFalseCache.add(current);\n            }\n          }\n\n          return false;\n        };\n      }\n\n    case \"_flexibleDescendant\":\n      {\n        // Include element itself, only used while querying an array\n        return function flexibleDescendant(elem) {\n          let current = elem;\n\n          do {\n            if (next(current)) return true;\n          } while (current = getElementParent(current, adapter));\n\n          return false;\n        };\n      }\n\n    case SelectorType.Parent:\n      {\n        return function parent(elem) {\n          return adapter.getChildren(elem).some(elem => adapter.isTag(elem) && next(elem));\n        };\n      }\n\n    case SelectorType.Child:\n      {\n        return function child(elem) {\n          const parent = adapter.getParent(elem);\n          return parent != null && adapter.isTag(parent) && next(parent);\n        };\n      }\n\n    case SelectorType.Sibling:\n      {\n        return function sibling(elem) {\n          const siblings = adapter.getSiblings(elem);\n\n          for (let i = 0; i < siblings.length; i++) {\n            const currentSibling = siblings[i];\n            if (equals(elem, currentSibling)) break;\n\n            if (adapter.isTag(currentSibling) && next(currentSibling)) {\n              return true;\n            }\n          }\n\n          return false;\n        };\n      }\n\n    case SelectorType.Adjacent:\n      {\n        if (adapter.prevElementSibling) {\n          return function adjacent(elem) {\n            const previous = adapter.prevElementSibling(elem);\n            return previous != null && next(previous);\n          };\n        }\n\n        return function adjacent(elem) {\n          const siblings = adapter.getSiblings(elem);\n          let lastElement;\n\n          for (let i = 0; i < siblings.length; i++) {\n            const currentSibling = siblings[i];\n            if (equals(elem, currentSibling)) break;\n\n            if (adapter.isTag(currentSibling)) {\n              lastElement = currentSibling;\n            }\n          }\n\n          return !!lastElement && next(lastElement);\n        };\n      }\n\n    case SelectorType.Universal:\n      {\n        if (selector.namespace != null && selector.namespace !== \"*\") {\n          throw new Error(\"Namespaced universal selectors are not yet supported by css-select\");\n        }\n\n        return next;\n      }\n  }\n}","map":{"version":3,"mappings":"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","names":["attributeRules","compilePseudoSelector","SelectorType","getElementParent","node","adapter","parent","getParent","isTag","compileGeneralSelector","next","selector","options","context","compileToken","equals","type","PseudoElement","Error","ColumnCombinator","Attribute","namespace","xmlMode","lowerCaseAttributeNames","name","toLowerCase","action","Pseudo","Tag","lowerCaseTags","tag","elem","getName","Descendant","cacheResults","WeakSet","descendant","current","isFalseCache","cachedDescendant","has","add","flexibleDescendant","Parent","getChildren","some","Child","child","Sibling","sibling","siblings","getSiblings","i","length","currentSibling","Adjacent","prevElementSibling","adjacent","previous","lastElement","Universal"],"sourceRoot":"https://raw.githubusercontent.com/fb55/css-select/0f0725a9dfeddd2fdb54eda9656cdbab5bbf6be6/src/","sources":["general.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}